/*! For license information please see dialog.js.LICENSE.txt */
"use strict";(self.webpackChunkoffice_addin_taskpane_react=self.webpackChunkoffice_addin_taskpane_react||[]).push([[907],{5338:function(e,t,r){var n=r(40961);t.H=n.createRoot,n.hydrateRoot},26312:function(e,t,r){function n(e){return Array.isArray(e)?e:[e]}r.d(t,{J:function(){return g}});var o=r(45614);const i=["r","d","l","v","w","f","i","h","a","s","k","t","m","c"].reduce((e,t,r)=>(e[t]=r,e),{});function s(e,t,r,n,s={}){var a,c;const l="m"===e,h=null!==(a=s.m)&&void 0!==a?a:"0",d=null!==(c=s.p)&&void 0!==c?c:0,u=function(e,t,r){return("m"===e?e+t:e)+r}(e,h,d);if(!n.stylesheets[u]){const a=t&&t.createElement("style"),c=function(e,t,r,n){const i=[];if(n[o.ed]=t,n[o.EJ]=String(r),e)for(const t in n)e.setAttribute(t,n[t]);return{elementAttributes:n,insertRule:function(t){return(null==e?void 0:e.sheet)?e.sheet.insertRule(t,e.sheet.cssRules.length):i.push(t)},element:e,bucketName:t,cssRules(){return(null==e?void 0:e.sheet)?Array.from(e.sheet.cssRules).map(e=>e.cssText):i}}}(a,e,d,Object.assign({},n.styleElementAttributes,l&&{media:h}));n.stylesheets[u]=c,(null==t?void 0:t.head)&&a&&t.head.insertBefore(a,function(e,t,r,n,s={}){var a,c;const l=i[r],h=null!==(a=s.m)&&void 0!==a?a:"",d=null!==(c=s.p)&&void 0!==c?c:0;let u=e=>l-i[e.getAttribute(o.ed)],g=e.head.querySelectorAll(`[${o.ed}]`);if("m"===r){const t=e.head.querySelectorAll(`[${o.ed}="${r}"]`);t.length&&(g=t,u=e=>n.compareMediaQueries(h,e.media))}const p=e=>function(e,t,r){var n,i;return t+(null!==(n=r.m)&&void 0!==n?n:"")===e.getAttribute(o.ed)+(null!==(i=e.media)&&void 0!==i?i:"")}(e,r,s)?d-Number(e.getAttribute("data-priority")):u(e),m=g.length;let f=m-1;for(;f>=0;){const e=g.item(f);if(p(e)>0)return e.nextSibling;f--}return m>0?g.item(0):t?t.nextSibling:null}(t,r,e,n,s))}return n.stylesheets[u]}function a(e,t){try{e.insertRule(t)}catch(e){}}let c=0;const l=(e,t)=>e<t?-1:e>t?1:0;function h(e=("undefined"==typeof document?void 0:document),t={}){const{classNameHashSalt:r,unstable_filterCSSRule:o,insertionPoint:i,styleElementAttributes:h,compareMediaQueries:d=l}=t,u={classNameHashSalt:r,insertionCache:{},stylesheets:{},styleElementAttributes:Object.freeze(h),compareMediaQueries:d,id:"d"+c++,insertCSSRules(t){for(const r in t){const c=t[r];for(let t=0,l=c.length;t<l;t++){const[l,h]=n(c[t]),d=s(r,e,i||null,u,h);u.insertionCache[l]||(u.insertionCache[l]=r,o?o(l)&&a(d,l):a(d,l))}}}};return u}var d=r(96540);const u=d.createContext(h());function g(){return d.useContext(u)}},29255:function(e,t,r){r.d(t,{G:function(){return i}});var n=r(35137),o=r(45614);function i(e,t,r=[]){return o.fj+function(e){const t=e.length;if(t===o.ez)return e;for(let r=t;r<o.ez;r++)e+="0";return e}((0,n.A)(e+t))}},31105:function(e,t,r){var n=r(96540),o=r(5338),i=r(44541),s=(0,i.n)({page:{minHeight:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",padding:"18px",background:"rgba(18, 34, 55, 0.8)",boxSizing:"border-box",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif'},card:{width:"100%",maxWidth:"720px",marginLeft:"auto",marginRight:"auto",borderRadius:"14px",border:"1px solid rgba(0,0,0,0.10)",background:"rgba(255,255,255,1)",boxShadow:"0 12px 30px rgba(0,0,0,0.06)",padding:"22px",boxSizing:"border-box"},error:{borderRadius:"10px",padding:"10px 12px",border:"1px solid rgba(180, 0, 0, 0.25)",background:"rgba(220, 0, 0, 0.06)",color:"rgba(120, 0, 0, 0.95)",fontSize:"13px",lineHeight:1.35,marginBottom:"12px"},consentTop:{display:"flex",flexDirection:"column",alignItems:"center",gap:"14px",textAlign:"center",marginBottom:"18px"},connectorImg:{width:"100%",maxWidth:"220px",height:"auto",display:"block",objectFit:"contain"},consentTitle:{margin:0,fontSize:"20px",fontWeight:800,color:"rgba(17,24,39,0.95)"},consentTitleEm:{fontWeight:900},consentSection:{marginTop:"18px"},sectionHeading:{margin:"0 0 10px 0",fontSize:"13px",fontWeight:700,opacity:.85,textTransform:"none"},list:{display:"flex",flexDirection:"column",borderTop:"1px solid rgba(0,0,0,0.10)"},row:{display:"flex",alignItems:"center",gap:"12px",padding:"12px 0",borderBottom:"1px solid rgba(0,0,0,0.10)"},iconBox:{width:"34px",height:"34px",borderRadius:"10px",border:"1px solid rgba(0,0,0,0.10)",background:"rgba(255,255,255,0.65)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",flex:"0 0 auto"},rowText:{flex:"1 1 auto",fontSize:"14px",color:"rgba(17,24,39,0.92)"},chevron:{flex:"0 0 auto",fontSize:"18px",opacity:.55},checkboxRow:{display:"flex",gap:"10px",alignItems:"flex-start",marginTop:"14px",padding:"10px 12px",borderRadius:"12px",border:"1px solid rgba(0,0,0,0.10)",background:"rgba(255,255,255,0.60)"},checkbox:{marginTop:"3px"},agreementText:{margin:0,fontSize:"13px",lineHeight:"1.35",opacity:.9,textAlign:"left"},consentActions:{display:"flex",justifyContent:"center",gap:"12px",marginTop:"22px"},cancelBtn:{height:"40px",minWidth:"110px",borderRadius:"12px",border:"1px solid rgba(0,0,0,0.18)",background:"transparent",cursor:"pointer",fontWeight:600},allowBtn:{height:"40px",minWidth:"110px",borderRadius:"12px",border:"none",background:"#2EA44F",color:"white",cursor:"pointer",fontWeight:700}});function a(e){var t,r,n=JSON.stringify(e);try{if("undefined"!=typeof Office&&(null===(r=null===(t=null===Office||void 0===Office?void 0:Office.context)||void 0===t?void 0:t.ui)||void 0===r?void 0:r.messageParent))return void Office.context.ui.messageParent(n)}catch(e){}alert("Office dialog messaging is not available.")}function c(e){try{return new URL(window.location.href).searchParams.get(e)||""}catch(e){return""}}function l(){var e=s(),t=n.useState(""),r=t[0],o=t[1],i=n.useState(""),l=i[0],h=i[1],d=n.useState(null),u=d[0],g=d[1],p=n.useState(""),m=p[0],f=(p[1],n.useState(!1)),y=f[0],w=f[1],v=n.useState(null),C=v[0],I=v[1];return n.useEffect(function(){var e=(c("workspaceHost")||"").trim(),t=(c("token")||"").trim();o(e),h(t),e&&g({workspaceId:e,name:e,host:e})},[]),n.createElement("div",{className:e.page},n.createElement("div",{className:e.card},n.createElement("div",{className:e.consentTop},n.createElement("img",{src:"assets/outlooktosc.png",alt:"Outlook to SingleCase",className:e.connectorImg}),n.createElement("h2",{className:e.consentTitle},"Outlook is requesting permission to access the ",n.createElement("span",{className:e.consentTitleEm},"SingleCase")," ","workspace")),u?n.createElement("div",{style:{fontSize:"12px",opacity:.75,textAlign:"center",marginBottom:"10px"}},"Workspace: ",u.host):null,C?n.createElement("div",{className:e.error},C):null,n.createElement("div",{className:e.consentSection},n.createElement("div",{className:e.sectionHeading},"What will this add in be able to view?"),n.createElement("div",{className:e.list},n.createElement("div",{className:e.row},n.createElement("div",{className:e.iconBox},"ðŸ‘¤"),n.createElement("div",{className:e.rowText},"Content and info about you"),n.createElement("div",{className:e.chevron},"â€º")),n.createElement("div",{className:e.row},n.createElement("div",{className:e.iconBox},"ðŸ’¬"),n.createElement("div",{className:e.rowText},"Content and info about emails and conversations"),n.createElement("div",{className:e.chevron},"â€º")),n.createElement("div",{className:e.row},n.createElement("div",{className:e.iconBox},"â–¦"),n.createElement("div",{className:e.rowText},"Content and info about your workspace"),n.createElement("div",{className:e.chevron},"â€º")))),n.createElement("div",{className:e.consentSection},n.createElement("div",{className:e.sectionHeading},"What will this add in be able to do?"),n.createElement("div",{className:e.list},n.createElement("div",{className:e.row},n.createElement("div",{className:e.iconBox},"âš¡"),n.createElement("div",{className:e.rowText},"Upload selected emails and attachments to SingleCase cases"),n.createElement("div",{className:e.chevron},"â€º")))),n.createElement("div",{className:e.checkboxRow},n.createElement("input",{className:e.checkbox,type:"checkbox",checked:y,onChange:function(e){return w(e.target.checked)}}),n.createElement("div",null,n.createElement("p",{className:e.agreementText},"I confirm that I have authorisation to connect this Outlook mailbox with SingleCase and upload emails and attachments to the selected workspace and case."))),n.createElement("div",{className:e.consentActions},n.createElement("button",{className:e.cancelBtn,onClick:function(){a({type:"auth_cancel"})},type:"button"},"Cancel"),n.createElement("button",{className:e.allowBtn,onClick:function(){I(null),r?l?u?y?a({type:"auth_complete",token:l,email:m||"",workspace:u,agreed:!0}):I("You must confirm authorisation to continue."):I("Workspace is missing."):I("Token is missing."):I("Workspace is missing.")},type:"button"},"Allow"))))}function h(e){return`See https://aka.ms/msal.js.errors#${e} for details`}class d extends Error{constructor(e,t,r){const n=t||(e?h(e):"");super(n?`${e}: ${n}`:e),Object.setPrototypeOf(this,d.prototype),this.errorCode=e||"",this.errorMessage=n||"",this.subError=r||"",this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function u(e,t){return new d(e,t||h(e))}class g extends d{constructor(e,t){super(e,t),this.name="ClientAuthError",Object.setPrototypeOf(this,g.prototype)}}function p(e,t){return new g(e,t)}const m="client_info_decoding_error",f="token_parsing_error",y="endpoints_resolution_error",w="invalid_state",v="state_not_found",C="auth_time_not_found",I="empty_input_scopeset",b="no_account_in_silent_request",k="invalid_cache_environment",T="no_account_found",A="no_crypto_object",S="token_refresh_required",_="key_id_missing",P="method_not_implemented";class R extends d{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,R.prototype)}}function x(e){return new R(e)}const E="https://login.microsoftonline.com/common/",O="common",M=`${E}discovery/instance?api-version=1.1&authorization_endpoint=`,q=".ciamlogin.com",N="openid",U="profile",H="offline_access",L="S256",D="Not Available",z="http://169.254.169.254/metadata/instance/compute/location",F=["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],B="POST",j=[N,U,H],K=[...j,"email"],$="Content-Type",W="Retry-After",J="X-AnchorMailbox",V="x-ms-request-id",G="x-ms-httpver",Q="active-account-filters",X="common",Y="organizations",Z="consumers",ee="access_token",te="xms_cc",re="login",ne="consent",oe="none",ie="code",se="query",ae="Generic",ce={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},le="appmetadata",he="1",de="authority-metadata",ue="config",ge="cache",pe="network",me="hardcoded_values",fe=5,ye="server-telemetry",we=",",ve={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},Ce="throttling";class Ie{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw x("missing_kid_error");if(!e.alg)throw x("missing_alg_error");const t=new Ie({typ:e.typ||"pop",kid:e.kid,alg:e.alg});return JSON.stringify(t)}}const be="standardInteractionClientGetDiscoveredAuthority",ke="nativeInteractionClientAcquireToken",Te="acquireTokenBySilentIframe",Ae="initializeBaseRequest",Se="silentIframeClientTokenHelper",_e="silentHandlerInitiateAuthRequest",Pe="silentHandlerMonitorIframeForHash",Re="standardInteractionClientCreateAuthCodeClient",xe="standardInteractionClientGetClientConfiguration",Ee="standardInteractionClientInitializeAuthorizationRequest",Oe="handleResponseEar",Me="handleResponsePlatformBroker",qe="handleResponseCode",Ne="deserializeResponse",Ue="generatePkceCodes",He="generateHKDF",Le="decrypt",De="generateEarKey";function ze(e){return encodeURIComponent(Be(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function Fe(e){return je(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Be(e){return je((new TextEncoder).encode(e))}function je(e){const t=Array.from(e,e=>String.fromCodePoint(e)).join("");return btoa(t)}function Ke(e){return`See https://aka.ms/msal.js.errors#${e} for details`}class $e extends d{constructor(e,t){super(e,Ke(e),t),Object.setPrototypeOf(this,$e.prototype),this.name="BrowserAuthError"}}function We(e,t){return new $e(e,t)}const Je="pkce_not_created",Ve="ear_jwk_empty",Ge="crypto_nonexistent",Qe="empty_navigate_uri",Xe="no_state_in_hash",Ye="unable_to_parse_state",Ze="user_cancelled",et="silent_logout_unsupported",tt="non_browser_environment",rt="database_not_open",nt="no_network_connectivity",ot="failed_to_parse_response",it="crypto_key_not_found",st="database_unavailable",at="native_connection_not_established",ct="uninitialized_public_client_application",lt="failed_to_decrypt_ear_response",ht="timed_out";function dt(e){return(new TextDecoder).decode(ut(e))}function ut(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw We("invalid_base64_string")}const r=atob(t);return Uint8Array.from(r,e=>e.codePointAt(0)||0)}const gt="invalid_grant",pt="msal",mt="msal.js.browser",ft="53ee284d-920a-4b59-9d30-a60315b26836",yt="ppnbnpeolgkicgegkbkbjmhlideopiji",wt="MicrosoftEntra",vt="Handshake",Ct="localStorage",It="sessionStorage",bt="memoryStorage",kt="signin",Tt="signout",At="request.origin",St="urlHash",_t="request.params",Pt="code.verifier",Rt="interaction.status",xt="request.native",Et="wrapper.sku",Ot="wrapper.version",Mt=861,qt=862,Nt={861:"acquireTokenRedirect",862:"acquireTokenPopup",863:"ssoSilent",864:"acquireTokenSilent_authCode",865:"handleRedirectPromise",866:"acquireTokenByCode",61:"acquireTokenSilent_silentFlow",961:"logout",962:"logoutPopup",963:"hydrateCache",964:"loadExternalTokens"};var Ut;!function(e){e.Redirect="redirect",e.Popup="popup",e.Silent="silent",e.None="none"}(Ut||(Ut={}));const Ht={scopes:j},Lt="msal.db",Dt=`${Lt}.keys`,zt=[0,5,4],Ft="AES-GCM",Bt="HKDF",jt="SHA-256",Kt=new Uint8Array([1,0,1]),$t="0123456789abcdef",Wt=new Uint32Array(1),Jt="raw",Vt="encrypt",Gt="decrypt",Qt={name:"RSASSA-PKCS1-v1_5",hash:jt,modulusLength:2048,publicExponent:Kt};async function Xt(e){const t=(new TextEncoder).encode(e);return window.crypto.subtle.digest(jt,t)}function Yt(e){return window.crypto.getRandomValues(e)}function Zt(){return window.crypto.getRandomValues(Wt),Wt[0]}function er(){const e=Date.now(),t=1024*Zt()+(1023&Zt()),r=new Uint8Array(16),n=Math.trunc(t/2**30),o=t&2**30-1,i=Zt();r[0]=e/2**40,r[1]=e/2**32,r[2]=e/2**24,r[3]=e/65536,r[4]=e/256,r[5]=e,r[6]=112|n>>>8,r[7]=n,r[8]=128|o>>>24,r[9]=o>>>16,r[10]=o>>>8,r[11]=o,r[12]=i>>>24,r[13]=i>>>16,r[14]=i>>>8,r[15]=i;let s="";for(let e=0;e<r.length;e++)s+=$t.charAt(r[e]>>>4),s+=$t.charAt(15&r[e]),3!==e&&5!==e&&7!==e&&9!==e||(s+="-");return s}async function tr(e){return window.crypto.subtle.exportKey("jwk",e)}async function rr(){const e=await or(),t={alg:"dir",kty:"oct",k:Fe(new Uint8Array(e))};return Be(JSON.stringify(t))}async function nr(e,t){const r=t.split(".");if(5!==r.length)throw We(lt,"jwe_length");const n=await async function(e){const t=dt(e),r=ut(JSON.parse(t).k);return window.crypto.subtle.importKey(Jt,r,Ft,!1,[Gt])}(e).catch(()=>{throw We(lt,"import_key")});try{const e=(new TextEncoder).encode(r[0]),t=ut(r[2]),o=ut(r[3]),i=ut(r[4]),s=8*i.byteLength,a=new Uint8Array(o.length+i.length);a.set(o),a.set(i,o.length);const c=await window.crypto.subtle.decrypt({name:Ft,iv:t,tagLength:s,additionalData:e},n,a);return(new TextDecoder).decode(c)}catch(e){throw We(lt,"decrypt")}}async function or(){const e=await window.crypto.subtle.generateKey({name:Ft,length:256},!0,[Vt,Gt]);return window.crypto.subtle.exportKey(Jt,e)}async function ir(e){return window.crypto.subtle.importKey(Jt,e,Bt,!1,["deriveKey"])}async function sr(e,t,r){return window.crypto.subtle.deriveKey({name:Bt,salt:t,hash:jt,info:(new TextEncoder).encode(r)},e,{name:Ft,length:256},!1,[Vt,Gt])}async function ar(e,t,r){const n=(new TextEncoder).encode(t),o=window.crypto.getRandomValues(new Uint8Array(16)),i=await sr(e,o,r),s=await window.crypto.subtle.encrypt({name:Ft,iv:new Uint8Array(12)},i,n);return{data:Fe(new Uint8Array(s)),nonce:Fe(o)}}async function cr(e,t,r,n){const o=ut(n),i=await sr(e,ut(t),r),s=await window.crypto.subtle.decrypt({name:Ft,iv:new Uint8Array(12)},i,o);return(new TextDecoder).decode(s)}var lr=r(64583).Promise;class hr{constructor(){this.dbName=Lt,this.version=1,this.tableName=Dt,this.dbOpen=!1}async open(){return new lr((e,t)=>{const r=window.indexedDB.open(this.dbName,this.version);r.addEventListener("upgradeneeded",e=>{e.target.result.createObjectStore(this.tableName)}),r.addEventListener("success",t=>{const r=t;this.db=r.target.result,this.dbOpen=!0,e()}),r.addEventListener("error",()=>t(We(st)))})}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new lr((t,r)=>{if(!this.db)return r(We(rt));const n=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);n.addEventListener("success",e=>{const r=e;this.closeConnection(),t(r.target.result)}),n.addEventListener("error",e=>{this.closeConnection(),r(e)})})}async setItem(e,t){return await this.validateDbIsOpen(),new lr((r,n)=>{if(!this.db)return n(We(rt));const o=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);o.addEventListener("success",()=>{this.closeConnection(),r()}),o.addEventListener("error",e=>{this.closeConnection(),n(e)})})}async removeItem(e){return await this.validateDbIsOpen(),new lr((t,r)=>{if(!this.db)return r(We(rt));const n=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);n.addEventListener("success",()=>{this.closeConnection(),t()}),n.addEventListener("error",e=>{this.closeConnection(),r(e)})})}async getKeys(){return await this.validateDbIsOpen(),new lr((e,t)=>{if(!this.db)return t(We(rt));const r=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();r.addEventListener("success",t=>{const r=t;this.closeConnection(),e(r.target.result)}),r.addEventListener("error",e=>{this.closeConnection(),t(e)})})}async containsKey(e){return await this.validateDbIsOpen(),new lr((t,r)=>{if(!this.db)return r(We(rt));const n=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);n.addEventListener("success",e=>{const r=e;this.closeConnection(),t(1===r.target.result)}),n.addEventListener("error",e=>{this.closeConnection(),r(e)})})}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new lr((e,t)=>{const r=window.indexedDB.deleteDatabase(Lt),n=setTimeout(()=>t(!1),200);r.addEventListener("success",()=>(clearTimeout(n),e(!0))),r.addEventListener("blocked",()=>(clearTimeout(n),e(!0))),r.addEventListener("error",()=>(clearTimeout(n),t(!1)))})}}var dr=r(64583).Promise;class ur{constructor(){this.cache=new Map}async initialize(){}getItem(e){return this.cache.get(e)||null}getUserData(e){return this.getItem(e)}setItem(e,t){this.cache.set(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach((t,r)=>{e.push(r)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}decryptData(){return dr.resolve(null)}}class gr{constructor(e){this.inMemoryCache=new ur,this.indexedDBCache=new hr,this.logger=e}handleDatabaseAccessError(e,t){if(!(e instanceof $e&&e.errorCode===st))throw e;this.logger.error("1wx7zz",t)}async getItem(e,t){const r=this.inMemoryCache.getItem(e);if(!r)try{return this.logger.verbose("0naxpl",t),await this.indexedDBCache.getItem(e)}catch(e){this.handleDatabaseAccessError(e,t)}return r}async setItem(e,t,r){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(e){this.handleDatabaseAccessError(e,r)}}async removeItem(e,t){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(e){this.handleDatabaseAccessError(e,t)}}async getKeys(e){const t=this.inMemoryCache.getKeys();if(0===t.length)try{return this.logger.verbose("1iqrbq",e),await this.indexedDBCache.getKeys()}catch(t){this.handleDatabaseAccessError(t,e)}return t}async containsKey(e,t){const r=this.inMemoryCache.containsKey(e);if(!r)try{return this.logger.verbose("03zl2j",t),await this.indexedDBCache.containsKey(e)}catch(e){this.handleDatabaseAccessError(e,t)}return r}clearInMemory(e){this.logger.verbose("03r21p",e),this.inMemoryCache.clear(),this.logger.verbose("0uksk1",e)}async clearPersistent(e){try{this.logger.verbose("0rdqut",e);const t=await this.indexedDBCache.deleteDatabase();return t&&this.logger.verbose("149ouc",e),t}catch(t){return this.handleDatabaseAccessError(t,e),!1}}}class pr{constructor(e,t,r){this.logger=e,function(e){if(!window)throw We(tt);if(!window.crypto)throw We(Ge);if(!e&&!window.crypto.subtle)throw We(Ge,"crypto_subtle_undefined")}(r??!1),this.cache=new gr(this.logger),this.performanceClient=t}createNewGuid(){return er()}base64Encode(e){return Be(e)}base64Decode(e){return dt(e)}base64UrlEncode(e){return ze(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}async getPublicKeyThumbprint(e){const t=this.performanceClient?.startMeasurement("cryptoOptsGetPublicKeyThumbprint",e.correlationId),r=await async function(e,t){return window.crypto.subtle.generateKey(Qt,e,t)}(pr.EXTRACTABLE,pr.POP_KEY_USAGES),n=await tr(r.publicKey),o=mr({e:n.e,kty:n.kty,n:n.n}),i=await this.hashString(o),s=await tr(r.privateKey),a=await async function(e){return window.crypto.subtle.importKey("jwk",e,Qt,!1,["sign"])}(s);return await this.cache.setItem(i,{privateKey:a,publicKey:r.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri},e.correlationId),t&&t.end({success:!0}),i}async removeTokenBindingKey(e,t){if(await this.cache.removeItem(e,t),await this.cache.containsKey(e,t))throw p("binding_key_not_removed")}async clearKeystore(e){this.cache.clearInMemory(e);try{return await this.cache.clearPersistent(e),!0}catch(t){return t instanceof Error?this.logger.error("1owpn8",e):this.logger.error("0yrmwo",e),!1}}async signJwt(e,t,r,n){const o=this.performanceClient?.startMeasurement("cryptoOptsSignJwt",n),i=await this.cache.getItem(t,n||"");if(!i)throw We(it);const s=await tr(i.publicKey),a=mr(s),c=ze(JSON.stringify({kid:t})),l=ze(Ie.getShrHeaderString({...r?.header,alg:s.alg,kid:c}));e.cnf={jwk:JSON.parse(a)};const h=`${l}.${ze(JSON.stringify(e))}`,d=(new TextEncoder).encode(h),u=await async function(e,t){return window.crypto.subtle.sign(Qt,e,t)}(i.privateKey,d),g=`${h}.${Fe(new Uint8Array(u))}`;return o&&o.end({success:!0}),g}async hashString(e){return async function(e){const t=await Xt(e);return Fe(new Uint8Array(t))}(e)}}function mr(e){return JSON.stringify(e,Object.keys(e).sort())}pr.POP_KEY_USAGES=["sign","verify"],pr.EXTRACTABLE=!0;const fr={createNewGuid:()=>{throw p(P)},base64Decode:()=>{throw p(P)},base64Encode:()=>{throw p(P)},base64UrlEncode:()=>{throw p(P)},encodeKid:()=>{throw p(P)},async getPublicKeyThumbprint(){throw p(P)},async removeTokenBindingKey(){throw p(P)},async clearKeystore(){throw p(P)},async signJwt(){throw p(P)},async hashString(){throw p(P)}};class yr extends d{constructor(e){super(e),this.name="ClientConfigurationError",Object.setPrototypeOf(this,yr.prototype)}}function wr(e){return new yr(e)}class vr{static isEmptyObj(e){if(e)try{const t=JSON.parse(e);return 0===Object.keys(t).length}catch(e){}return!0}static startsWith(e,t){return 0===e.indexOf(t)}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){const t={},r=e.split("&"),n=e=>decodeURIComponent(e.replace(/\+/g," "));return r.forEach(e=>{if(e.trim()){const[r,o]=e.split(/=(.+)/g,2);r&&o&&(t[n(r)]=n(o))}}),t}static trimArrayEntries(e){return e.map(e=>e.trim())}static removeEmptyStringsFromArray(e){return e.filter(e=>!!e)}static jsonParseHelper(e){try{return JSON.parse(e)}catch(e){return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}const Cr="url_parse_error",Ir="invalid_claims",br="pkce_params_missing",kr="invalid_cloud_discovery_metadata",Tr="missing_ssh_jwk";class Ar{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw wr("empty_url_error");e.includes("#")||(this._urlString=Ar.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return vr.endsWith(t,"?")?t=t.slice(0,-1):vr.endsWith(t,"?/")&&(t=t.slice(0,-2)),vr.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch(e){throw wr(Cr)}if(!e.HostNameAndPort||!e.PathSegments)throw wr(Cr);if(!e.Protocol||"https:"!==e.Protocol.toLowerCase())throw wr("authority_uri_insecure")}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return Ar.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){const t=this.getUrlComponents(),r=t.PathSegments;return!e||0===r.length||r[0]!==X&&r[0]!==Y||(r[0]=e),Ar.constructAuthorityUriFromObject(t)}getUrlComponents(){const e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw wr(Cr);const r={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]};let n=r.AbsolutePath.split("/");return n=n.filter(e=>e&&e.length>0),r.PathSegments=n,r.QueryString&&r.QueryString.endsWith("/")&&(r.QueryString=r.QueryString.substring(0,r.QueryString.length-1)),r}static getDomainFromUrl(e){const t=RegExp("^([^:/?#]+://)?([^/?#]*)"),r=e.match(t);if(!r)throw wr(Cr);return r[2]}static getAbsoluteUrl(e,t){if("/"===e[0]){const r=new Ar(t).getUrlComponents();return r.Protocol+"//"+r.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new Ar(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}}const Sr={endpointMetadata:[{host:"login.microsoftonline.com"},{host:"login.chinacloudapi.cn",issuerHost:"login.partner.microsoftonline.cn"},{host:"login.microsoftonline.us"},{host:"login.sovcloud-identity.fr"},{host:"login.sovcloud-identity.de"},{host:"login.sovcloud-identity.sg"}].reduce((e,{host:t,issuerHost:r})=>(e[t]=function(e,t){return{token_endpoint:`https://${e}/{tenantid}/oauth2/v2.0/token`,jwks_uri:`https://${e}/{tenantid}/discovery/v2.0/keys`,issuer:`https://${t}/{tenantid}/v2.0`,authorization_endpoint:`https://${e}/{tenantid}/oauth2/v2.0/authorize`,end_session_endpoint:`https://${e}/{tenantid}/oauth2/v2.0/logout`}}(t,r||t),e),{}),instanceDiscoveryMetadata:{metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}},_r=Sr.endpointMetadata,Pr=Sr.instanceDiscoveryMetadata,Rr=new Set;function xr(e,t,r,n,o){if(e.trace("1bmquz",t),r&&n){const o=Er(n,r);if(o)return e.trace("1fotbt",t),o.aliases;e.trace("14avvj",t)}return null}function Er(e,t){for(let r=0;r<e.length;r++){const n=e[r];if(n.aliases.includes(t))return n}return null}Pr.metadata.forEach(e=>{e.aliases.forEach(e=>{Rr.add(e)})});const Or="OIDC",Mr="EAR",qr="none",Nr="refreshTokenClientAcquireTokenWithCachedRefreshToken",Ur="getAuthCodeUrl",Hr="handleCodeResponseFromServer",Lr="popTokenGenerateCnf",Dr="handleServerTokenResponse",zr="authorityUpdateMetadataWithRegionalInformation",Fr="regionDiscoveryGetRegionFromIMDS",Br=(e,t,r,n,o)=>(...i)=>{r.trace("1plfzx",o);const s=n.startMeasurement(t,o);if(o){const e=t+"CallCount";n.incrementFields({[e]:1},o)}try{const t=e(...i);return s.end({success:!0}),r.trace("1g8n6a",o),t}catch(e){r.trace("0cfd8i",o);try{r.trace(JSON.stringify(e),o)}catch(e){r.trace("00dty7",o)}throw s.end({success:!1},e),e}},jr=(e,t,r,n,o)=>(...i)=>{r.trace("1plfzx",o);const s=n.startMeasurement(t,o);if(o){const e=t+"CallCount";n.incrementFields({[e]:1},o)}return e(...i).then(e=>(r.trace("1g8n6a",o),s.end({success:!0}),e)).catch(e=>{r.trace("0cfd8i",o);try{r.trace(JSON.stringify(e),o)}catch(e){r.trace("00dty7",o)}throw s.end({success:!1},e),e})};class Kr{constructor(e,t,r,n){this.networkInterface=e,this.logger=t,this.performanceClient=r,this.correlationId=n}async detectRegion(e,t){let r=e;if(r)t.region_source="3";else{const e=Kr.IMDS_OPTIONS;try{const n=await jr(this.getRegionFromIMDS.bind(this),Fr,this.logger,this.performanceClient,this.correlationId)("2020-06-01",e);if(200===n.status&&(r=n.body,t.region_source="4"),400===n.status){const n=await jr(this.getCurrentVersion.bind(this),"regionDiscoveryGetCurrentVersion",this.logger,this.performanceClient,this.correlationId)(e);if(!n)return t.region_source="1",null;const o=await jr(this.getRegionFromIMDS.bind(this),Fr,this.logger,this.performanceClient,this.correlationId)(n,e);200===o.status&&(r=o.body,t.region_source="4")}}catch(e){return t.region_source="1",null}}return r||(t.region_source="1"),r||null}async getRegionFromIMDS(e,t){return this.networkInterface.sendGetRequestAsync(`${z}?api-version=${e}&format=text`,t,2e3)}async getCurrentVersion(e){try{const t=await this.networkInterface.sendGetRequestAsync(`${z}?format=json`,e);return 400===t.status&&t.body&&t.body["newest-versions"]&&t.body["newest-versions"].length>0?t.body["newest-versions"][0]:null}catch(e){return null}}}function $r(e,t){const r=function(e){if(!e)throw p("null_or_empty_token");const t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);if(!t||t.length<4)throw p(f);return t[2]}(e);try{const e=t(r);return JSON.parse(e)}catch(e){throw p(f)}}function Wr(e){if(!e.signin_state)return!1;const t=["kmsi","dvc_dmjd"];return e.signin_state.some(e=>t.includes(e.trim().toLowerCase()))}function Jr(e,t){if(0===t||Date.now()-3e5>e+t)throw p("max_age_transpired")}function Vr(){return Math.round((new Date).getTime()/1e3)}function Gr(e){return e.getTime()/1e3}function Qr(e){return e?new Date(1e3*Number(e)):new Date}function Xr(e,t){const r=Number(e)||0;return Vr()+t>r}function Yr(e,t){const r=Number(e)+24*t*60*60*1e3;return Date.now()>r}function Zr(e,t,r,n,o){return{credentialType:ce.ID_TOKEN,homeAccountId:e,environment:t,clientId:n,secret:r,realm:o,lastUpdatedAt:Date.now().toString()}}function en(e,t,r,n,o,i,s,a,c,l,h,d,u){const g={homeAccountId:e,credentialType:ce.ACCESS_TOKEN,secret:r,cachedAt:Vr().toString(),expiresOn:s.toString(),extendedExpiresOn:a.toString(),environment:t,clientId:n,realm:o,target:i,tokenType:h||ve.BEARER,lastUpdatedAt:Date.now().toString()};if(d&&(g.userAssertionHash=d),l&&(g.refreshOn=l.toString()),g.tokenType?.toLowerCase()!==ve.BEARER.toLowerCase())switch(g.credentialType=ce.ACCESS_TOKEN_WITH_AUTH_SCHEME,g.tokenType){case ve.POP:const e=$r(r,c);if(!e?.cnf?.kid)throw p("token_claims_cnf_required_for_signedjwt");g.keyId=e.cnf.kid;break;case ve.SSH:g.keyId=u}return g}function tn(e){return e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("credentialType")&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("secret")}function rn(e){return!!e&&tn(e)&&e.hasOwnProperty("realm")&&e.hasOwnProperty("target")&&(e.credentialType===ce.ACCESS_TOKEN||e.credentialType===ce.ACCESS_TOKEN_WITH_AUTH_SCHEME)}function nn(e){return!!e&&tn(e)&&e.credentialType===ce.REFRESH_TOKEN}function on(){return Vr()+86400}function sn(e,t,r){e.authorization_endpoint=t.authorization_endpoint,e.token_endpoint=t.token_endpoint,e.end_session_endpoint=t.end_session_endpoint,e.issuer=t.issuer,e.endpointsFromNetwork=r,e.jwks_uri=t.jwks_uri}function an(e,t,r){e.aliases=t.aliases,e.preferred_cache=t.preferred_cache,e.preferred_network=t.preferred_network,e.aliasesFromNetwork=r}function cn(e){return e.expiresAt<=Vr()}Kr.IMDS_OPTIONS={headers:{Metadata:"true"}},r(64583).Promise;class ln{constructor(e,t,r,n,o,i,s,a){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=r,this.authorityOptions=n,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=o,this.performanceClient=s,this.correlationId=i,this.managedIdentity=a||!1,this.regionDiscovery=new Kr(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(q))return 3;const t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case"adfs":return 1;case"dstsv2":return 2}return 0}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new Ar(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw p(y)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw p(y)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw p(y)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw p("end_session_endpoint_not_supported");return this.replacePath(this.metadata.end_session_endpoint)}throw p(y)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw p(y)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw p(y)}canReplaceTenant(e){return 1===e.PathSegments.length&&!ln.reservedTenantDomains.has(e.PathSegments[0])&&0===this.getAuthorityType(e)&&this.protocolMode!==Or}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e;const r=new Ar(this.metadata.canonical_authority).getUrlComponents(),n=r.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((e,o)=>{let i=n[o];if(0===o&&this.canReplaceTenant(r)){const e=new Ar(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];i!==e&&(this.logger.verbose("1q3g2x",this.correlationId),i=e)}e!==i&&(t=t.replace(`/${i}/`,`/${e}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){const e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||1===this.authorityType||this.protocolMode===Or&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){const e=this.getCurrentMetadataEntity(),t=await jr(this.updateCloudDiscoveryMetadata.bind(this),"authorityUpdateCloudDiscoveryMetadata",this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);const r=await jr(this.updateEndpointMetadata.bind(this),"authorityUpdateEndpointMetadata",this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:r}),this.performanceClient?.addFields({cloudDiscoverySource:t,authorityEndpointSource:r},this.correlationId)}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort,this.correlationId);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:on(),jwks_uri:""}),e}updateCachedMetadata(e,t,r){t!==ge&&r?.source!==ge&&(e.expiresAt=on(),e.canonical_authority=this.canonicalAuthority);const n=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache,this.correlationId);this.cacheManager.setAuthorityMetadata(n,e,this.correlationId),this.metadata=e}async updateEndpointMetadata(e){const t=this.updateEndpointMetadataFromLocalSources(e);if(t)return t.source===me&&this.authorityOptions.azureRegionConfiguration?.azureRegion&&t.metadata&&(sn(e,await jr(this.updateMetadataWithRegionalInformation.bind(this),zr,this.logger,this.performanceClient,this.correlationId)(t.metadata),!1),e.canonical_authority=this.canonicalAuthority),t.source;let r=await jr(this.getEndpointMetadataFromNetwork.bind(this),"authorityGetEndpointMetadataFromNetwork",this.logger,this.performanceClient,this.correlationId)();if(r)return this.authorityOptions.azureRegionConfiguration?.azureRegion&&(r=await jr(this.updateMetadataWithRegionalInformation.bind(this),zr,this.logger,this.performanceClient,this.correlationId)(r)),sn(e,r,!0),pe;throw p("openid_config_error",this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("1fi0kc",this.correlationId);const t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("06t0uj",this.correlationId),sn(e,t,!1),{source:ue};this.logger.verbose("151k0p",this.correlationId);const r=this.getEndpointMetadataFromHardcodedValues();if(r)return sn(e,r,!1),{source:me,metadata:r};this.logger.verbose("1imop5",this.correlationId);const n=cn(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!n?(this.logger.verbose("16uq31",""),{source:ge}):(n&&this.logger.verbose("0uoibc",""),null)}isAuthoritySameType(e){return new Ar(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch(e){throw wr("invalid_authority_metadata")}return null}async getEndpointMetadataFromNetwork(){const e={},t=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose("1y65x6",this.correlationId);try{const r=await this.networkInterface.sendGetRequestAsync(t,e),n=function(e){return e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("jwks_uri")}(r.body);return n?r.body:(this.logger.verbose("1koyv8",this.correlationId),null)}catch(e){return this.logger.verbose("0a9wik",this.correlationId),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in _r?_r[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(e){const t=this.authorityOptions.azureRegionConfiguration?.azureRegion;if(t){if("TryAutoDetect"!==t)return this.regionDiscoveryMetadata.region_outcome="2",this.regionDiscoveryMetadata.region_used=t,ln.replaceWithRegionalInformation(e,t);const r=await jr(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),"regionDiscoveryDetectRegion",this.logger,this.performanceClient,this.correlationId)(this.authorityOptions.azureRegionConfiguration?.environmentRegion,this.regionDiscoveryMetadata);if(r)return this.regionDiscoveryMetadata.region_outcome="4",this.regionDiscoveryMetadata.region_used=r,ln.replaceWithRegionalInformation(e,r);this.regionDiscoveryMetadata.region_outcome="5"}return e}async updateCloudDiscoveryMetadata(e){const t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;const r=await jr(this.getCloudDiscoveryMetadataFromNetwork.bind(this),"authorityGetCloudDiscoveryMetadataFromNetwork",this.logger,this.performanceClient,this.correlationId)();if(r)return an(e,r,!0),pe;throw wr("untrusted_authority")}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("0jhlgt",this.correlationId),this.logger.verbosePii("1fy7uz",this.correlationId),this.logger.verbosePii("08zabj",this.correlationId),this.logger.verbosePii("1o1kv3",this.correlationId);const t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("1nakio",this.correlationId),an(e,t,!1),ue;this.logger.verbose("1x74aj",this.correlationId);const r=(n=this.hostnameAndPort,Er(Pr.metadata,n));var n;if(r)return this.logger.verbose("0by47c",this.correlationId),an(e,r,!1),me;this.logger.verbose("0r2fzy",this.correlationId);const o=cn(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!o?(this.logger.verbose("1uffgh",""),ge):(o&&this.logger.verbose("0uoibc",""),null)}getCloudDiscoveryMetadataFromConfig(){if(3===this.authorityType)return this.logger.verbose("04y84h",this.correlationId),ln.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("0gszr3",this.correlationId);try{this.logger.verbose("1iifkx",this.correlationId);const e=Er(JSON.parse(this.authorityOptions.cloudDiscoveryMetadata).metadata,this.hostnameAndPort);if(this.logger.verbose("0q67e3",""),e)return this.logger.verbose("0hzfao",this.correlationId),e;this.logger.verbose("1ajz3u",this.correlationId)}catch(e){throw this.logger.verbose("1wq5tu",this.correlationId),wr(kr)}}return this.isInKnownAuthorities()?(this.logger.verbose("0mt9al",this.correlationId),ln.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){const e=`${M}${this.canonicalAuthority}oauth2/v2.0/authorize`,t={};let r=null;try{const n=await this.networkInterface.sendGetRequestAsync(e,t);let o,i;if(function(e){return e.hasOwnProperty("tenant_discovery_endpoint")&&e.hasOwnProperty("metadata")}(n.body))o=n.body,i=o.metadata,this.logger.verbosePii("1vglyt",this.correlationId);else{if(!function(e){return e.hasOwnProperty("error")&&e.hasOwnProperty("error_description")}(n.body))return this.logger.error("0768g0",this.correlationId),null;if(this.logger.warning("062uto",this.correlationId),o=n.body,"invalid_instance"===o.error)return this.logger.error("1x90tm",this.correlationId),null;this.logger.warning("0wchdm",this.correlationId),this.logger.warning("1s5mpv",this.correlationId),this.logger.warning("1yhqpw",this.correlationId),i=[]}this.logger.verbose("1lrobr",this.correlationId),r=Er(i,this.hostnameAndPort)}catch(e){return e instanceof d?this.logger.error("0vwhc7",this.correlationId):this.logger.error("0s2z41",this.correlationId),null}return r||(this.logger.warning("0jp28q",this.correlationId),this.logger.verbose("130sd8",this.correlationId),r=ln.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),r}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(e=>e&&Ar.getDomainFromUrl(e).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let r;if(t&&t.azureCloudInstance!==qr){const e=t.tenant?t.tenant:O;r=`${t.azureCloudInstance}/${e}/`}return r||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return"login.microsoftonline.com";if(this.discoveryComplete())return this.metadata.preferred_cache;throw p(y)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return Rr.has(e)}static isPublicCloudAuthority(e){return F.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,r){const n=new Ar(e);n.validateAsUri();const o=n.getUrlComponents();let i=`${t}.${o.HostNameAndPort}`;this.isPublicCloudAuthority(o.HostNameAndPort)&&(i=`${t}.login.microsoft.com`);const s=Ar.constructAuthorityUriFromObject({...n.getUrlComponents(),HostNameAndPort:i}).urlString;return r?`${s}?${r}`:s}static replaceWithRegionalInformation(e,t){const r={...e};return r.authorization_endpoint=ln.buildRegionalAuthorityString(r.authorization_endpoint,t),r.token_endpoint=ln.buildRegionalAuthorityString(r.token_endpoint,t),r.end_session_endpoint&&(r.end_session_endpoint=ln.buildRegionalAuthorityString(r.end_session_endpoint,t)),r}static transformCIAMAuthority(e){let t=e;const r=new Ar(e).getUrlComponents();return 0===r.PathSegments.length&&r.HostNameAndPort.endsWith(q)&&(t=`${t}${r.HostNameAndPort.split(".")[0]}.onmicrosoft.com`),t}}function hn(e){return e.endsWith("/")?e:`${e}/`}ln.reservedTenantDomains=new Set(["{tenant}","{tenantid}",X,Z,Y]);const dn="no_tokens_found",un="refresh_token_expired",gn="ux_not_allowed",pn="bad_token",mn=["interaction_required","consent_required","login_required",pn,gn],fn=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token","ux_not_allowed"];class yn extends d{constructor(e,t,r,n,o,i,s,a){super(e,t,r),Object.setPrototypeOf(this,yn.prototype),this.timestamp=n||"",this.traceId=o||"",this.correlationId=i||"",this.claims=s||"",this.name="InteractionRequiredAuthError",this.errorNo=a}}function wn(e,t,r){const n=!!e&&mn.indexOf(e)>-1,o=!!r&&fn.indexOf(r)>-1,i=!!t&&mn.some(e=>t.indexOf(e)>-1);return n||i||o}function vn(e,t){return new yn(e,t)}function Cn(e,t){if(!e)throw p("client_info_empty_error");try{const r=t(e);return JSON.parse(r)}catch(e){throw p(m)}}function In(e){if(!e)throw p(m);const t=e.split(".",2);return{uid:t[0],utid:t.length<2?"":t[1]}}function bn(e,t){return!!e&&!!t&&e===t.split(".")[1]}function kn(e,t,r,n){if(n){const{oid:t,sub:r,tid:o,name:i,tfp:s,acr:a,preferred_username:c,upn:l,login_hint:h}=n,d=o||s||a||"";return{tenantId:d,localAccountId:t||r||"",name:i,username:c||l||"",loginHint:h,isHomeTenant:bn(d,e)}}return{tenantId:r,localAccountId:t,username:"",isHomeTenant:bn(r,e)}}function Tn(e,t,r,n){let o=e;if(t){const{isHomeTenant:r,...n}=t;o={...e,...n}}if(r){const{isHomeTenant:t,...i}=kn(e.homeAccountId,e.localAccountId,e.tenantId,r);return o={...o,...i,idTokenClaims:r,idToken:n},o}return o}function An(e){return e&&(e.tid||e.tfp||e.acr)||null}function Sn(e){const t=e.tenantProfiles||[];return 0===t.length&&e.realm&&e.localAccountId&&t.push(kn(e.homeAccountId,e.localAccountId,e.realm)),{homeAccountId:e.homeAccountId,environment:e.environment,tenantId:e.realm,username:e.username,localAccountId:e.localAccountId,loginHint:e.loginHint,name:e.name,nativeAccountId:e.nativeAccountId,authorityType:e.authorityType,tenantProfiles:new Map(t.map(e=>[e.tenantId,e])),dataBoundary:e.dataBoundary}}function _n(e,t,r,n,o,i){if(1!==t&&2!==t){if(e)try{const t=Cn(e,n.base64Decode);if(t.uid&&t.utid)return`${t.uid}.${t.utid}`}catch(e){}r.warning("1ub6wv",o)}return i?.sub||""}function Pn(e,t,r){return{clientId:e,authority:t.authority,scopes:t.scopes,homeAccountIdentifier:r,claims:t.claims,authenticationScheme:t.authenticationScheme,resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,sshKid:t.sshKid,embeddedClientId:t.embeddedClientId||t.extraParameters?.clientId}}const Rn="acquireTokenRedirect";class xn{constructor(e){const t=e?vr.trimArrayEntries([...e]):[],r=t?vr.removeEmptyStringsFromArray(t):[];if(!r||!r.length)throw wr("empty_input_scopes_error");this.scopes=new Set,r.forEach(e=>this.scopes.add(e))}static fromString(e){const t=(e||"").split(" ");return new xn(t)}static createSearchScopes(e){const t=e&&e.length>0?e:[...j],r=new xn(t);return r.containsOnlyOIDCScopes()?r.removeScope(H):r.removeOIDCScopes(),r}containsScope(e){const t=this.printScopesLowerCase().split(" "),r=new xn(t);return!!e&&r.scopes.has(e.toLowerCase())}containsScopeSet(e){return!(!e||e.scopes.size<=0)&&this.scopes.size>=e.scopes.size&&e.asArray().every(e=>this.containsScope(e))}containsOnlyOIDCScopes(){let e=0;return K.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(e=>this.appendScope(e))}catch(e){throw p("cannot_append_scopeset")}}removeScope(e){if(!e)throw p("cannot_remove_empty_scope");this.scopes.delete(e.trim())}removeOIDCScopes(){K.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw p(I);const t=new Set;return e.scopes.forEach(e=>t.add(e.toLowerCase())),this.scopes.forEach(e=>t.add(e.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw p(I);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();const t=this.unionScopeSets(e),r=e.getScopeCount(),n=this.getScopeCount();return t.size<n+r}getScopeCount(){return this.scopes.size}asArray(){const e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):""}printScopesLowerCase(){return this.printScopes().toLowerCase()}}const En="@azure/msal-common",On="16.0.3",Mn="cache_quota_exceeded";class qn extends Error{constructor(e,t){const r=t||h(e);super(r),Object.setPrototypeOf(this,qn.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=r}}function Nn(e){return e instanceof Error?"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name||e.message.includes("exceeded the quota")?new qn(Mn):new qn(e.name,e.message):new qn("cache_error_unknown")}class Un{constructor(e,t,r,n,o){this.clientId=e,this.cryptoImpl=t,this.commonLogger=r.clone(En,On),this.staticAuthorityOptions=o,this.performanceClient=n}getAllAccounts(e={},t){return this.buildTenantProfiles(this.getAccountsFilteredBy(e,t),t,e)}getAccountInfoFilteredBy(e,t){const r=this.getAllAccounts(e,t);return r.length>1?r.sort(e=>e.idTokenClaims?-1:1)[0]:1===r.length?r[0]:null}getBaseAccountInfo(e,t){const r=this.getAccountsFilteredBy(e,t);return r.length>0?Sn(r[0]):null}buildTenantProfiles(e,t,r){return e.flatMap(e=>this.getTenantProfilesFromAccountEntity(e,t,r?.tenantId,r))}getTenantedAccountInfoByFilter(e,t,r,n,o){let i,s=null;if(o&&!this.tenantProfileMatchesFilter(r,o))return null;const a=this.getIdToken(e,n,t,r.tenantId);return a&&(i=$r(a.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(i,o))?null:(s=Tn(e,r,i,a?.secret),s)}getTenantProfilesFromAccountEntity(e,t,r,n){const o=Sn(e);let i=o.tenantProfiles||new Map;const s=this.getTokenKeys();if(r){const e=i.get(r);if(!e)return[];i=new Map([[r,e]])}const a=[];return i.forEach(e=>{const r=this.getTenantedAccountInfoByFilter(o,s,e,t,n);r&&a.push(r)}),a}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||void 0!==t.isHomeTenant&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){if(t){if(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId))return!1;if(t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint))return!1;if(t.username&&!this.matchUsername(e.preferred_username,t.username))return!1;if(t.name&&!this.matchName(e,t.name))return!1;if(t.sid&&!this.matchSid(e,t.sid))return!1}return!0}async saveCacheRecord(e,t,r,n,o){if(!e)throw p("invalid_cache_record");try{e.account&&await this.setAccount(e.account,t,r,n),e.idToken&&!1!==o?.idToken&&await this.setIdTokenCredential(e.idToken,t,r),e.accessToken&&!1!==o?.accessToken&&await this.saveAccessToken(e.accessToken,t,r),e.refreshToken&&!1!==o?.refreshToken&&await this.setRefreshTokenCredential(e.refreshToken,t,r),e.appMetadata&&this.setAppMetadata(e.appMetadata,t)}catch(e){throw this.commonLogger?.error("0j476p",t),e instanceof d?e:Nn(e)}}async saveAccessToken(e,t,r){const n={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType},o=this.getTokenKeys(),i=xn.fromString(e.target);o.accessToken.forEach(e=>{if(!this.accessTokenKeyMatchesFilter(e,n,!1))return;const r=this.getAccessTokenCredential(e,t);r&&this.credentialMatchesFilter(r,n,t)&&xn.fromString(r.target).intersectingScopeSets(i)&&this.removeAccessToken(e,t)}),await this.setAccessTokenCredential(e,t,r)}getAccountsFilteredBy(e,t){const r=this.getAccountKeys(),n=[];return r.forEach(r=>{const o=this.getAccount(r,t);if(!o)return;if(e.homeAccountId&&!this.matchHomeAccountId(o,e.homeAccountId))return;if(e.username&&!this.matchUsername(o.username,e.username))return;if(e.environment&&!this.matchEnvironment(o,e.environment,t))return;if(e.realm&&!this.matchRealm(o,e.realm))return;if(e.nativeAccountId&&!this.matchNativeAccountId(o,e.nativeAccountId))return;if(e.authorityType&&!this.matchAuthorityType(o,e.authorityType))return;const i={localAccountId:e?.localAccountId,name:e?.name},s=o.tenantProfiles?.filter(e=>this.tenantProfileMatchesFilter(e,i));s&&0===s.length||n.push(o)}),n}credentialMatchesFilter(e,t,r){if(t.clientId&&!this.matchClientId(e,t.clientId))return!1;if(t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash))return!1;if("string"==typeof t.homeAccountId&&!this.matchHomeAccountId(e,t.homeAccountId))return!1;if(t.environment&&!this.matchEnvironment(e,t.environment,r))return!1;if(t.realm&&!this.matchRealm(e,t.realm))return!1;if(t.credentialType&&!this.matchCredentialType(e,t.credentialType))return!1;if(t.familyId&&!this.matchFamilyId(e,t.familyId))return!1;if(t.target&&!this.matchTarget(e,t.target))return!1;if(e.credentialType===ce.ACCESS_TOKEN_WITH_AUTH_SCHEME){if(t.tokenType&&!this.matchTokenType(e,t.tokenType))return!1;if(t.tokenType===ve.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId))return!1}return!0}getAppMetadataFilteredBy(e,t){const r=this.getKeys(),n={};return r.forEach(r=>{if(!this.isAppMetadata(r))return;const o=this.getAppMetadata(r,t);o&&(e.environment&&!this.matchEnvironment(o,e.environment,t)||e.clientId&&!this.matchClientId(o,e.clientId)||(n[r]=o))}),n}getAuthorityMetadataByAlias(e,t){const r=this.getAuthorityMetadataKeys();let n=null;return r.forEach(r=>{if(!this.isAuthorityMetadata(r)||-1===r.indexOf(this.clientId))return;const o=this.getAuthorityMetadata(r,t);o&&-1!==o.aliases.indexOf(e)&&(n=o)}),n}removeAllAccounts(e){this.getAllAccounts({},e).forEach(t=>{this.removeAccount(t,e)})}removeAccount(e,t){this.removeAccountContext(e,t),this.getAccountKeys().filter(t=>t.includes(e.homeAccountId)&&t.includes(e.environment)).forEach(e=>{this.removeItem(e,t),this.performanceClient.incrementFields({accountsRemoved:1},t)})}removeAccountContext(e,t){const r=this.getTokenKeys(),n=t=>t.includes(e.homeAccountId)&&t.includes(e.environment);r.idToken.filter(n).forEach(e=>{this.removeIdToken(e,t)}),r.accessToken.filter(n).forEach(e=>{this.removeAccessToken(e,t)}),r.refreshToken.filter(n).forEach(e=>{this.removeRefreshToken(e,t)})}removeAccessToken(e,t){const r=this.getAccessTokenCredential(e,t);if(r&&(this.removeItem(e,t),this.performanceClient.incrementFields({accessTokensRemoved:1},t),r.credentialType.toLowerCase()===ce.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()&&r.tokenType===ve.POP)){const e=r.keyId;e&&this.cryptoImpl.removeTokenBindingKey(e,t).catch(()=>{this.commonLogger.error("0cx291",t),this.performanceClient?.incrementFields({removeTokenBindingKeyFailure:1},t)})}}removeAppMetadata(e){return this.getKeys().forEach(t=>{this.isAppMetadata(t)&&this.removeItem(t,e)}),!0}getIdToken(e,t,r,n){this.commonLogger.trace("1drz22",t);const o={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:ce.ID_TOKEN,clientId:this.clientId,realm:n},i=this.getIdTokensByFilter(o,t,r),s=i.size;if(s<1)return this.commonLogger.info("1atvtd",t),null;if(s>1){let r=i;if(!n){const n=new Map;i.forEach((t,r)=>{t.realm===e.tenantId&&n.set(r,t)});const o=n.size;if(o<1)return this.commonLogger.info("0ooalx",t),i.values().next().value;if(1===o)return this.commonLogger.info("1eq2vc",t),n.values().next().value;r=n}return this.commonLogger.info("1ws328",t),r.forEach((e,r)=>{this.removeIdToken(r,t)}),this.performanceClient.addFields({multiMatchedID:i.size},t),null}return this.commonLogger.info("1sm769",t),i.values().next().value}getIdTokensByFilter(e,t,r){const n=r&&r.idToken||this.getTokenKeys().idToken,o=new Map;return n.forEach(r=>{if(!this.idTokenKeyMatchesFilter(r,{clientId:this.clientId,...e}))return;const n=this.getIdTokenCredential(r,t);n&&this.credentialMatchesFilter(n,e,t)&&o.set(r,n)}),o}idTokenKeyMatchesFilter(e,t){const r=e.toLowerCase();return!(t.clientId&&-1===r.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===r.indexOf(t.homeAccountId.toLowerCase()))}removeIdToken(e,t){this.removeItem(e,t)}removeRefreshToken(e,t){this.removeItem(e,t)}getAccessToken(e,t,r,n){const o=t.correlationId;this.commonLogger.trace("1t7hz1",o);const i=xn.createSearchScopes(t.scopes),s=t.authenticationScheme||ve.BEARER,a=s&&s.toLowerCase()!==ve.BEARER.toLowerCase()?ce.ACCESS_TOKEN_WITH_AUTH_SCHEME:ce.ACCESS_TOKEN,c={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:a,clientId:this.clientId,realm:n||e.tenantId,target:i,tokenType:s,keyId:t.sshKid},l=r&&r.accessToken||this.getTokenKeys().accessToken,h=[];l.forEach(e=>{if(this.accessTokenKeyMatchesFilter(e,c,!0)){const t=this.getAccessTokenCredential(e,o);t&&this.credentialMatchesFilter(t,c,o)&&h.push(t)}});const d=h.length;return d<1?(this.commonLogger.info("1nckna",o),null):d>1?(this.commonLogger.info("1wkfwp",o),h.forEach(e=>{this.removeAccessToken(this.generateCredentialKey(e),o)}),this.performanceClient.addFields({multiMatchedAT:h.length},o),null):(this.commonLogger.info("06yt98",o),h[0])}accessTokenKeyMatchesFilter(e,t,r){const n=e.toLowerCase();if(t.clientId&&-1===n.indexOf(t.clientId.toLowerCase()))return!1;if(t.homeAccountId&&-1===n.indexOf(t.homeAccountId.toLowerCase()))return!1;if(t.realm&&-1===n.indexOf(t.realm.toLowerCase()))return!1;if(t.target){const e=t.target.asArray();for(let t=0;t<e.length;t++){if(r&&!n.includes(e[t].toLowerCase()))return!1;if(!r&&n.includes(e[t].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e,t){const r=this.getTokenKeys(),n=[];return r.accessToken.forEach(r=>{if(!this.accessTokenKeyMatchesFilter(r,e,!0))return;const o=this.getAccessTokenCredential(r,t);o&&this.credentialMatchesFilter(o,e,t)&&n.push(o)}),n}getRefreshToken(e,t,r,n){this.commonLogger.trace("0x53vi",r);const o=t?he:void 0,i={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:ce.REFRESH_TOKEN,clientId:this.clientId,familyId:o},s=n&&n.refreshToken||this.getTokenKeys().refreshToken,a=[];s.forEach(e=>{if(this.refreshTokenKeyMatchesFilter(e,i)){const t=this.getRefreshTokenCredential(e,r);t&&this.credentialMatchesFilter(t,i,r)&&a.push(t)}});const c=a.length;return c<1?(this.commonLogger.info("0dlw11",r),null):(c>1&&this.performanceClient.addFields({multiMatchedRT:c},r),this.commonLogger.info("0wcnep",r),a[0])}refreshTokenKeyMatchesFilter(e,t){const r=e.toLowerCase();return!(t.familyId&&-1===r.indexOf(t.familyId.toLowerCase())||!t.familyId&&t.clientId&&-1===r.indexOf(t.clientId.toLowerCase())||t.homeAccountId&&-1===r.indexOf(t.homeAccountId.toLowerCase()))}readAppMetadataFromCache(e,t){const r={environment:e,clientId:this.clientId},n=this.getAppMetadataFilteredBy(r,t),o=Object.keys(n).map(e=>n[e]),i=o.length;if(i<1)return null;if(i>1)throw p("multiple_matching_appMetadata");return o[0]}isAppMetadataFOCI(e,t){const r=this.readAppMetadataFromCache(e,t);return!(!r||r.familyId!==he)}matchHomeAccountId(e,t){return!("string"!=typeof e.homeAccountId||t!==e.homeAccountId)}matchLocalAccountIdFromTokenClaims(e,t){return t===(e.oid||e.sub)}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){return!(t.toLowerCase()!==e.name?.toLowerCase())}matchUsername(e,t){return!(!e||"string"!=typeof e||t?.toLowerCase()!==e.toLowerCase())}matchUserAssertionHash(e,t){return!(!e.userAssertionHash||t!==e.userAssertionHash)}matchEnvironment(e,t,r){if(this.staticAuthorityOptions){const n=function(e,t,r){let n;const o=e.canonicalAuthority;if(o){const i=new Ar(o).getUrlComponents().HostNameAndPort;n=xr(t,r,i,e.cloudDiscoveryMetadata?.metadata)||xr(t,r,i,Pr.metadata)||e.knownAuthorities}return n||[]}(this.staticAuthorityOptions,this.commonLogger,r);if(n.includes(t)&&n.includes(e.environment))return!0}const n=this.getAuthorityMetadataByAlias(t,r);return!!(n&&n.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!(!e.clientId||t!==e.clientId)}matchFamilyId(e,t){return!(!e.familyId||t!==e.familyId)}matchRealm(e,t){return!(e.realm?.toLowerCase()!==t.toLowerCase())}matchNativeAccountId(e,t){return!(!e.nativeAccountId||t!==e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!(!e.authorityType||t.toLowerCase()!==e.authorityType.toLowerCase())}matchTarget(e,t){return!(e.credentialType!==ce.ACCESS_TOKEN&&e.credentialType!==ce.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target)&&xn.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!(!e.tokenType||e.tokenType!==t)}matchKeyId(e,t){return!(!e.keyId||e.keyId!==t)}isAppMetadata(e){return-1!==e.indexOf(le)}isAuthorityMetadata(e){return-1!==e.indexOf(de)}generateAuthorityMetadataCacheKey(e){return`${de}-${this.clientId}-${e}`}static toObject(e,t){for(const r in t)e[r]=t[r];return e}}class Hn extends Un{async setAccount(){throw p(P)}getAccount(){throw p(P)}async setIdTokenCredential(){throw p(P)}getIdTokenCredential(){throw p(P)}async setAccessTokenCredential(){throw p(P)}getAccessTokenCredential(){throw p(P)}async setRefreshTokenCredential(){throw p(P)}getRefreshTokenCredential(){throw p(P)}setAppMetadata(){throw p(P)}getAppMetadata(){throw p(P)}setServerTelemetry(){throw p(P)}getServerTelemetry(){throw p(P)}setAuthorityMetadata(){throw p(P)}getAuthorityMetadata(){throw p(P)}getAuthorityMetadataKeys(){throw p(P)}setThrottlingCache(){throw p(P)}getThrottlingCache(){throw p(P)}removeItem(){throw p(P)}getKeys(){throw p(P)}getAccountKeys(){throw p(P)}getTokenKeys(){throw p(P)}generateCredentialKey(){throw p(P)}generateAccountKey(){throw p(P)}}const Ln="msal",Dn="browser",zn=`${Ln}.${Dn}.log.level`,Fn=`${Ln}.${Dn}.log.pii`,Bn=`${Ln}.${Dn}.platform.auth.dom`,jn=`${Ln}.version`,Kn="account.keys",$n="token.keys";function Wn(e=2){return e<1?`${Ln}.${Kn}`:`${Ln}.${e}.${Kn}`}function Jn(e,t=2){return t<1?`${Ln}.${$n}.${e}`:`${Ln}.${t}.${$n}.${e}`}class Vn extends d{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,Vn.prototype)}}function Gn(e){return new Vn(e,Ke(e))}var Qn=r(64583).Promise;const Xn="None";class Yn{initialize(){return Qn.resolve()}getItem(e){const t=`${encodeURIComponent(e)}`,r=document.cookie.split(";");for(let e=0;e<r.length;e++){const n=r[e],[o,...i]=decodeURIComponent(n).trim().split("="),s=i.join("=");if(o===t)return s}return""}getUserData(){throw p(P)}setItem(e,t,r,n=!0,o="Lax"){let i=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=${o};`;if(r){const e=function(e){const t=new Date;return new Date(t.getTime()+864e5*e).toUTCString()}(r);i+=`expires=${e};`}(n||o===Xn)&&(i+="Secure;"),document.cookie=i}async setUserData(){return Qn.reject(p(P))}removeItem(e){this.setItem(e,"",-1)}getKeys(){const e=document.cookie.split(";"),t=[];return e.forEach(e=>{const r=decodeURIComponent(e).trim().split("=");t.push(r[0])}),t}containsKey(e){return this.getKeys().includes(e)}decryptData(){return Qn.resolve(null)}}function Zn(e,t){const r=e.getItem(Wn(t));return r?JSON.parse(r):[]}function eo(e,t,r){const n=t.getItem(Jn(e,r));if(n){const e=JSON.parse(n);if(e&&e.hasOwnProperty("idToken")&&e.hasOwnProperty("accessToken")&&e.hasOwnProperty("refreshToken"))return e}return{idToken:[],accessToken:[],refreshToken:[]}}function to(e){return e.hasOwnProperty("id")&&e.hasOwnProperty("nonce")&&e.hasOwnProperty("data")}const ro="storage_not_supported";var no=r(64583).Promise;const oo="msal.cache.encryption";class io{constructor(e,t,r){if(!window.localStorage)throw Gn(ro);this.memoryStorage=new ur,this.initialized=!1,this.clientId=e,this.logger=t,this.performanceClient=r,this.broadcast=new BroadcastChannel("msal.broadcast.cache")}async initialize(e){const t=new Yn,r=t.getItem(oo);let n={key:"",id:""};if(r)try{n=JSON.parse(r)}catch(e){}if(n.key&&n.id){const t=Br(ut,"base64Decode",this.logger,this.performanceClient,e)(n.key);this.encryptionCookie={id:n.id,key:await jr(ir,He,this.logger,this.performanceClient,e)(t)}}else{const r=er(),n=await jr(or,"generateBaseKey",this.logger,this.performanceClient,e)(),o=Br(Fe,"urlEncodeArr",this.logger,this.performanceClient,e)(new Uint8Array(n));this.encryptionCookie={id:r,key:await jr(ir,He,this.logger,this.performanceClient,e)(n)};const i={id:r,key:o};t.setItem(oo,JSON.stringify(i),0,!0,Xn)}await jr(this.importExistingCache.bind(this),"importExistingCache",this.logger,this.performanceClient,e)(e),this.broadcast.addEventListener("message",t=>{this.updateCache(t,e)}),this.initialized=!0}getItem(e){return window.localStorage.getItem(e)}getUserData(e){if(!this.initialized)throw We(ct);return this.memoryStorage.getItem(e)}async decryptData(e,t,r){if(!this.initialized||!this.encryptionCookie)throw We(ct);if(t.id!==this.encryptionCookie.id)return this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},r),null;const n=await jr(cr,Le,this.logger,this.performanceClient,r)(this.encryptionCookie.key,t.nonce,this.getContext(e),t.data);if(!n)return null;try{return{...JSON.parse(n),lastUpdatedAt:t.lastUpdatedAt}}catch(e){return this.performanceClient.incrementFields({encryptedCacheCorruptionCount:1},r),null}}setItem(e,t){window.localStorage.setItem(e,t)}async setUserData(e,t,r,n,o){if(!this.initialized||!this.encryptionCookie)throw We(ct);if(o)this.setItem(e,t);else{const{data:o,nonce:i}=await jr(ar,"encrypt",this.logger,this.performanceClient,r)(this.encryptionCookie.key,t,this.getContext(e)),s={id:this.encryptionCookie.id,nonce:i,data:o,lastUpdatedAt:n};this.setItem(e,JSON.stringify(s))}this.memoryStorage.setItem(e,t),this.broadcast.postMessage({key:e,value:t,context:this.getContext(e)})}removeItem(e){this.memoryStorage.containsKey(e)&&(this.memoryStorage.removeItem(e),this.broadcast.postMessage({key:e,value:null,context:this.getContext(e)})),window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}clear(){this.memoryStorage.clear(),Zn(this).forEach(e=>this.removeItem(e));const e=eo(this.clientId,this);e.idToken.forEach(e=>this.removeItem(e)),e.accessToken.forEach(e=>this.removeItem(e)),e.refreshToken.forEach(e=>this.removeItem(e)),this.getKeys().forEach(e=>{(e.startsWith(Ln)||-1!==e.indexOf(this.clientId))&&this.removeItem(e)})}async importExistingCache(e){if(!this.encryptionCookie)return;let t=Zn(this);t=await this.importArray(t,e),t.length?this.setItem(Wn(),JSON.stringify(t)):this.removeItem(Wn());const r=eo(this.clientId,this);r.idToken=await this.importArray(r.idToken,e),r.accessToken=await this.importArray(r.accessToken,e),r.refreshToken=await this.importArray(r.refreshToken,e),r.idToken.length||r.accessToken.length||r.refreshToken.length?this.setItem(Jn(this.clientId),JSON.stringify(r)):this.removeItem(Jn(this.clientId))}async getItemFromEncryptedCache(e,t){if(!this.encryptionCookie)return null;const r=this.getItem(e);if(!r)return null;let n;try{n=JSON.parse(r)}catch(e){return null}return to(n)?n.id!==this.encryptionCookie.id?(this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},t),null):(this.performanceClient.incrementFields({encryptedCacheCount:1},t),jr(cr,Le,this.logger,this.performanceClient,t)(this.encryptionCookie.key,n.nonce,this.getContext(e),n.data)):(this.performanceClient.incrementFields({unencryptedCacheCount:1},t),r)}async importArray(e,t){const r=[],n=[];return e.forEach(e=>{const o=this.getItemFromEncryptedCache(e,t).then(t=>{t?(this.memoryStorage.setItem(e,t),r.push(e)):this.removeItem(e)});n.push(o)}),await no.all(n),r}getContext(e){let t="";return e.includes(this.clientId)&&(t=this.clientId),t}updateCache(e,t){this.logger.trace("17cxcm",t);const r=this.performanceClient.startMeasurement("localStorageUpdated");r.add({isBackground:!0});const{key:n,value:o,context:i}=e.data;return n?i&&i!==this.clientId?(this.logger.trace("04rtdy",t),void r.end({success:!1,errorCode:"contextMismatch"})):(o?(this.memoryStorage.setItem(n,o),this.logger.verbose("1vzsgt",t)):(this.memoryStorage.removeItem(n),this.logger.verbose("04ypih",t)),void r.end({success:!0})):(this.logger.error("0e10qr",t),void r.end({success:!1,errorCode:"noKey"}))}}var so=r(64583).Promise;class ao{constructor(){if(!window.sessionStorage)throw Gn(ro)}async initialize(){}getItem(e){return window.sessionStorage.getItem(e)}getUserData(e){return this.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}decryptData(){return so.resolve(null)}}const co="msal:initializeEnd",lo="msal:activeAccountChanged",ho="msal:loginSuccess",uo="msal:acquireTokenStart",go="msal:acquireTokenSuccess",po="msal:acquireTokenFailure",mo="msal:handleRedirectEnd",fo="msal:popupOpened",yo="msal:logoutStart",wo="msal:logoutSuccess",vo="msal:logoutFailure",Co="msal:logoutEnd";function Io(e,t){if(!e)throw p(A);if(!t)throw p(w);try{const r=t.split("|"),n=r[0],o=r.length>1?r.slice(1).join("|"):"",i=e(n);return{userRequestState:o||"",libraryState:JSON.parse(i)}}catch(e){throw p(w)}}function bo(e){if(!e)return e;let t=e.toLowerCase();return vr.endsWith(t,"?")?t=t.slice(0,-1):vr.endsWith(t,"?/")&&(t=t.slice(0,-2)),vr.endsWith(t,"/")||(t+="/"),t}function ko(e){return e.startsWith("#/")?e.substring(2):e.startsWith("#")||e.startsWith("?")?e.substring(1):e}function To(e){if(!e||e.indexOf("=")<0)return null;try{const t=ko(e),r=Object.fromEntries(new URLSearchParams(t));if(r.code||r.ear_jwe||r.error||r.error_description||r.state)return r}catch(e){throw p("hash_not_deserialized")}return null}function Ao(e){const t=new Array;return e.forEach((e,r)=>{t.push(`${r}=${encodeURIComponent(e)}`)}),t.join("&")}function So(e){if(!e)return e;const t=e.split("#")[0];try{const e=new URL(t);return bo(e.origin+e.pathname+e.search)}catch(e){return bo(t)}}const _o="client_id",Po="redirect_uri",Ro="token_type",xo="req_cnf",Eo="return_spa_code",Oo="x-client-xtra-sku",Mo="brk_client_id",qo="brk_redirect_uri",No="instance_aware";function Uo(e,t,r){if(!t)return;const n=e.get(_o);n&&e.has(Mo)&&r?.addFields({embeddedClientId:n,embeddedRedirectUri:e.get(Po)},t)}function Ho(e,t){e.set("response_type",t)}function Lo(e,t,r=!0,n=j){!r||n.includes("openid")||t.includes("openid")||n.push("openid");const o=r?[...t||[],...n]:t||[],i=new xn(o);e.set("scope",i.printScopes())}function Do(e,t){e.set(_o,t)}function zo(e,t){e.set(Po,t)}function Fo(e,t){e.set("login_hint",t)}function Bo(e,t){e.set(J,`UPN:${t}`)}function jo(e,t){e.set(J,`Oid:${t.uid}@${t.utid}`)}function Ko(e,t){e.set("sid",t)}function $o(e,t,r){const n=function(e,t){let r;if(e)try{r=JSON.parse(e)}catch(e){throw wr(Ir)}else r={};return t&&t.length>0&&(r.hasOwnProperty(ee)||(r[ee]={}),r[ee][te]={values:t}),JSON.stringify(r)}(t,r);try{JSON.parse(n)}catch(e){throw wr(Ir)}e.set("claims",n)}function Wo(e,t){e.set("client-request-id",t)}function Jo(e,t){e.set("x-client-SKU",t.sku),e.set("x-client-VER",t.version),t.os&&e.set("x-client-OS",t.os),t.cpu&&e.set("x-client-CPU",t.cpu)}function Vo(e,t){t?.appName&&e.set("x-app-name",t.appName),t?.appVersion&&e.set("x-app-ver",t.appVersion)}function Go(e,t){t&&e.set("state",t)}function Qo(e,t,r){if(!t||!r)throw wr(br);e.set("code_challenge",t),e.set("code_challenge_method",r)}function Xo(e,t){e.set("client_secret",t)}function Yo(e,t){t&&e.set("client_assertion",t)}function Zo(e,t){t&&e.set("client_assertion_type",t)}function ei(e,t){e.set("grant_type",t)}function ti(e){e.set("client_info","1")}function ri(e){e.has(No)||e.set(No,"true")}function ni(e,t){Object.entries(t).forEach(([t,r])=>{!e.has(t)&&r&&e.set(t,r)})}function oi(e,t){t&&(e.set(Ro,ve.POP),e.set(xo,t))}function ii(e,t){t&&(e.set(Ro,ve.SSH),e.set(xo,t))}function si(e,t){e.set("x-client-current-telemetry",t.generateCurrentRequestHeaderValue()),e.set("x-client-last-telemetry",t.generateLastRequestHeaderValue())}function ai(e){e.set("x-ms-lib-capability","retry-after, h429")}function ci(e,t,r){e.has(Mo)||e.set(Mo,t),e.has(qo)||e.set(qo,r)}var li=r(64583).Promise;function hi(e){e.location.hash="","function"==typeof e.history.replaceState&&e.history.replaceState(null,"",`${e.location.origin}${e.location.pathname}${e.location.search}`)}function di(){return window.parent!==window}let ui=null;async function gi(e,t,r,n){return new li((o,i)=>{t.verbose("1rf6em",n.correlationId);const{libraryState:s}=Io(r.base64Decode,n.state||""),a=new BroadcastChannel(s.id);let c;const l=window.setTimeout(()=>{ui=null,a.close(),i(We(ht,"redirect_bridge_timeout"))},e);ui={timeoutId:l,channel:a,reject:i},a.onmessage=e=>{c=e.data.payload,ui=null,clearTimeout(l),a.close(),c?o(c):i(We("redirect_bridge_empty_response"))}})}function pi(){return"undefined"!=typeof window&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function mi(){if("undefined"==typeof window)throw We(tt)}function fi(e){if(!e)throw We(ct)}function yi(e){mi(),function(){if(To(window.location.hash)&&di())throw We("block_iframe_reload")}(),function(){if(function(){if(di())return!1;try{const{libraryState:e}=function(){const e=window.location.hash,t=window.location.search;let r,n=!1,o=!1,i="";if(e&&e.length>1){const t="#"===e.charAt(0)?e.substring(1):e,o=new URLSearchParams(t);o.has("state")&&(n=!0,i=t,r=o)}if(t&&t.length>1){const e="?"===t.charAt(0)?t.substring(1):t,n=new URLSearchParams(e);n.has("state")&&(o=!0,i=e,r=n)}if(n&&o&&(i=`${"?"===t.charAt(0)?t.substring(1):t}${"#"===e.charAt(0)?e.substring(1):e}`,r=new URLSearchParams(i)),!i||!r)throw We("empty_response");const s=r.get("state");if(!s)throw We(Xe);const{libraryState:a}=Io(dt,s),{id:c,meta:l}=a;if(!c||!l)throw We(Ye,"missing_library_state");return{params:r,payload:i,urlHash:e,urlQuery:t,hasResponseInHash:n,hasResponseInQuery:o,libraryState:{id:c,meta:l}}}(),{meta:t}=e;return t.interactionType===Ut.Popup}catch(e){return!1}}())throw We("block_nested_popups")}(),fi(e)}function wi(e,t){if(yi(e),function(e){if(di()&&!e)throw We("redirect_in_iframe")}(t.system.allowRedirectInIframe),t.cache.cacheLocation===bt)throw Gn("in_mem_redirect_unavailable")}function vi(e){const t=document.createElement("link");t.rel="preconnect",t.href=new URL(e).origin,t.crossOrigin="anonymous",document.head.appendChild(t),window.setTimeout(()=>{try{document.head.removeChild(t)}catch{}},1e4)}function Ci(){return er()}const Ii="5.1.0";function bi(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}class ki extends Un{constructor(e,t,r,n,o,i,s){super(e,r,n,o,s),this.cacheConfig=t,this.logger=n,this.internalStorage=new ur,this.browserStorage=Ti(e,t.cacheLocation,n,o),this.temporaryCacheStorage=Ti(e,It,n,o),this.cookieStorage=new Yn,this.eventHandler=i}async initialize(e){this.performanceClient.addFields({cacheLocation:this.cacheConfig.cacheLocation,cacheRetentionDays:this.cacheConfig.cacheRetentionDays},e),await this.browserStorage.initialize(e),await this.migrateExistingCache(e),this.trackVersionChanges(e)}async migrateExistingCache(e){let t=Zn(this.browserStorage),r=eo(this.clientId,this.browserStorage);this.performanceClient.addFields({preMigrateAcntCount:t.length,preMigrateATCount:r.accessToken.length,preMigrateITCount:r.idToken.length,preMigrateRTCount:r.refreshToken.length},e);for(let t=0;t<2;t++){const r=t;await this.removeStaleAccounts(t,r,e)}for(let t=0;t<2;t++){const r=t;await this.migrateIdTokens(t,r,e)}const n=this.getKMSIValues();for(let t=0;t<2;t++)await this.migrateAccessTokens(t,n,e),await this.migrateRefreshTokens(t,n,e);t=Zn(this.browserStorage),r=eo(this.clientId,this.browserStorage),this.performanceClient.addFields({postMigrateAcntCount:t.length,postMigrateATCount:r.accessToken.length,postMigrateITCount:r.idToken.length,postMigrateRTCount:r.refreshToken.length},e)}async updateOldEntry(e,t){const r=this.browserStorage.getItem(e),n=this.validateAndParseJson(r||"");if(!n)return this.browserStorage.removeItem(e),null;if(n.lastUpdatedAt){if(Yr(n.lastUpdatedAt,this.cacheConfig.cacheRetentionDays))return this.browserStorage.removeItem(e),this.performanceClient.incrementFields({expiredCacheRemovedCount:1},t),null}else n.lastUpdatedAt=Date.now().toString(),this.setItem(e,JSON.stringify(n),t);const o=to(n)?await this.browserStorage.decryptData(e,n,t):n;return o&&tn(o)?(rn(o)||nn(o))&&o.expiresOn&&Xr(o.expiresOn,300)?(this.browserStorage.removeItem(e),this.performanceClient.incrementFields({expiredCacheRemovedCount:1},t),null):o:(this.performanceClient.incrementFields({invalidCacheCount:1},t),null)}async removeStaleAccounts(e,t,r){const n=Zn(this.browserStorage,e);if(0!==n.length){for(const e of[...n]){this.performanceClient.incrementFields({oldAcntCount:1},r);const o=this.browserStorage.getItem(e),i=this.validateAndParseJson(o||"");i?i.lastUpdatedAt?Yr(i.lastUpdatedAt,this.cacheConfig.cacheRetentionDays)&&(await this.removeAccountOldSchema(e,i,t,r),bi(n,e)):(i.lastUpdatedAt=Date.now().toString(),this.setItem(e,JSON.stringify(i),r)):bi(n,e)}this.setAccountKeys(n,r,e)}}async removeAccountOldSchema(e,t,r,n){const o=to(t)?await this.browserStorage.decryptData(e,t,n):t,i=o?.homeAccountId;if(i){const e=this.getTokenKeys(r);[...e.idToken].filter(e=>e.includes(i)).forEach(t=>{this.browserStorage.removeItem(t),bi(e.idToken,t)}),[...e.accessToken].filter(e=>e.includes(i)).forEach(t=>{this.browserStorage.removeItem(t),bi(e.accessToken,t)}),[...e.refreshToken].filter(e=>e.includes(i)).forEach(t=>{this.browserStorage.removeItem(t),bi(e.refreshToken,t)}),this.setTokenKeys(e,n,r)}this.performanceClient.incrementFields({expiredAcntRemovedCount:1},n),this.browserStorage.removeItem(e)}getKMSIValues(){const e={},t=this.getTokenKeys().idToken;for(const r of t){const t=this.browserStorage.getUserData(r);if(t){const r=JSON.parse(t),n=$r(r.secret,dt);n&&(e[r.homeAccountId]=Wr(n))}}return e}async migrateIdTokens(e,t,r){const n=eo(this.clientId,this.browserStorage,e);if(0===n.idToken.length)return;const o=eo(this.clientId,this.browserStorage,2),i=Zn(this.browserStorage),s=Zn(this.browserStorage,t);for(const e of[...n.idToken]){this.performanceClient.incrementFields({oldITCount:1},r);const t=await this.updateOldEntry(e,r);if(!t){bi(n.idToken,e);continue}const a=i.find(e=>e.includes(t.homeAccountId)),c=s.find(e=>e.includes(t.homeAccountId));let l=null;if(a)l=this.getAccount(a,r);else if(c){const e=this.browserStorage.getItem(c),t=this.validateAndParseJson(e||"");l=t&&to(t)?await this.browserStorage.decryptData(c,t,r):t}if(!l){this.performanceClient.incrementFields({skipITMigrateCount:1},r);continue}const h=$r(t.secret,dt),d=this.generateCredentialKey(t),u=this.getIdTokenCredential(d,r),g=Object.keys(h).includes("signin_state"),p=u&&Object.keys($r(u.secret,dt)||{}).includes("signin_state");if(!u||t.lastUpdatedAt>u.lastUpdatedAt&&(g||!p)){const e=l.tenantProfiles||[],n=An(h)||l.realm;if(n&&!e.find(e=>e.tenantId===n)){const t=kn(l.homeAccountId,l.localAccountId,n,h);e.push(t)}l.tenantProfiles=e;const s=this.generateAccountKey(Sn(l)),a=Wr(h);await this.setUserData(s,JSON.stringify(l),r,l.lastUpdatedAt,a),i.includes(s)||i.push(s),await this.setUserData(d,JSON.stringify(t),r,t.lastUpdatedAt,a),this.performanceClient.incrementFields({migratedITCount:1},r),o.idToken.push(d)}}this.setTokenKeys(n,r,e),this.setTokenKeys(o,r),this.setAccountKeys(i,r)}async migrateAccessTokens(e,t,r){const n=eo(this.clientId,this.browserStorage,e);if(0===n.accessToken.length)return;const o=eo(this.clientId,this.browserStorage,2);for(const e of[...n.accessToken]){this.performanceClient.incrementFields({oldATCount:1},r);const i=await this.updateOldEntry(e,r);if(!i){bi(n.accessToken,e);continue}if(!(i.homeAccountId in t)){this.performanceClient.incrementFields({skipATMigrateCount:1},r);continue}const s=this.generateCredentialKey(i),a=t[i.homeAccountId];if(o.accessToken.includes(s)){const e=this.getAccessTokenCredential(s,r);(!e||i.lastUpdatedAt>e.lastUpdatedAt)&&(await this.setUserData(s,JSON.stringify(i),r,i.lastUpdatedAt,a),this.performanceClient.incrementFields({migratedATCount:1},r))}else await this.setUserData(s,JSON.stringify(i),r,i.lastUpdatedAt,a),this.performanceClient.incrementFields({migratedATCount:1},r),o.accessToken.push(s)}this.setTokenKeys(n,r,e),this.setTokenKeys(o,r)}async migrateRefreshTokens(e,t,r){const n=eo(this.clientId,this.browserStorage,e);if(0===n.refreshToken.length)return;const o=eo(this.clientId,this.browserStorage,2);for(const e of[...n.refreshToken]){this.performanceClient.incrementFields({oldRTCount:1},r);const i=await this.updateOldEntry(e,r);if(!i){bi(n.refreshToken,e);continue}if(!(i.homeAccountId in t)){this.performanceClient.incrementFields({skipRTMigrateCount:1},r);continue}const s=this.generateCredentialKey(i),a=t[i.homeAccountId];if(o.refreshToken.includes(s)){const e=this.getRefreshTokenCredential(s,r);(!e||i.lastUpdatedAt>e.lastUpdatedAt)&&(await this.setUserData(s,JSON.stringify(i),r,i.lastUpdatedAt,a),this.performanceClient.incrementFields({migratedRTCount:1},r))}else await this.setUserData(s,JSON.stringify(i),r,i.lastUpdatedAt,a),this.performanceClient.incrementFields({migratedRTCount:1},r),o.refreshToken.push(s)}this.setTokenKeys(n,r,e),this.setTokenKeys(o,r)}trackVersionChanges(e){const t=this.browserStorage.getItem(jn);t&&(this.logger.info("1wuc87",e),this.performanceClient.addFields({previousLibraryVersion:t},e)),t!==Ii&&this.setItem(jn,Ii,e)}validateAndParseJson(e){if(!e)return null;try{const t=JSON.parse(e);return t&&"object"==typeof t?t:null}catch(e){return null}}setItem(e,t,r){const n=new Array(3).fill(0),o=[];for(let i=0;i<=20;i++)try{if(this.browserStorage.setItem(e,t),i>0)for(let e=0;e<=2;e++){const t=n.slice(0,e).reduce((e,t)=>e+t,0);if(t>=i)break;const s=i>t+n[e]?t+n[e]:i;i>t&&n[e]>0&&this.removeAccessTokenKeys(o.slice(t,s),r,e)}break}catch(s){const a=Nn(s);if(!(a.errorCode===Mn&&i<20))throw a;if(!o.length)for(let r=0;r<=2;r++)if(e===Jn(this.clientId,r)){const e=JSON.parse(t).accessToken;o.push(...e),n[r]=e.length}else{const e=this.getTokenKeys(r).accessToken;o.push(...e),n[r]=e.length}if(o.length<=i)throw a;this.removeAccessToken(o[i],r,!1)}}async setUserData(e,t,r,n,o){const i=new Array(3).fill(0),s=[];for(let a=0;a<=20;a++)try{if(await jr(this.browserStorage.setUserData.bind(this.browserStorage),"setUserData",this.logger,this.performanceClient,r)(e,t,r,n,o),a>0)for(let e=0;e<=2;e++){const t=i.slice(0,e).reduce((e,t)=>e+t,0);if(t>=a)break;const n=a>t+i[e]?t+i[e]:a;a>t&&i[e]>0&&this.removeAccessTokenKeys(s.slice(t,n),r,e)}break}catch(e){const t=Nn(e);if(!(t.errorCode===Mn&&a<20))throw t;if(!s.length)for(let e=0;e<=2;e++){const t=this.getTokenKeys(e).accessToken;s.push(...t),i[e]=t.length}if(s.length<=a)throw t;this.removeAccessToken(s[a],r,!1)}}getAccount(e,t){this.logger.trace("1lfvm6",t);const r=this.browserStorage.getUserData(e);if(!r)return this.removeAccountKeyFromMap(e,t),null;const n=this.validateAndParseJson(r);if(!(n&&(o=n,o&&o.hasOwnProperty("homeAccountId")&&o.hasOwnProperty("environment")&&o.hasOwnProperty("realm")&&o.hasOwnProperty("localAccountId")&&o.hasOwnProperty("username")&&o.hasOwnProperty("authorityType"))))return null;var o;const i=Un.toObject({},n);var s;return this.performanceClient.addFields({accountCachedBy:(s=i.cachedByApiId,"number"==typeof s&&s in Nt?Nt[s]:"unknown")},t),i}async setAccount(e,t,r,n){this.logger.trace("1bz3wr",t);const o=this.generateAccountKey(Sn(e)),i=Date.now().toString();e.lastUpdatedAt=i,e.cachedByApiId=n,await this.setUserData(o,JSON.stringify(e),t,i,r),this.addAccountKeyToMap(o,t),this.performanceClient.addFields({kmsi:r},t)}setAccountKeys(e,t,r=2){0===e.length?this.removeItem(Wn(r)):this.setItem(Wn(r),JSON.stringify(e),t)}getAccountKeys(){return Zn(this.browserStorage)}addAccountKeyToMap(e,t){this.logger.trace("0rb85k",t),this.logger.tracePii("1l9bdo",t);const r=this.getAccountKeys();return-1===r.indexOf(e)?(r.push(e),this.setItem(Wn(),JSON.stringify(r),t),this.logger.verbose("0xia39",t),!0):(this.logger.verbose("0161kk",t),!1)}removeAccountKeyFromMap(e,t){this.logger.trace("1jpigu",t),this.logger.tracePii("1xzspl",t);const r=this.getAccountKeys(),n=r.indexOf(e);n>-1?(r.splice(n,1),this.setAccountKeys(r,t)):this.logger.trace("1dytu2",t)}removeAccount(e,t){const r=this.getActiveAccount(t);r?.homeAccountId===e.homeAccountId&&r?.environment===e.environment&&this.setActiveAccount(null,t),super.removeAccount(e,t),this.removeAccountKeyFromMap(this.generateAccountKey(e),t),this.browserStorage.getKeys().forEach(t=>{t.includes(e.homeAccountId)&&t.includes(e.environment)&&this.browserStorage.removeItem(t)})}removeIdToken(e,t){super.removeIdToken(e,t);const r=this.getTokenKeys(),n=r.idToken.indexOf(e);n>-1&&(this.logger.info("05udv9",t),r.idToken.splice(n,1),this.setTokenKeys(r,t))}removeAccessToken(e,t,r=!0){super.removeAccessToken(e,t),r&&this.removeAccessTokenKeys([e],t)}removeAccessTokenKeys(e,t,r=2){this.logger.trace("17o18n",t);const n=this.getTokenKeys(r);let o=0;if(e.forEach(e=>{const t=n.accessToken.indexOf(e);t>-1&&(n.accessToken.splice(t,1),o++)}),o>0)return this.logger.info("15i5d5",t),void this.setTokenKeys(n,t,r)}removeRefreshToken(e,t){super.removeRefreshToken(e,t);const r=this.getTokenKeys(),n=r.refreshToken.indexOf(e);n>-1&&(this.logger.info("1f4fq3",t),r.refreshToken.splice(n,1),this.setTokenKeys(r,t))}getTokenKeys(e=2){return eo(this.clientId,this.browserStorage,e)}setTokenKeys(e,t,r=2){0!==e.idToken.length||0!==e.accessToken.length||0!==e.refreshToken.length?this.setItem(Jn(this.clientId,r),JSON.stringify(e),t):this.removeItem(Jn(this.clientId,r))}getIdTokenCredential(e,t){const r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("1jukz6",t),this.removeIdToken(e,t),null;const n=this.validateAndParseJson(r);return n&&(o=n)&&tn(o)&&o.hasOwnProperty("realm")&&o.credentialType===ce.ID_TOKEN?(this.logger.trace("01ju66",t),n):(this.logger.trace("1jukz6",t),null);var o}async setIdTokenCredential(e,t,r){this.logger.trace("13hjll",t);const n=this.generateCredentialKey(e),o=Date.now().toString();e.lastUpdatedAt=o,await this.setUserData(n,JSON.stringify(e),t,o,r);const i=this.getTokenKeys();-1===i.idToken.indexOf(n)&&(this.logger.info("07jy92",t),i.idToken.push(n),this.setTokenKeys(i,t))}getAccessTokenCredential(e,t){const r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("0bqvx8",t),this.removeAccessTokenKeys([e],t),null;const n=this.validateAndParseJson(r);return n&&rn(n)?(this.logger.trace("1o81rl",t),n):(this.logger.trace("0bqvx8",t),null)}async setAccessTokenCredential(e,t,r){this.logger.trace("1pondb",t);const n=this.generateCredentialKey(e),o=Date.now().toString();e.lastUpdatedAt=o,await this.setUserData(n,JSON.stringify(e),t,o,r);const i=this.getTokenKeys(),s=i.accessToken.indexOf(n);-1!==s&&i.accessToken.splice(s,1),this.logger.trace("1onhey",t),i.accessToken.push(n),this.setTokenKeys(i,t)}getRefreshTokenCredential(e,t){const r=this.browserStorage.getUserData(e);if(!r)return this.logger.trace("0jlizt",t),this.removeRefreshToken(e,t),null;const n=this.validateAndParseJson(r);return n&&nn(n)?(this.logger.trace("0nokxi",t),n):(this.logger.trace("0jlizt",t),null)}async setRefreshTokenCredential(e,t,r){this.logger.trace("0tcg8d",t);const n=this.generateCredentialKey(e),o=Date.now().toString();e.lastUpdatedAt=o,await this.setUserData(n,JSON.stringify(e),t,o,r);const i=this.getTokenKeys();-1===i.refreshToken.indexOf(n)&&(this.logger.info("0eckjs",t),i.refreshToken.push(n),this.setTokenKeys(i,t))}getAppMetadata(e,t){const r=this.browserStorage.getItem(e);if(!r)return this.logger.trace("1q101h",t),null;const n=this.validateAndParseJson(r);return n&&((o=n)&&0===e.indexOf(le)&&o.hasOwnProperty("clientId")&&o.hasOwnProperty("environment"))?(this.logger.trace("19pvg2",t),n):(this.logger.trace("1q101h",t),null);var o}setAppMetadata(e,t){this.logger.trace("0cyma6",t);const r=function({environment:e,clientId:t}){return[le,e,t].join("-").toLowerCase()}(e);this.setItem(r,JSON.stringify(e),t)}getServerTelemetry(e,t){const r=this.browserStorage.getItem(e);if(!r)return this.logger.trace("0jk19c",t),null;const n=this.validateAndParseJson(r);return n&&function(e,t){const r=0===e.indexOf(ye);let n=!0;return t&&(n=t.hasOwnProperty("failedRequests")&&t.hasOwnProperty("errors")&&t.hasOwnProperty("cacheHits")),r&&n}(e,n)?(this.logger.trace("12jguk",t),n):(this.logger.trace("0jk19c",t),null)}setServerTelemetry(e,t,r){this.logger.trace("1poh61",r),this.setItem(e,JSON.stringify(t),r)}getAuthorityMetadata(e,t){const r=this.internalStorage.getItem(e);if(!r)return this.logger.trace("1r39oe",t),null;const n=this.validateAndParseJson(r);return n&&function(e,t){return!!t&&0===e.indexOf(de)&&t.hasOwnProperty("aliases")&&t.hasOwnProperty("preferred_cache")&&t.hasOwnProperty("preferred_network")&&t.hasOwnProperty("canonical_authority")&&t.hasOwnProperty("authorization_endpoint")&&t.hasOwnProperty("token_endpoint")&&t.hasOwnProperty("issuer")&&t.hasOwnProperty("aliasesFromNetwork")&&t.hasOwnProperty("endpointsFromNetwork")&&t.hasOwnProperty("expiresAt")&&t.hasOwnProperty("jwks_uri")}(e,n)?(this.logger.trace("1ohvk3",t),n):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(e=>this.isAuthorityMetadata(e))}setWrapperMetadata(e,t){this.internalStorage.setItem(Et,e),this.internalStorage.setItem(Ot,t)}getWrapperMetadata(){return[this.internalStorage.getItem(Et)||"",this.internalStorage.getItem(Ot)||""]}setAuthorityMetadata(e,t,r){this.logger.trace("07w8n2",r),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(e){const t=this.generateCacheKey(Q),r=this.browserStorage.getItem(t);if(!r)return this.logger.trace("08gw0e",e),null;const n=this.validateAndParseJson(r);return n?(this.logger.trace("1t3ch7",e),this.getAccountInfoFilteredBy({homeAccountId:n.homeAccountId,localAccountId:n.localAccountId,tenantId:n.tenantId},e)):(this.logger.trace("0me1up",e),null)}setActiveAccount(e,t){const r=this.generateCacheKey(Q);if(e){this.logger.verbose("0rsj80",t);const n={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId};this.setItem(r,JSON.stringify(n),t)}else this.logger.verbose("1bp5z5",t),this.browserStorage.removeItem(r);this.eventHandler.emitEvent(lo)}getThrottlingCache(e,t){const r=this.browserStorage.getItem(e);if(!r)return this.logger.trace("1h4wa6",t),null;const n=this.validateAndParseJson(r);return n&&function(e,t){let r=!1;e&&(r=0===e.indexOf(Ce));let n=!0;return t&&(n=t.hasOwnProperty("throttleTime")),r&&n}(e,n)?(this.logger.trace("0of6n8",t),n):(this.logger.trace("1h4wa6",t),null)}setThrottlingCache(e,t,r){this.logger.trace("0wfgh6",r),this.setItem(e,JSON.stringify(t),r)}getTemporaryCache(e,t,r){const n=r?this.generateCacheKey(e):e,o=this.temporaryCacheStorage.getItem(n);if(!o){if(this.cacheConfig.cacheLocation===Ct){const e=this.browserStorage.getItem(n);if(e)return this.logger.trace("1yt61y",t),e}return this.logger.trace("1qhy81",t),null}return o}setTemporaryCache(e,t,r){const n=r?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(n,t)}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e)}getKeys(){return this.browserStorage.getKeys()}clear(e){this.removeAllAccounts(e),this.removeAppMetadata(e),this.temporaryCacheStorage.getKeys().forEach(e=>{-1===e.indexOf(Ln)&&-1===e.indexOf(this.clientId)||this.removeTemporaryItem(e)}),this.browserStorage.getKeys().forEach(e=>{-1===e.indexOf(Ln)&&-1===e.indexOf(this.clientId)||this.browserStorage.removeItem(e)}),this.internalStorage.clear()}generateCacheKey(e){return vr.startsWith(e,Ln)?e:`${Ln}.${this.clientId}.${e}`}generateCredentialKey(e){const t=e.credentialType===ce.REFRESH_TOKEN&&e.familyId||e.clientId,r=e.tokenType&&e.tokenType.toLowerCase()!==ve.BEARER.toLowerCase()?e.tokenType.toLowerCase():"";return[`${Ln}.2`,e.homeAccountId,e.environment,e.credentialType,t,e.realm||"",e.target||"",r].join("|").toLowerCase()}generateAccountKey(e){const t=e.homeAccountId.split(".")[1];return[`${Ln}.2`,e.homeAccountId,e.environment,t||e.tenantId||""].join("|").toLowerCase()}resetRequestCache(e){this.logger.trace("0h0ynu",e),this.removeTemporaryItem(this.generateCacheKey(_t)),this.removeTemporaryItem(this.generateCacheKey(Pt)),this.removeTemporaryItem(this.generateCacheKey(At)),this.removeTemporaryItem(this.generateCacheKey(St)),this.removeTemporaryItem(this.generateCacheKey(xt)),this.setInteractionInProgress(!1,void 0)}cacheAuthorizeRequest(e,t,r){this.logger.trace("1tzef5",t);const n=Be(JSON.stringify(e));if(this.setTemporaryCache(_t,n,!0),r){const e=Be(r);this.setTemporaryCache(Pt,e,!0)}}getCachedRequest(e){this.logger.trace("0uen20",e);const t=this.getTemporaryCache(_t,e,!0);if(!t)throw We("no_token_request_cache_error");const r=this.getTemporaryCache(Pt,e,!0);let n,o="";try{n=JSON.parse(dt(t)),r&&(o=dt(r))}catch(t){throw this.logger.errorPii("0ewsey",e),this.logger.error("0tvdic",e),We("unable_to_parse_token_request_cache_error")}return[n,o]}getCachedNativeRequest(){this.logger.trace("1yxcdm","");const e=this.getTemporaryCache(xt,"",!0);if(!e)return this.logger.trace("0mnxd4",""),null;return this.validateAndParseJson(e)||(this.logger.error("0rrkip",""),null)}isInteractionInProgress(e){const t=this.getInteractionInProgress()?.clientId;return e?t===this.clientId:!!t}getInteractionInProgress(){const e=`${Ln}.${Rt}`,t=this.getTemporaryCache(e,"",!1);try{return t?JSON.parse(t):null}catch(t){return this.logger.error("0jjyys",""),this.removeTemporaryItem(e),this.resetRequestCache(""),hi(window),null}}setInteractionInProgress(e,t=kt,r=!1,n=""){const o=`${Ln}.${Rt}`;if(e){if(this.getInteractionInProgress()){if(!r)throw We("interaction_in_progress");this.logger.warning("1pmscr",n),function(e,t){ui&&(e.verbose("18y01k",t),clearTimeout(ui.timeoutId),ui.channel.close(),ui.reject(We("interaction_in_progress_cancelled")),ui=null)}(this.logger,n),this.removeTemporaryItem(o)}this.setTemporaryCache(o,JSON.stringify({clientId:this.clientId,type:t}),!1)}else e||this.getInteractionInProgress()?.clientId!==this.clientId||this.removeTemporaryItem(o)}async hydrateCache(e,t){const r={idToken:Zr(e.account.homeAccountId,e.account.environment,e.idToken,this.clientId,e.tenantId),accessToken:en(e.account.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?Gr(e.expiresOn):0,e.extExpiresOn?Gr(e.extExpiresOn):0,dt,void 0,e.tokenType,void 0,t.sshKid)};return this.saveCacheRecord(r,e.correlationId,Wr($r(e.idToken,dt)),963)}async saveCacheRecord(e,t,r,n,o){try{await super.saveCacheRecord(e,t,r,n,o)}catch(e){if(e instanceof qn&&this.performanceClient&&t)try{const e=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:e.refreshToken.length,cacheIdCount:e.idToken.length,cacheAtCount:e.accessToken.length},t)}catch(e){}throw e}}}function Ti(e,t,r,n){try{switch(t){case Ct:return new io(e,r,n);case It:return new ao}}catch(e){r.error(e,"")}return new ur}var Ai;!function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Verbose=3]="Verbose",e[e.Trace=4]="Trace"}(Ai||(Ai={}));const Si=new Map;class _i{constructor(e,t,r){this.level=Ai.Info;const n=e||_i.createDefaultLoggerOptions();this.localCallback=n.loggerCallback||(()=>{}),this.piiLoggingEnabled=n.piiLoggingEnabled||!1,this.level="number"==typeof n.logLevel?n.logLevel:Ai.Info,this.packageName=t||"",this.packageVersion=r||""}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:Ai.Info}}clone(e,t){return new _i({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level},e,t)}logMessage(e,t){const r=t.correlationId;if(function(e){if(6!==e.length)return!1;for(let t=0;t<e.length;t++){const r=e[t];if(!(r>="a"&&r<="z"||r>="A"&&r<="Z"||r>="0"&&r<="9"))return!1}return!0}(e)&&function(e,t){const r=Date.now();let n=Si.get(e);if(n)!function(e,t){Si.delete(e),Si.set(e,t)}(e,n);else if(n={logs:[],firstEventTime:r},Si.set(e,n),Si.size>50){const e=Si.keys().next().value;e&&Si.delete(e)}n.logs.push({...t,milliseconds:r-n.firstEventTime}),n.logs.length>500&&n.logs.shift()}(r,{hash:e,level:t.logLevel,containsPii:t.containsPii||!1,milliseconds:0}),t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;const n=`[${(new Date).toUTCString()}] : [${r}] : ${this.packageName}@${this.packageVersion} : ${Ai[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,n,t.containsPii||!1)}executeCallback(e,t,r){this.localCallback&&this.localCallback(e,t,r)}error(e,t){this.logMessage(e,{logLevel:Ai.Error,containsPii:!1,correlationId:t})}errorPii(e,t){this.logMessage(e,{logLevel:Ai.Error,containsPii:!0,correlationId:t})}warning(e,t){this.logMessage(e,{logLevel:Ai.Warning,containsPii:!1,correlationId:t})}warningPii(e,t){this.logMessage(e,{logLevel:Ai.Warning,containsPii:!0,correlationId:t})}info(e,t){this.logMessage(e,{logLevel:Ai.Info,containsPii:!1,correlationId:t})}infoPii(e,t){this.logMessage(e,{logLevel:Ai.Info,containsPii:!0,correlationId:t})}verbose(e,t){this.logMessage(e,{logLevel:Ai.Verbose,containsPii:!1,correlationId:t})}verbosePii(e,t){this.logMessage(e,{logLevel:Ai.Verbose,containsPii:!0,correlationId:t})}trace(e,t){this.logMessage(e,{logLevel:Ai.Trace,containsPii:!1,correlationId:t})}tracePii(e,t){this.logMessage(e,{logLevel:Ai.Trace,containsPii:!0,correlationId:t})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}class Pi{constructor(e){this.eventCallbacks=new Map,this.logger=e||new _i({}),"undefined"!=typeof BroadcastChannel&&(this.broadcastChannel=new BroadcastChannel("msal.broadcast.event")),this.invokeCrossTabCallbacks=this.invokeCrossTabCallbacks.bind(this)}addEventCallback(e,t,r){if("undefined"!=typeof window){const n=r||Ci();return this.eventCallbacks.has(n)?(this.logger.error("1578i0",""),null):(this.eventCallbacks.set(n,[e,t||[]]),this.logger.verbose("1cnec4",""),n)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose("12zotd","")}emitEvent(e,t,r,n){const o={eventType:e,interactionType:t||null,payload:r||null,error:n||null,timestamp:Date.now()};switch(e){case ho:case wo:case lo:this.broadcastChannel?.postMessage(o)}this.invokeCallbacks(o)}invokeCallbacks(e){this.eventCallbacks.forEach(([t,r],n)=>{(0===r.length||r.includes(e.eventType))&&(this.logger.verbose("15jpwk",""),t.apply(null,[e]))})}invokeCrossTabCallbacks(e){const t=e.data;this.invokeCallbacks(t)}subscribeCrossTab(){this.broadcastChannel?.addEventListener("message",this.invokeCrossTabCallbacks)}unsubscribeCrossTab(){this.broadcastChannel?.removeEventListener("message",this.invokeCrossTabCallbacks)}}new Set(["accessTokenSize","durationMs","idTokenSize","matsSilentStatus","matsHttpStatus","refreshTokenSize","startTimeMs","status","multiMatchedAT","multiMatchedID","multiMatchedRT","unencryptedCacheCount","encryptedCacheExpiredCount","oldAccountCount","oldAccessCount","oldIdCount","oldRefreshCount","currAccountCount","currAccessCount","currIdCount","currRefreshCount","expiredCacheRemovedCount","upgradedCacheCount"]);class Ri{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:1,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""}}}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}const xi={tokenRenewalOffsetSeconds:300,preventCorsPreflight:!1},Ei={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:Ai.Info,correlationId:""},Oi={async sendGetRequestAsync(){throw p(P)},async sendPostRequestAsync(){throw p(P)}},Mi={sku:"msal.js.common",version:On,cpu:"",os:""},qi={clientSecret:"",clientAssertion:void 0},Ni={azureCloudInstance:qr,tenant:`${O}`},Ui={application:{appName:"",appVersion:""}};function Hi({authOptions:e,systemOptions:t,loggerOptions:r,storageInterface:n,networkInterface:o,cryptoInterface:i,clientCredentials:s,libraryInfo:a,telemetry:c,serverTelemetryManager:l,persistencePlugin:h,serializableCache:d}){const u={...Ei,...r};return{authOptions:(g=e,{clientCapabilities:[],azureCloudOptions:Ni,instanceAware:!1,...g}),systemOptions:{...xi,...t},loggerOptions:u,storageInterface:n||new Hn(e.clientId,fr,new _i(u),new Ri),networkInterface:o||Oi,cryptoInterface:i||fr,clientCredentials:s||qi,libraryInfo:{...Mi,...a},telemetry:{...Ui,...c},serverTelemetryManager:l||null,persistencePlugin:h||null,serializableCache:d||null};var g}function Li(e){return e.authOptions.authority.options.protocolMode===Or}class Di extends d{constructor(e,t,r,n,o){super(e,t,r),this.name="ServerError",this.errorNo=n,this.status=o,Object.setPrototypeOf(this,Di.prototype)}}class zi{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}async generateCnf(e,t){const r=await jr(this.generateKid.bind(this),Lr,t,this.performanceClient,e.correlationId)(e),n=this.cryptoUtils.base64UrlEncode(JSON.stringify(r));return{kid:r.kid,reqCnfString:n}}async generateKid(e){return{kid:await this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:"sw"}}async signPopToken(e,t,r){return this.signPayload(e,t,r)}async signPayload(e,t,r,n){const{resourceRequestMethod:o,resourceRequestUri:i,shrClaims:s,shrNonce:a,shrOptions:c}=r,l=i?new Ar(i):void 0,h=l?.getUrlComponents();return this.cryptoUtils.signJwt({at:e,ts:Vr(),m:o?.toUpperCase(),u:h?.HostNameAndPort,nonce:a||this.cryptoUtils.createNewGuid(),p:h?.AbsolutePath,q:h?.QueryString?[[],h.QueryString]:void 0,client_claims:s||void 0,...n},t,c,r.correlationId)}}class Fi{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}class Bi{constructor(e,t,r,n,o,i,s){this.clientId=e,this.cacheStorage=t,this.cryptoObj=r,this.logger=n,this.performanceClient=o,this.serializableCache=i,this.persistencePlugin=s}validateTokenResponse(e,t,r){if(e.error||e.error_description||e.suberror){const n=`Error(s): ${e.error_codes||D} - Timestamp: ${e.timestamp||D} - Description: ${e.error_description||D} - Correlation ID: ${e.correlation_id||D} - Trace ID: ${e.trace_id||D}`,o=e.error_codes?.length?e.error_codes[0]:void 0,i=new Di(e.error,n,e.suberror,o,e.status);if(r&&e.status&&e.status>=500&&e.status<=599)return void this.logger.warning("16ks7j",t);if(r&&e.status&&e.status>=400&&e.status<=499)return void this.logger.warning("0g61x3",t);if(wn(e.error,e.error_description,e.suberror))throw new yn(e.error,e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",o);throw i}}async handleServerTokenResponse(e,t,r,n,o,i,s,a,c,l){let h,d;if(e.id_token){if(h=$r(e.id_token||"",this.cryptoObj.base64Decode),i&&i.nonce&&h.nonce!==i.nonce)throw p("nonce_mismatch");if(n.maxAge||0===n.maxAge){const e=h.auth_time;if(!e)throw p(C);Jr(e,n.maxAge)}}this.homeAccountIdentifier=_n(e.client_info||"",t.authorityType,this.logger,this.cryptoObj,n.correlationId,h),i&&i.state&&(d=Io(this.cryptoObj.base64Decode,i.state)),e.key_id=e.key_id||n.sshKid||void 0;const u=this.generateCacheRecord(e,t,r,n,h,s,i);let g;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("0jbz5k",n.correlationId),g=new Fi(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(g)),a&&!c&&u.account&&this.cacheStorage.getAllAccounts({homeAccountId:u.account.homeAccountId,environment:u.account.environment},n.correlationId).length<1)return this.logger.warning("1gmt66",n.correlationId),this.performanceClient?.addFields({acntLoggedOut:!0},n.correlationId),await Bi.generateAuthenticationResult(this.cryptoObj,t,u,!1,n,this.performanceClient,h,d,void 0,l);await this.cacheStorage.saveCacheRecord(u,n.correlationId,Wr(h||{}),o,n.storeInCache)}finally{this.persistencePlugin&&this.serializableCache&&g&&(this.logger.verbose("1bh17u",n.correlationId),await this.persistencePlugin.afterCacheAccess(g))}return Bi.generateAuthenticationResult(this.cryptoObj,t,u,!1,n,this.performanceClient,h,d,e,l)}generateCacheRecord(e,t,r,n,o,i,s){const a=t.getPreferredCache();if(!a)throw p(k);const c=An(o);let l,h;e.id_token&&o&&(l=Zr(this.homeAccountIdentifier,a,e.id_token,this.clientId,c||""),h=ji(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,n.correlationId,o,e.client_info,a,c,s,void 0,this.logger));let d=null;if(e.access_token){const o=e.scope?xn.fromString(e.scope):new xn(n.scopes||[]),s=("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0,l=("string"==typeof e.ext_expires_in?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,h=("string"==typeof e.refresh_in?parseInt(e.refresh_in,10):e.refresh_in)||void 0,u=r+s,g=u+l,p=h&&h>0?r+h:void 0;d=en(this.homeAccountIdentifier,a,e.access_token,this.clientId,c||t.tenant||"",o.printScopes(),u,g,this.cryptoObj.base64Decode,p,e.token_type,i,e.key_id)}let u=null;if(e.refresh_token){let t;e.refresh_token_expires_in&&(t=r+("string"==typeof e.refresh_token_expires_in?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in),this.performanceClient?.addFields({ntwkRtExpiresOnSeconds:t},n.correlationId)),u=function(e,t,r,n,o,i,s){const a={credentialType:ce.REFRESH_TOKEN,homeAccountId:e,environment:t,clientId:n,secret:r,lastUpdatedAt:Date.now().toString()};return i&&(a.userAssertionHash=i),o&&(a.familyId=o),s&&(a.expiresOn=s.toString()),a}(this.homeAccountIdentifier,a,e.refresh_token,this.clientId,e.foci,i,t)}let g=null;return e.foci&&(g={clientId:this.clientId,environment:a,familyId:e.foci}),{account:h,idToken:l,accessToken:d,refreshToken:u,appMetadata:g}}static async generateAuthenticationResult(e,t,r,n,o,i,s,a,c,l){let h,d,u="",g=[],m=null,f="";if(r.accessToken){if(r.accessToken.tokenType!==ve.POP||o.popKid)u=r.accessToken.secret;else{const t=new zi(e,i),{secret:n,keyId:s}=r.accessToken;if(!s)throw p(_);u=await t.signPopToken(n,s,o)}g=xn.fromString(r.accessToken.target).asArray(),m=Qr(r.accessToken.expiresOn),h=Qr(r.accessToken.extendedExpiresOn),r.accessToken.refreshOn&&(d=Qr(r.accessToken.refreshOn))}r.appMetadata&&(f=r.appMetadata.familyId===he?he:"");const y=s?.oid||s?.sub||"",w=s?.tid||"";c?.spa_accountid&&r.account&&(r.account.nativeAccountId=c?.spa_accountid);const v=r.account?Tn(Sn(r.account),void 0,s,r.idToken?.secret):null;return{authority:t.canonicalAuthority,uniqueId:y,tenantId:w,scopes:g,account:v,idToken:r?.idToken?.secret||"",idTokenClaims:s||{},accessToken:u,fromCache:n,expiresOn:m,extExpiresOn:h,refreshOn:d,correlationId:o.correlationId,requestId:l||"",familyId:f,tokenType:r.accessToken?.tokenType||"",state:a?a.userRequestState:"",cloudGraphHostName:r.account?.cloudGraphHostName||"",msGraphHost:r.account?.msGraphHost||"",code:c?.spa_code,fromPlatformBroker:!1}}}function ji(e,t,r,n,o,i,s,a,c,l,h,d){d?.verbose("09jz0t",o);const u=e.getAccountKeys().find(e=>e.startsWith(r));let g=null;u&&(g=e.getAccount(u,o));const m=g||function(e,t,r){let n,o,i;n=1===t.authorityType?"ADFS":t.protocolMode===Or?ae:"MSSTS",e.clientInfo&&r&&(o=Cn(e.clientInfo,r),o.xms_tdbr&&(i="EU"===o.xms_tdbr?"EU":"None"));const s=e.environment||t&&t.getPreferredCache();if(!s)throw p(k);const a=e.idTokenClaims?.preferred_username||e.idTokenClaims?.upn,c=e.idTokenClaims?.emails?e.idTokenClaims.emails[0]:null,l=a||c||"",h=e.idTokenClaims?.login_hint,d=o?.utid||An(e.idTokenClaims)||"",u=o?.uid||e.idTokenClaims?.oid||e.idTokenClaims?.sub||"";let g;return g=e.tenantProfiles?e.tenantProfiles:[kn(e.homeAccountId,u,d,e.idTokenClaims)],{homeAccountId:e.homeAccountId,environment:s,realm:d,localAccountId:u,username:l,authorityType:n,loginHint:h,clientInfo:e.clientInfo,name:e.idTokenClaims?.name||"",lastModificationTime:void 0,lastModificationApp:void 0,cloudGraphHostName:e.cloudGraphHostName,msGraphHost:e.msGraphHost,nativeAccountId:e.nativeAccountId,tenantProfiles:g,dataBoundary:i}}({homeAccountId:r,idTokenClaims:i,clientInfo:s,environment:a,cloudGraphHostName:l?.cloud_graph_host_name,msGraphHost:l?.msgraph_host,nativeAccountId:h},t,n),f=m.tenantProfiles||[],y=c||m.realm;if(y&&!f.find(e=>e.tenantId===y)){const e=kn(r,m.localAccountId,y,i);f.push(e)}return m.tenantProfiles=f,m}const Ki="home_account_id",$i="UPN";async function Wi(e,t,r){return"string"==typeof e?e:e({clientId:t,tokenEndpoint:r})}class Ji{static generateThrottlingStorageKey(e){return`${Ce}.${JSON.stringify(e)}`}static preProcess(e,t,r){const n=Ji.generateThrottlingStorageKey(t),o=e.getThrottlingCache(n,r);if(o){if(o.throttleTime<Date.now())return void e.removeItem(n,r);throw new Di(o.errorCodes?.join(" ")||"",o.errorMessage,o.subError)}}static postProcess(e,t,r,n){if(Ji.checkResponseStatus(r)||Ji.checkResponseForRetryAfter(r)){const o={throttleTime:Ji.calculateThrottleTime(parseInt(r.headers[W])),error:r.body.error,errorCodes:r.body.error_codes,errorMessage:r.body.error_description,subError:r.body.suberror};e.setThrottlingCache(Ji.generateThrottlingStorageKey(t),o,n)}}static checkResponseStatus(e){return 429===e.status||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return!!e.headers&&e.headers.hasOwnProperty(W)&&(e.status<200||e.status>=300)}static calculateThrottleTime(e){const t=e<=0?0:e,r=Date.now()/1e3;return Math.floor(1e3*Math.min(r+(t||60),r+3600))}static removeThrottle(e,t,r,n){const o=Pn(t,r,n),i=this.generateThrottlingStorageKey(o);e.removeItem(i,r.correlationId)}}class Vi extends d{constructor(e,t,r){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,Vi.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=r}}function Gi(e,t,r,n){return e.errorMessage=`${e.errorMessage}, additionalErrorInfo: error.name:${n?.name}, error.message:${n?.message}`,new Vi(e,t,r)}function Qi(e,t,r){const n={};if(n[$]="application/x-www-form-urlencoded;charset=utf-8",!t&&r)switch(r.type){case Ki:try{const e=In(r.credential);n[J]=`Oid:${e.uid}@${e.utid}`}catch(t){e.verbose("1qhtee","")}break;case $i:n[J]=`UPN: ${r.credential}`}return n}function Xi(e,t,r,n){const o=new Map;return e.embeddedClientId&&ci(o,t,r),e.extraQueryParameters&&ni(o,e.extraQueryParameters),Wo(o,e.correlationId),Uo(o,e.correlationId,n),Ao(o)}async function Yi(e,t,r,n,o,i,s,a,c,l){const h=await async function(e,t,r,n,o,i,s,a){let c;Ji.preProcess(o,e,n);try{c=await jr(i.sendPostRequestAsync.bind(i),"networkClientSendPostRequestAsync",s,a,n)(t,r);const e=c.headers||{};a?.addFields({refreshTokenSize:c.body.refresh_token?.length||0,httpVerToken:e[G]||"",requestId:e[V]||""},n)}catch(e){if(e instanceof Vi){const t=e.responseHeaders;throw t&&a?.addFields({httpVerToken:t[G]||"",requestId:t[V]||"",contentTypeHeader:t[$]||void 0,contentLengthHeader:t["Content-Length"]||void 0,httpStatus:e.httpStatus},n),e.error}throw e instanceof d?e:p("network_error")}return Ji.postProcess(o,e,c,n),c}(n,e,{body:t,headers:r},o,i,s,a,c);return l&&h.status<500&&429!==h.status&&l.clearTelemetryCache(),h}async function Zi(e,t,r,n,o,i,s){const a=ln.transformCIAMAuthority(hn(e)),c=new ln(a,t,r,n,o,i,s);try{return await jr(c.resolveEndpointsAsync.bind(c),"authorityResolveEndpointsAsync",o,s,i)(),c}catch(e){throw p(y)}}class es{constructor(e,t){this.includeRedirectUri=!0,this.config=Hi(e),this.logger=new _i(this.config.loggerOptions,En,On),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t,this.oidcDefaultScopes=this.config.authOptions.authority.options.OIDCOptions?.defaultScopes}async acquireToken(e,t,r){if(!e.code)throw p("request_cannot_be_made");r&&r.cloud_instance_host_name&&await jr(this.updateTokenEndpointAuthority.bind(this),"updateTokenEndpointAuthority",this.logger,this.performanceClient,e.correlationId)(r.cloud_instance_host_name,e.correlationId);const n=Vr(),o=await jr(this.executeTokenRequest.bind(this),"authClientExecuteTokenRequest",this.logger,this.performanceClient,e.correlationId)(this.authority,e,this.serverTelemetryManager),i=o.headers?.[V],s=new Bi(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.performanceClient,this.config.serializableCache,this.config.persistencePlugin);return s.validateTokenResponse(o.body,e.correlationId),jr(s.handleServerTokenResponse.bind(s),Dr,this.logger,this.performanceClient,e.correlationId)(o.body,this.authority,n,e,t,r,void 0,void 0,void 0,i)}getLogoutUri(e){if(!e)throw wr("logout_request_empty");const t=this.createLogoutUrlQueryString(e);return Ar.appendQueryString(this.authority.endSessionEndpoint,t)}async executeTokenRequest(e,t,r){const n=Xi(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri,this.performanceClient),o=Ar.appendQueryString(e.tokenEndpoint,n),i=await jr(this.createTokenRequestBody.bind(this),"authClientCreateTokenRequestBody",this.logger,this.performanceClient,t.correlationId)(t);let s;if(t.clientInfo)try{const e=Cn(t.clientInfo,this.cryptoUtils.base64Decode);s={credential:`${e.uid}.${e.utid}`,type:Ki}}catch(e){this.logger.verbose("0wznt3",t.correlationId)}const a=Qi(this.logger,this.config.systemOptions.preventCorsPreflight,s||t.ccsCredential),c=Pn(this.config.authOptions.clientId,t);return jr(Yi,"authorizationCodeClientExecutePostToTokenEndpoint",this.logger,this.performanceClient,t.correlationId)(o,i,a,c,t.correlationId,this.cacheManager,this.networkClient,this.logger,this.performanceClient,r)}async createTokenRequestBody(e){const t=new Map;if(Do(t,e.embeddedClientId||e.extraParameters?.[_o]||this.config.authOptions.clientId),this.includeRedirectUri)zo(t,e.redirectUri);else if(!e.redirectUri)throw wr("redirect_uri_empty");if(Lo(t,e.scopes,!0,this.oidcDefaultScopes),function(e,t){e.set("code",t)}(t,e.code),Jo(t,this.config.libraryInfo),Vo(t,this.config.telemetry.application),ai(t),this.serverTelemetryManager&&!Li(this.config)&&si(t,this.serverTelemetryManager),e.codeVerifier&&function(e,t){e.set("code_verifier",t)}(t,e.codeVerifier),this.config.clientCredentials.clientSecret&&Xo(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const r=this.config.clientCredentials.clientAssertion;Yo(t,await Wi(r.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),Zo(t,r.assertionType)}if(ei(t,"authorization_code"),ti(t),e.authenticationScheme===ve.POP){const r=new zi(this.cryptoUtils,this.performanceClient);let n;n=e.popKid?this.cryptoUtils.encodeKid(e.popKid):(await jr(r.generateCnf.bind(r),Lr,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,oi(t,n)}else if(e.authenticationScheme===ve.SSH){if(!e.sshJwk)throw wr(Tr);ii(t,e.sshJwk)}let r;if((!vr.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&$o(t,e.claims,this.config.authOptions.clientCapabilities),e.clientInfo)try{const t=Cn(e.clientInfo,this.cryptoUtils.base64Decode);r={credential:`${t.uid}.${t.utid}`,type:Ki}}catch(t){this.logger.verbose("0wznt3",e.correlationId)}else r=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&r)switch(r.type){case Ki:try{jo(t,In(r.credential))}catch(t){this.logger.verbose("1qhtee",e.correlationId)}break;case $i:Bo(t,r.credential)}return e.embeddedClientId&&ci(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.extraParameters&&ni(t,e.extraParameters),!e.enableSpaAuthorizationCode||e.extraParameters&&e.extraParameters[Eo]||ni(t,{[Eo]:"1"}),Uo(t,e.correlationId,this.performanceClient),Ao(t)}createLogoutUrlQueryString(e){const t=new Map;return e.postLogoutRedirectUri&&function(e,t){e.set("post_logout_redirect_uri",t)}(t,e.postLogoutRedirectUri),e.correlationId&&Wo(t,e.correlationId),e.idTokenHint&&function(e,t){e.set("id_token_hint",t)}(t,e.idTokenHint),e.state&&Go(t,e.state),e.logoutHint&&function(e,t){e.set("logout_hint",t)}(t,e.logoutHint),e.extraQueryParameters&&ni(t,e.extraQueryParameters),this.config.authOptions.instanceAware&&ri(t),Ao(t)}async updateTokenEndpointAuthority(e,t){const r=`https://${e}/${this.authority.tenant}/`,n=await Zi(r,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=n}}class ts{constructor(e,t){this.cacheOutcome="0",this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||"",this.wrapperVer=e.wrapperVer||"",this.telemetryCacheKey=ye+"-"+e.clientId}generateCurrentRequestHeaderValue(){const e=`${this.apiId}${we}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],r=this.getNativeBrokerErrorCode();r?.length&&t.push(`broker_error=${r}`);const n=t.join(we),o=[e,this.getRegionDiscoveryFields()].join(we);return[fe,o,n].join("|")}generateLastRequestHeaderValue(){const e=this.getLastRequests(),t=ts.maxErrorsToSend(e),r=e.failedRequests.slice(0,2*t).join(we),n=e.errors.slice(0,t).join(we),o=e.errors.length,i=[o,t<o?"1":"0"].join(we);return[fe,e.cacheHits,r,n,i].join("|")}cacheFailedRequest(e){const t=this.getLastRequests();t.errors.length>=50&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof d?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push("unknown_error"),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}incrementCacheHits(){const e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId),e.cacheHits}getLastRequests(){return this.cacheManager.getServerTelemetry(this.telemetryCacheKey,this.correlationId)||{failedRequests:[],errors:[],cacheHits:0}}clearTelemetryCache(){const e=this.getLastRequests(),t=ts.maxErrorsToSend(e);if(t===e.errors.length)this.cacheManager.removeItem(this.telemetryCacheKey,this.correlationId);else{const r={failedRequests:e.failedRequests.slice(2*t),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,r,this.correlationId)}}static maxErrorsToSend(e){let t,r=0,n=0;const o=e.errors.length;for(t=0;t<o;t++){const o=e.failedRequests[2*t]||"",i=e.failedRequests[2*t+1]||"",s=e.errors[t]||"";if(n+=o.toString().length+i.toString().length+s.length+3,!(n<330))break;r+=1}return r}getRegionDiscoveryFields(){const e=[];return e.push(this.regionUsed||""),e.push(this.regionSource||""),e.push(this.regionOutcome||""),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){const t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){const e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId)}static makeExtraSkuString(e){return function(e){const{skus:t,libraryName:r,libraryVersion:n,extensionName:o,extensionVersion:i}=e,s=new Map([[0,[r,n]],[2,[o,i]]]);let a=[];if(t?.length){if(a=t.split(","),a.length<4)return t}else a=Array.from({length:4},()=>"|");return s.forEach((e,t)=>{2===e.length&&e[0]?.length&&e[1]?.length&&function(e){const{skuArr:t,index:r,skuName:n,skuVersion:o}=e;r>=t.length||(t[r]=[n,o].join("|"))}({skuArr:a,index:t,skuName:e[0],skuVersion:e[1]})}),a.join(",")}(e)}}class rs{constructor(e,t,r,n,o,i,s,a,c){this.config=e,this.browserStorage=t,this.browserCrypto=r,this.networkClient=this.config.system.networkClient,this.eventHandler=o,this.navigationClient=i,this.platformAuthProvider=c,this.correlationId=a,this.logger=n.clone(mt,Ii),this.performanceClient=s}}function ns(e,t,r,n){r.verbose("0bd1la",n);const o=e||t||"";return Ar.getAbsoluteUrl(o,pi())}function os(e,t,r,n,o,i){o.verbose("1p12tq",r);const s={clientId:t,correlationId:r,apiId:e,forceRefresh:!1,wrapperSKU:n.getWrapperMetadata()[0],wrapperVer:n.getWrapperMetadata()[1]};return new ts(s,n)}async function is(e,t,r,n,o,i,s,a,c){const l=a&&a.hasOwnProperty("instance_aware")?a.instance_aware:void 0,h={protocolMode:e.system.protocolMode,OIDCOptions:e.auth.OIDCOptions,knownAuthorities:e.auth.knownAuthorities,cloudDiscoveryMetadata:e.auth.cloudDiscoveryMetadata,authorityMetadata:e.auth.authorityMetadata},d=i||e.auth.authority,u=l?.length?"true"===l:e.auth.instanceAware,g=c&&u?e.auth.authority.replace(Ar.getDomainFromUrl(d),c.environment):d,p=ln.generateAuthority(g,s||e.auth.azureCloudOptions),m=await jr(Zi,"authorityFactoryCreateDiscoveredInstance",o,r,t)(p,e.system.networkClient,n,h,o,t,r);if(c&&!m.isAlias(c.environment))throw wr("authority_mismatch");return m}async function ss(e,t,r,n,o){if(o)try{e.removeAccount(o,n),r.verbose("0s4z6h",n)}catch(e){r.error("0mgg1d",n)}else try{r.verbose("0zj631",n),e.clear(n),await t.clearKeystore(n)}catch(e){r.error("12ih0c",n)}}async function as(e,t,r,n,o){const i=e.authority||t.auth.authority,s=[...e&&e.scopes||[]],a={...e,correlationId:e.correlationId,authority:i,scopes:s};if(a.authenticationScheme){if(a.authenticationScheme===ve.SSH){if(!e.sshJwk)throw wr(Tr);if(!e.sshKid)throw wr("missing_ssh_kid")}n.verbose("1ecmns",o)}else a.authenticationScheme=ve.BEARER,n.verbose("1l4fwv",o);return a}async function cs(e,t,r,n,o){const i=await jr(as,Ae,o,n,e.correlationId)(e,r,n,o,e.correlationId);return{...e,...i,account:t,forceRefresh:e.forceRefresh||!1}}function ls(e,t){let r;const n=e.httpMethod;if(t===Mr){if(n&&n!==B)throw wr("invalid_request_method_for_EAR");r=B}else r=n||"GET";return r}class hs extends rs{initializeLogoutRequest(e){this.logger.verbose("0546u4",this.correlationId);const t={correlationId:this.correlationId,...e};if(e)if(e.logoutHint)this.logger.verbose("12k4l4",this.correlationId);else if(e.account){const r=this.getLogoutHintFromIdTokenClaims(e.account);r&&(this.logger.verbose("0st5di",this.correlationId),t.logoutHint=r)}else this.logger.verbose("0pdtc3",this.correlationId);else this.logger.verbose("07ndze",this.correlationId);return e&&null===e.postLogoutRedirectUri?this.logger.verbose("0ljv63",t.correlationId):e&&e.postLogoutRedirectUri?(this.logger.verbose("1vamm6",t.correlationId),t.postLogoutRedirectUri=Ar.getAbsoluteUrl(e.postLogoutRedirectUri,pi())):null===this.config.auth.postLogoutRedirectUri?this.logger.verbose("15m5g7",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("1f4xlz",t.correlationId),t.postLogoutRedirectUri=Ar.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,pi())):(this.logger.verbose("17s5rf",t.correlationId),t.postLogoutRedirectUri=Ar.getAbsoluteUrl(pi(),pi())),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("0mvp54",this.correlationId)}else this.logger.verbose("1e7bdp",this.correlationId);return null}async createAuthCodeClient(e){const t=await jr(this.getClientConfiguration.bind(this),xe,this.logger,this.performanceClient,this.correlationId)(e);return new es(t,this.performanceClient)}async getClientConfiguration(e){const{serverTelemetryManager:t,requestAuthority:r,requestAzureCloudOptions:n,requestExtraQueryParameters:o,account:i}=e,s=e.authority||await jr(is,be,this.logger,this.performanceClient,this.correlationId)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,r,n,o,i),a=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:s,clientCapabilities:this.config.auth.clientCapabilities,redirectUri:this.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:a.loggerCallback,piiLoggingEnabled:a.piiLoggingEnabled,logLevel:a.logLevel,correlationId:this.correlationId},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:mt,version:Ii,cpu:"",os:""},telemetry:this.config.telemetry}}}async function ds(e,t,r,n,o,i,s,a){const c=ns(e.redirectUri,r.auth.redirectUri,i,a),l={interactionType:t},h=function(e,t,r){const n=function(e,t){if(!e)throw p(A);const r={id:e.createNewGuid()};t&&(r.meta=t);const n=JSON.stringify(r);return e.base64Encode(n)}(e,r);return t?`${n}|${t}`:n}(n,e&&e.state||"",l),d={...await jr(as,Ae,i,s,a)({...e,correlationId:a},r,s,i,a),redirectUri:c,state:h,nonce:e.nonce||er(),responseMode:r.auth.OIDCOptions.responseMode},u={...d,httpMethod:ls(d,r.system.protocolMode)};if(e.loginHint||e.sid)return u;const g=e.account||o.getActiveAccount(a);return g&&(i.verbose("1eqlb3",a),i.verbosePii("0tf99t",a),u.account=g),u}function us(e,t,r,n){const o=To(e);if(!o)throw ko(e)?(r.error("13pl0s",n),r.errorPii("1097vx",n),We("hash_does_not_contain_known_properties")):(r.error("18h0l1",n),We("hash_empty_error"));return o}function gs(e,t){const r=Ao(t);return Ar.appendQueryString(e.authorizationEndpoint,r)}function ps(e,t){if(!e.state||!t)throw e.state?p(v,"Cached State"):p(v,"Server State");let r,n;try{r=decodeURIComponent(e.state)}catch(t){throw p(w,e.state)}try{n=decodeURIComponent(t)}catch(t){throw p(w,e.state)}if(r!==n)throw p("state_mismatch");if(e.error||e.error_description||e.suberror){const t=function(e){const t="code=",r=e.error_uri?.lastIndexOf(t);return r&&r>=0?e.error_uri?.substring(r+5):void 0}(e);if(wn(e.error,e.error_description,e.suberror))throw new yn(e.error||"",e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",t);throw new Di(e.error||"",e.error_description,e.suberror,t)}}class ms{constructor(e,t,r,n,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=n,this.performanceClient=o}async handleCodeResponse(e,t,r){let n;try{n=function(e,t){if(ps(e,t),!e.code)throw p("authorization_code_missing_from_server_response");return e}(e,t.state)}catch(e){throw e instanceof Di&&e.subError===Ze?We(Ze):e}return jr(this.handleCodeResponseFromServer.bind(this),Hr,this.logger,this.performanceClient,t.correlationId)(n,t,r)}async handleCodeResponseFromServer(e,t,r,n=!0){if(this.logger.trace("0mf2hb",t.correlationId),this.authCodeRequest.code=e.code,n&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{const e=this.createCcsCredentials(t);e&&(this.authCodeRequest.ccsCredential=e)}return await jr(this.authModule.acquireToken.bind(this.authModule),"authClientAcquireToken",this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,r,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:Ki}:e.loginHint?{credential:e.loginHint,type:$i}:null}}class fs extends d{constructor(e,t,r){super(e,t||Ke(e)),Object.setPrototypeOf(this,fs.prototype),this.name="NativeAuthError",this.ext=r}}function ys(e){if(e.ext&&e.ext.status&&("PERSISTENT_ERROR"===e.ext.status||"DISABLED"===e.ext.status))return!0;if(e.ext&&e.ext.error&&-2147186943===e.ext.error)return!0;switch(e.errorCode){case"ContentError":case"PageException":return!0;default:return!1}}function ws(e,t,r){if(r&&r.status)switch(r.status){case"ACCOUNT_UNAVAILABLE":return vn("native_account_unavailable",Ke(e));case"USER_INTERACTION_REQUIRED":return new yn(e,t);case"USER_CANCEL":return We(Ze);case"NO_NETWORK":return We(nt);case"UX_NOT_ALLOWED":return vn(gn)}return new fs(e,t,r)}class vs{constructor(e,t){this.config=Hi(e),this.logger=new _i(this.config.loggerOptions,En,On),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}async acquireCachedToken(e){let t="0";if(e.forceRefresh||!vr.isEmptyObj(e.claims))throw this.setCacheOutcome("1",e.correlationId),p(S);if(!e.account)throw p(b);const r=e.account.tenantId||function(e){const t=new Ar(e).getUrlComponents(),r=t.PathSegments.slice(-1)[0]?.toLowerCase();switch(r){case X:case Y:case Z:return;default:return r}}(e.authority),n=this.cacheManager.getTokenKeys(),o=this.cacheManager.getAccessToken(e.account,e,n,r);if(!o)throw this.setCacheOutcome("2",e.correlationId),p(S);if(i=o.cachedAt,Number(i)>Vr()||Xr(o.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome("3",e.correlationId),p(S);var i;o.refreshOn&&Xr(o.refreshOn,0)&&(t="4");const s=e.authority||this.authority.getPreferredCache(),a={account:this.cacheManager.getAccount(this.cacheManager.generateAccountKey(e.account),e.correlationId),accessToken:o,idToken:this.cacheManager.getIdToken(e.account,e.correlationId,n,r),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(s,e.correlationId)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await jr(this.generateResultFromCacheRecord.bind(this),"silentFlowClientGenerateResultFromCacheRecord",this.logger,this.performanceClient,e.correlationId)(a,e),t]}setCacheOutcome(e,t){this.serverTelemetryManager?.setCacheOutcome(e),this.performanceClient?.addFields({cacheOutcome:e},t),"0"!==e&&this.logger.info("09ingz",t)}async generateResultFromCacheRecord(e,t){let r;if(e.idToken&&(r=$r(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||0===t.maxAge){const e=r?.auth_time;if(!e)throw p(C);Jr(e,t.maxAge)}return Bi.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,this.performanceClient,r)}}class Cs extends hs{async acquireToken(e){const t=os(61,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),r=await jr(this.getClientConfiguration.bind(this),xe,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),n=new vs(r,this.performanceClient);this.logger.verbose("0wa871",this.correlationId);try{const t=(await jr(n.acquireCachedToken.bind(n),"silentFlowClientAcquireCachedToken",this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),t}catch(e){throw e instanceof $e&&e.errorCode===it&&this.logger.verbose("06wena",this.correlationId),e}}logout(e){this.logger.verbose("1rkurh",this.correlationId);const t=this.initializeLogoutRequest(e);return ss(this.browserStorage,this.browserCrypto,this.logger,this.correlationId,t.account)}}var Is=r(64583).Promise;class bs extends rs{constructor(e,t,r,n,o,i,s,a,c,l,h,d){super(e,t,r,n,o,i,a,d,c),this.apiId=s,this.accountId=l,this.platformAuthProvider=c,this.nativeStorageManager=h,this.silentCacheClient=new Cs(e,this.nativeStorageManager,r,n,o,i,a,d,c);const u=this.platformAuthProvider.getExtensionName();this.skus=ts.makeExtraSkuString({libraryName:mt,libraryVersion:Ii,extensionName:u,extensionVersion:this.platformAuthProvider.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,[Oo]:this.skus}}async acquireToken(e,t){this.logger.trace("03qeos",this.correlationId);const r=this.performanceClient.startMeasurement(ke,e.correlationId),n=Vr(),o=os(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{const i=await this.initializeNativeRequest(e);try{const e=await this.acquireTokensFromCache(this.accountId,i);return r.end({success:!0,isNativeBroker:!1,fromCache:!0}),e}catch(e){if(1===t)throw this.logger.info("0eitbc",this.correlationId),e;this.logger.info("0957j1",this.correlationId)}const s=await this.platformAuthProvider.sendMessage(i);return await this.handleNativeResponse(s,i,n).then(e=>(r.end({success:!0,isNativeBroker:!0,requestId:e.requestId}),o.clearNativeBrokerErrorCode(),e)).catch(e=>{throw r.end({success:!1,errorCode:e.errorCode,subErrorCode:e.subError,isNativeBroker:!0}),e})}catch(e){throw e instanceof fs&&o.setNativeBrokerErrorCode(e.errorCode),e}}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:xn.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("1ndf3e",this.correlationId),p(T);const r=this.browserStorage.getBaseAccountInfo({nativeAccountId:e},t.correlationId);if(!r)throw p(T);try{const e=this.createSilentCacheRequest(t,r),n=await this.silentCacheClient.acquireToken(e),o={...r,idTokenClaims:n?.idTokenClaims,idToken:n?.idToken};return{...n,account:o}}catch(e){throw e}}async acquireTokenRedirect(e,t,r){this.logger.trace("0luikq",this.correlationId);const n=await this.initializeNativeRequest(e),o=r?.navigateToLoginRequestUrl??!0;try{await this.platformAuthProvider.sendMessage(n)}catch(e){if(e instanceof fs&&(os(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger).setNativeBrokerErrorCode(e.errorCode),ys(e)))throw e}this.browserStorage.setTemporaryCache(xt,JSON.stringify(n),!0);const i={apiId:Mt,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},s=o?window.location.href:ns(e.redirectUri,this.config.auth.redirectUri,this.logger,this.correlationId);t.end({success:!0}),await this.navigationClient.navigateExternal(s,i)}async handleRedirectPromise(e,t){if(this.logger.trace("1c5lhw",this.correlationId),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("0le6uv",this.correlationId),null;const r=this.browserStorage.getCachedNativeRequest();if(!r)return this.logger.verbose("0a6zjb",this.correlationId),e&&t&&e?.addFields({errorCode:"no_cached_request"},t),null;const{prompt:n,...o}=r;n&&this.logger.verbose("0ac34v",this.correlationId),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(xt));const i=Vr();try{this.logger.verbose("003x5a",this.correlationId);const e=await this.platformAuthProvider.sendMessage(o),t=await this.handleNativeResponse(e,o,i);return os(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger).clearNativeBrokerErrorCode(),t}catch(e){throw e}}logout(){return this.logger.trace("0u2sjm",this.correlationId),Is.reject("Logout not implemented yet")}async handleNativeResponse(e,t,r){this.logger.trace("1bojln",this.correlationId);const n=$r(e.id_token,dt),o=this.createHomeAccountIdentifier(e,n),i=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId},this.correlationId)?.homeAccountId;if(t.extraParameters?.child_client_id&&e.account.id!==t.accountId)this.logger.info("1ub1in",this.correlationId);else if(o!==i&&e.account.id!==t.accountId)throw ws("user_switch");const s=await is(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,t.authority),a=ji(this.browserStorage,s,o,dt,this.correlationId,n,e.client_info,void 0,n.tid,void 0,e.account.id);e.expires_in=Number(e.expires_in);const c=await this.generateAuthenticationResult(e,t,n,a,s.canonicalAuthority,r);return await this.cacheAccount(a,Wr(n)),await this.cacheNativeTokens(e,t,o,n,e.access_token,c.tenantId,r),c}createHomeAccountIdentifier(e,t){return _n(e.client_info||"",0,this.logger,this.browserCrypto,this.correlationId,t)}generateScopes(e,t){return t?xn.fromString(t):xn.fromString(e)}async generatePopAccessToken(e,t){if(t.tokenType===ve.POP&&t.signPopToken){if(e.shr)return this.logger.trace("0coqhu",this.correlationId),e.shr;const r=new zi(this.browserCrypto,this.performanceClient),n={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce,correlationId:this.correlationId};if(!t.keyId)throw p(_);return r.signPopToken(e.access_token,t.keyId,n)}return e.access_token}async generateAuthenticationResult(e,t,r,n,o,i){const s=this.addTelemetryFromNativeResponse(e.properties.MATS),a=this.generateScopes(t.scope,e.scope),c=e.account.properties||{},l=c.UID||r.oid||r.sub||"",h=c.TenantId||r.tid||"",d=Tn(Sn(n),void 0,r,e.id_token);d.nativeAccountId!==e.account.id&&(d.nativeAccountId=e.account.id);const u=await this.generatePopAccessToken(e,t),g=t.tokenType===ve.POP?ve.POP:ve.BEARER;return{authority:o,uniqueId:l,tenantId:h,scopes:a.asArray(),account:d,idToken:e.id_token,idTokenClaims:r,accessToken:u,fromCache:!!s&&this.isResponseFromCache(s),expiresOn:Qr(i+e.expires_in),tokenType:g,correlationId:this.correlationId,state:e.state,fromPlatformBroker:!0}}async cacheAccount(e,t){await this.browserStorage.setAccount(e,this.correlationId,t,this.apiId),this.browserStorage.removeAccountContext(Sn(e),this.correlationId)}cacheNativeTokens(e,t,r,n,o,i,s){const a=Zr(r,t.authority,e.id_token||"",t.clientId,n.tid||""),c=s+(t.tokenType===ve.POP?240:("string"==typeof e.expires_in?parseInt(e.expires_in,10):e.expires_in)||0),l=this.generateScopes(e.scope,t.scope),h={idToken:a,accessToken:en(r,t.authority,o,t.clientId,n.tid||i,l.printScopes(),c,0,dt,void 0,t.tokenType,void 0,t.keyId)};return this.nativeStorageManager.saveCacheRecord(h,this.correlationId,Wr(n),this.apiId,t.storeInCache)}getExpiresInValue(e,t){return e===ve.POP?240:("string"==typeof t?parseInt(t,10):t)||0}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.platformAuthProvider.getExtensionId(),extensionVersion:this.platformAuthProvider.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}getMATSFromResponse(e){if(e)try{return JSON.parse(e)}catch(e){this.logger.error("0b3l57",this.correlationId)}return null}isResponseFromCache(e){return void 0===e.is_cached?(this.logger.verbose("1okqev",this.correlationId),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("04j6wj",this.correlationId);const t=await this.getCanonicalAuthority(e),{scopes:r,...n}=e,o=new xn(r||[]);o.appendScopes(j);const i={...n,accountId:this.accountId,clientId:this.config.auth.clientId,authority:t.urlString,scope:o.printScopes(),redirectUri:ns(e.redirectUri,this.config.auth.redirectUri,this.logger,this.correlationId),prompt:this.getPrompt(e.prompt),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraParameters},extendedExpiryToken:!1,keyId:e.popKid};if(i.signPopToken&&e.popKid)throw We("invalid_pop_token_request");if(this.handleExtraBrokerParams(i),i.extraParameters=i.extraParameters||{},i.extraParameters.telemetry="MATS",e.authenticationScheme===ve.POP){const t={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce,correlationId:this.correlationId},r=new zi(this.browserCrypto,this.performanceClient);let n;if(i.keyId)n=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:i.keyId})),i.signPopToken=!1;else{const e=await jr(r.generateCnf.bind(r),Lr,this.logger,this.performanceClient,this.correlationId)(t,this.logger);n=e.reqCnfString,i.keyId=e.kid,i.signPopToken=!0}i.reqCnf=n}return this.addRequestSKUs(i),i}async getCanonicalAuthority(e){const t=e.authority||this.config.auth.authority,{azureCloudOptions:r,account:n}=e;n&&await is(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,t,r,void 0,n);const o=new Ar(t);return o.validateAsUri(),o}getPrompt(e){switch(this.apiId){case 863:case 61:return this.logger.trace("1hiwaz",this.correlationId),oe}if(e)switch(e){case oe:case ne:case re:return this.logger.trace("1ynje4",this.correlationId),e;default:throw this.logger.trace("0nkr6q",this.correlationId),We("native_prompt_not_supported")}else this.logger.trace("1qlu04",this.correlationId)}handleExtraBrokerParams(e){const t=e.extraParameters&&e.extraParameters.hasOwnProperty(Mo)&&e.extraParameters.hasOwnProperty(qo)&&e.extraParameters.hasOwnProperty(_o);if(!e.embeddedClientId&&!t)return;let r="";const n=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,r=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[qo],r=e.extraParameters[_o]),e.extraParameters={child_client_id:r,child_redirect_uri:n},this.performanceClient?.addFields({embeddedClientId:r,embeddedRedirectUri:n},e.correlationId)}}async function ks(e,t,r,n,o){const i=function(e,t,r,n){const o=t.correlationId,i=new Map;if(Do(i,t.embeddedClientId||t.extraQueryParameters?.[_o]||e.clientId),Lo(i,[...t.scopes||[],...t.extraScopesToConsent||[]],!0,e.authority.options.OIDCOptions?.defaultScopes),zo(i,t.redirectUri),Wo(i,o),function(e,t){e.set("response_mode",t||se)}(i,t.responseMode),ti(i),t.prompt&&(function(e,t){e.set("prompt",t)}(i,t.prompt),n?.addFields({prompt:t.prompt},o)),t.domainHint&&(function(e,t){e.set("domain_hint",t)}(i,t.domainHint),n?.addFields({domainHintFromRequest:!0},o)),"select_account"!==t.prompt)if(t.sid&&t.prompt===oe)r.verbose("1tvqyx",t.correlationId),Ko(i,t.sid),n?.addFields({sidFromRequest:!0},o);else if(t.account){const e=(s=t.account,s.idTokenClaims?.sid||null);let a=function(e){return e.loginHint||e.idTokenClaims?.login_hint||null}(t.account);if(a&&t.domainHint&&(r.warning("0wkg3v",t.correlationId),a=null),a){r.verbose("1eyfsw",t.correlationId),Fo(i,a),n?.addFields({loginHintFromClaim:!0},o);try{jo(i,In(t.account.homeAccountId))}catch(e){r.verbose("12ugck",t.correlationId)}}else if(e&&t.prompt===oe){r.verbose("1rmd8s",t.correlationId),Ko(i,e),n?.addFields({sidFromClaim:!0},o);try{jo(i,In(t.account.homeAccountId))}catch(e){r.verbose("12ugck",t.correlationId)}}else if(t.loginHint)r.verbose("0y3007",t.correlationId),Fo(i,t.loginHint),Bo(i,t.loginHint),n?.addFields({loginHintFromRequest:!0},o);else if(t.account.username){r.verbose("02f507",t.correlationId),Fo(i,t.account.username),n?.addFields({loginHintFromUpn:!0},o);try{jo(i,In(t.account.homeAccountId))}catch(e){r.verbose("12ugck",t.correlationId)}}}else t.loginHint&&(r.verbose("0g01ey",t.correlationId),Fo(i,t.loginHint),Bo(i,t.loginHint),n?.addFields({loginHintFromRequest:!0},o));else r.verbose("169k9v",t.correlationId);var s;return t.nonce&&function(e,t){e.set("nonce",t)}(i,t.nonce),t.state&&Go(i,t.state),(t.claims||e.clientCapabilities&&e.clientCapabilities.length>0)&&$o(i,t.claims,e.clientCapabilities),t.embeddedClientId&&ci(i,e.clientId,e.redirectUri),!e.instanceAware||t.extraQueryParameters&&Object.keys(t.extraQueryParameters).includes(No)||ri(i),i}({...e.auth,authority:t},r,n,o);if(Jo(i,{sku:mt,version:Ii,os:"",cpu:""}),e.system.protocolMode!==Or&&Vo(i,e.telemetry.application),r.platformBroker&&(function(e){e.set("nativebroker","1")}(i),r.authenticationScheme===ve.POP)){const e=new pr(n,o),t=new zi(e,o);let s;s=r.popKid?e.encodeKid(r.popKid):(await jr(t.generateCnf.bind(t),Lr,n,o,r.correlationId)(r,n)).reqCnfString,oi(i,s)}return Uo(i,r.correlationId,o),i}async function Ts(e,t,r,n,o){if(!r.codeChallenge)throw wr(br);const i=await jr(ks,"getStandardParams",n,o,r.correlationId)(e,t,r,n,o);return Ho(i,ie),Qo(i,r.codeChallenge,L),ni(i,{...r.extraQueryParameters,...r.extraParameters}),gs(t,i)}async function As(e,t,r,n,o,i){if(!n.earJwk)throw We(Ve);const s=await ks(t,r,n,o,i);Ho(s,"id_token token refresh_token"),function(e,t){e.set("ear_jwk",encodeURIComponent(t)),e.set("ear_jwe_crypto","eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0")}(s,n.earJwk),Qo(s,n.codeChallenge,L),ni(s,{...n.extraParameters});const a=new Map;return ni(a,n.extraQueryParameters||{}),_s(e,gs(r,a),s)}async function Ss(e,t,r,n,o,i){const s=await ks(t,r,n,o,i);Ho(s,ie),Qo(s,n.codeChallenge,n.codeChallengeMethod||L),ni(s,{...n.extraParameters});const a=new Map;return ni(a,n.extraQueryParameters||{}),_s(e,gs(r,a),s)}function _s(e,t,r){const n=e.createElement("form");return n.method="post",n.action=t,r.forEach((t,r)=>{const o=e.createElement("input");o.hidden=!0,o.name=r,o.value=t,n.appendChild(o)}),e.body.appendChild(n),n}async function Ps(e,t,r,n,o,i,s,a,c,l){if(a.verbose("11qcow",e.correlationId),!l)throw We(at);const h=new pr(a,c),d=new bs(n,o,h,a,s,n.system.navigationClient,r,c,l,t,i,e.correlationId),{userRequestState:u}=Io(h.base64Decode,e.state);return jr(d.acquireToken.bind(d),ke,a,c,e.correlationId)({...e,state:u,prompt:void 0})}async function Rs(e,t,r,n,o,i,s,a,c,l,h,d){if(Ji.removeThrottle(s,o.auth.clientId,e),t.accountId)return jr(Ps,Me,l,h,e.correlationId)(e,t.accountId,n,o,s,a,c,l,h,d);const u={...e,code:t.code||"",codeVerifier:r},g=new ms(i,s,u,l,h);return await jr(g.handleCodeResponse.bind(g),"handleCodeResponse",l,h,e.correlationId)(t,e,n)}async function xs(e,t,r,n,o,i,s,a,c,l,h){if(Ji.removeThrottle(i,n.auth.clientId,e),ps(t,e.state),!t.ear_jwe)throw We("ear_jwe_empty");if(!e.earJwk)throw We(Ve);const d=JSON.parse(await jr(nr,"decryptEarResponse",c,l,e.correlationId)(e.earJwk,t.ear_jwe));if(d.accountId)return jr(Ps,Me,c,l,e.correlationId)(e,d.accountId,r,n,i,s,a,c,l,h);const u=new Bi(n.auth.clientId,i,new pr(c,l),c,l,null,null);u.validateTokenResponse(d,e.correlationId);const g={code:"",state:e.state,nonce:e.nonce,client_info:d.client_info,cloud_graph_host_name:d.cloud_graph_host_name,cloud_instance_host_name:d.cloud_instance_host_name,cloud_instance_name:d.cloud_instance_name,msgraph_host:d.msgraph_host};return await jr(u.handleServerTokenResponse.bind(u),Dr,c,l,e.correlationId)(d,o,Vr(),e,r,g,void 0,void 0,void 0,void 0)}async function Es(e,t,r){const n=Br(Os,"generateCodeVerifier",t,e,r)(e,t,r);return{verifier:n,challenge:await jr(Ms,"generateCodeChallengeFromVerifier",t,e,r)(n,e,t,r)}}function Os(e,t,r){try{const n=new Uint8Array(32);return Br(Yt,"getRandomValues",t,e,r)(n),Fe(n)}catch(e){throw We(Je)}}async function Ms(e,t,r,n){try{const o=await jr(Xt,"sha256Digest",r,t,n)(e);return Fe(new Uint8Array(o))}catch(e){throw We(Je)}}var qs=r(64583).Promise;const Ns={sendGetRequestAsync:()=>qs.reject(p(P)),sendPostRequestAsync:()=>qs.reject(p(P))};var Us=r(64583).Promise;class Hs{navigateInternal(e,t){return Hs.defaultNavigateWindow(e,t)}navigateExternal(e,t){return Hs.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Us((e,r)=>{setTimeout(()=>{r(We(ht,"failed_to_redirect"))},t.timeout)})}}class Ls{async sendGetRequestAsync(e,t){let r,n={},o=0;const i=Ds(t);try{r=await fetch(e,{method:"GET",headers:i})}catch(e){throw Gi(We(window.navigator.onLine?"get_request_failed":nt),void 0,void 0,e)}n=zs(r.headers);try{return o=r.status,{headers:n,body:await r.json(),status:o}}catch(e){throw Gi(We(ot),o,n,e)}}async sendPostRequestAsync(e,t){const r=t&&t.body||"",n=Ds(t);let o,i=0,s={};try{o=await fetch(e,{method:"POST",headers:n,body:r})}catch(e){throw Gi(We(window.navigator.onLine?"post_request_failed":nt),void 0,void 0,e)}s=zs(o.headers);try{return i=o.status,{headers:s,body:await o.json(),status:i}}catch(e){throw Gi(We(ot),i,s,e)}}}function Ds(e){try{const t=new Headers;if(!e||!e.headers)return t;const r=e.headers;return Object.entries(r).forEach(([e,r])=>{t.append(e,r)}),t}catch(e){throw Gi(We("failed_to_build_headers"),void 0,void 0,e)}}function zs(e){try{const t={};return e.forEach((e,r)=>{t[r]=e}),t}catch(e){throw We("failed_to_parse_headers")}}const Fs="unexpected_error";var Bs=r(64583).Promise;class js{constructor(e,t,r,n){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=n,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=r,this.handshakeEvent=r.startMeasurement("nativeMessageHandlerHandshake"),this.platformAuthType="PlatformAuthExtensionHandler"}async sendMessage(e){this.logger.trace("0on4p2",e.correlationId);const t={method:"GetToken",request:e},r={channel:ft,extensionId:this.extensionId,responseId:er(),body:t};this.logger.trace("1qadfi",e.correlationId),this.logger.tracePii("1xm533",e.correlationId),this.messageChannel.port1.postMessage(r);const n=await new Bs((e,t)=>{this.resolvers.set(r.responseId,{resolve:e,reject:t})});return this.validatePlatformBrokerResponse(n)}static async createProvider(e,t,r,n){e.trace("15zfnw",n);try{const o=new js(e,t,r,yt);return await o.sendHandshakeRequest(n),o}catch(o){const i=new js(e,t,r);return await i.sendHandshakeRequest(n),i}}async sendHandshakeRequest(e){this.logger.trace("1dpg9o",e),window.addEventListener("message",this.windowListener,!1);const t={channel:ft,extensionId:this.extensionId,responseId:er(),body:{method:vt}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=e=>{this.onChannelMessage(e)},window.postMessage(t,window.origin,[this.messageChannel.port2]),new Bs((e,r)=>{this.handshakeResolvers.set(t.responseId,{resolve:e,reject:r}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),r(We("native_handshake_timeout")),this.handshakeResolvers.delete(t.responseId)},this.handshakeTimeoutMs)})}onWindowMessage(e){const t=Ci();if(this.logger.trace("0jpn5u",t),e.source!==window)return;const r=e.data;if(r.channel&&r.channel===ft&&(!r.extensionId||r.extensionId===this.extensionId)&&r.body.method===vt){const e=this.handshakeResolvers.get(r.responseId);if(!e)return void this.logger.trace("07buhm",t);this.logger.verbose(r.extensionId?"0xrkug":"No extension installed",t),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),e.reject(We("native_extension_not_installed"))}}onChannelMessage(e){const t=Ci();this.logger.trace("1py8yf",t);const r=e.data,n=this.resolvers.get(r.responseId),o=this.handshakeResolvers.get(r.responseId);try{const e=r.body.method;if("Response"===e){if(!n)return;const e=r.body.response;if(this.logger.trace("19hpgm",t),this.logger.tracePii("179a24",t),"Success"!==e.status)n.reject(ws(e.code,e.description,e.ext));else{if(!e.result)throw u(Fs,"Event does not contain result.");e.result.code&&e.result.description?n.reject(ws(e.result.code,e.result.description,e.result.ext)):n.resolve(e.result)}this.resolvers.delete(r.responseId)}else if("HandshakeResponse"===e){if(!o)return void this.logger.trace("082qnt",t);clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=r.extensionId,this.extensionVersion=r.body.version,this.logger.verbose("0yf5ib",t),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),o.resolve(),this.handshakeResolvers.delete(r.responseId)}}catch(e){this.logger.error("0xf978",t),this.logger.errorPii("04i99o",t),this.logger.errorPii("0xdvsy",t),n?n.reject(e):o&&o.reject(e)}}validatePlatformBrokerResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw u(Fs,"Response missing expected properties.")}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}getExtensionName(){return this.getExtensionId()===yt?"chrome":this.getExtensionId()?.length?"unknown":void 0}}class Ks{constructor(e,t,r){this.logger=e,this.performanceClient=t,this.correlationId=r,this.platformAuthType="PlatformAuthDOMHandler"}static async createProvider(e,t,r){if(e.trace("12mj4a",r),window.navigator?.platformAuthentication){const n=await window.navigator.platformAuthentication.getSupportedContracts(wt);if(n?.includes("get-token-and-sign-out"))return e.trace("1h5q1r",r),new Ks(e,t,r)}}getExtensionId(){return wt}getExtensionVersion(){return""}getExtensionName(){return"DOM API"}async sendMessage(e){this.logger.trace("02bcil",e.correlationId);try{const t=this.initializePlatformDOMRequest(e),r=await window.navigator.platformAuthentication.executeGetToken(t);return this.validatePlatformBrokerResponse(r,e.correlationId)}catch(t){throw this.logger.error("11im7g",e.correlationId),t}}initializePlatformDOMRequest(e){this.logger.trace("15d6yv",e.correlationId);const{accountId:t,clientId:r,authority:n,scope:o,redirectUri:i,correlationId:s,state:a,storeInCache:c,embeddedClientId:l,extraParameters:h,...d}=e,u=this.getDOMExtraParams(d);return{accountId:t,brokerId:this.getExtensionId(),authority:n,clientId:r,correlationId:s||this.correlationId,extraParameters:{...h,...u},isSecurityTokenService:!1,redirectUri:i,scope:o,state:a,storeInCache:c,embeddedClientId:l}}validatePlatformBrokerResponse(e,t){if(e.hasOwnProperty("isSuccess")){if(e.hasOwnProperty("accessToken")&&e.hasOwnProperty("idToken")&&e.hasOwnProperty("clientInfo")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scopes")&&e.hasOwnProperty("expiresIn"))return this.logger.trace("0h4vei",t),this.convertToPlatformBrokerResponse(e,t);if(e.hasOwnProperty("error")){const r=e;if(!1===r.isSuccess&&r.error&&r.error.code)throw this.logger.trace("0g92vm",t),ws(r.error.code,r.error.description,{error:parseInt(r.error.errorCode),protocol_error:r.error.protocolError,status:r.error.status,properties:r.error.properties})}}throw u(Fs,"Response missing expected properties.")}convertToPlatformBrokerResponse(e,t){return this.logger.trace("14913t",t),{access_token:e.accessToken,id_token:e.idToken,client_info:e.clientInfo,account:e.account,expires_in:e.expiresIn,scope:e.scopes,state:e.state||"",properties:e.properties||{},extendedLifetimeToken:e.extendedLifetimeToken??!1,shr:e.proofOfPossessionPayload}}getDOMExtraParams(e){return{...Object.entries(e).reduce((e,[t,r])=>(e[t]=String(r),e),{})}}}function $s(e,t,r,n,o){if(t.trace("0uko3r",r),!e.system.allowPlatformBroker)return t.trace("04hozs",r),!1;if(!n)return t.trace("0kvv1r",r),!1;if(o)switch(o){case ve.BEARER:case ve.POP:return t.trace("18tev1",r),!0;default:return t.trace("1dd2nh",r),!1}return!0}var Ws=r(64583).Promise;class Js extends hs{constructor(e,t,r,n,o,i,s,a,c,l){super(e,t,r,n,o,i,s,c,l),this.nativeStorage=a,this.eventHandler=o}acquireToken(e,t){let r;try{if(r={popupName:this.generatePopupName(e.scopes||j,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window},this.performanceClient.addFields({isAsyncPopup:!this.config.system.navigatePopups},this.correlationId),this.config.system.navigatePopups){const n={...e,httpMethod:ls(e,this.config.system.protocolMode)};return this.logger.verbose("1f9ok3",this.correlationId),r.popup=this.openSizedPopup("about:blank",r),this.acquireTokenPopupAsync(n,r,t)}return this.logger.verbose("162h4u",this.correlationId),this.acquireTokenPopupAsync(e,r,t)}catch(e){return Ws.reject(e)}}logout(e){try{this.logger.verbose("068rup",this.correlationId);const t=this.initializeLogoutRequest(e),r={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:e?.popupWindowAttributes||{},popupWindowParent:e?.popupWindowParent??window},n=e&&e.authority,o=e&&e.mainWindowRedirectUri;return this.config.system.navigatePopups?(this.logger.verbose("1a28da",this.correlationId),r.popup=this.openSizedPopup("about:blank",r),this.logoutPopupAsync(t,r,n,o)):(this.logger.verbose("1phd8u",this.correlationId),this.logoutPopupAsync(t,r,n,o))}catch(e){return Ws.reject(e)}}async acquireTokenPopupAsync(e,t,r){this.logger.verbose("1g77pg",this.correlationId);const n=await jr(ds,Ee,this.logger,this.performanceClient,this.correlationId)(e,Ut.Popup,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId);t.popup&&vi(n.authority);const o=$s(this.config,this.logger,this.correlationId,this.platformAuthProvider,e.authenticationScheme);return n.platformBroker=o,this.config.system.protocolMode===Mr?this.executeEarFlow(n,t,r):this.executeCodeFlow(n,t,r)}async executeCodeFlow(e,t,r){const n=e.correlationId,o=os(qt,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),i=r||await jr(Es,Ue,this.logger,this.performanceClient,n)(this.performanceClient,this.logger,n),s={...e,codeChallenge:i.challenge};try{const r=await jr(this.createAuthCodeClient.bind(this),Re,this.logger,this.performanceClient,n)({serverTelemetryManager:o,requestAuthority:s.authority,requestAzureCloudOptions:s.azureCloudOptions,requestExtraQueryParameters:s.extraQueryParameters,account:s.account});if(s.httpMethod===B)return await this.executeCodeFlowWithPost(s,t,r,i.verifier);{const o=await jr(Ts,Ur,this.logger,this.performanceClient,n)(this.config,r.authority,s,this.logger,this.performanceClient),a=this.initiateAuthRequest(o,t);this.eventHandler.emitEvent(fo,Ut.Popup,{popupWindow:a},null);const c=await gi(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,e),l=Br(us,Ne,this.logger,this.performanceClient,this.correlationId)(c,this.config.auth.OIDCOptions.responseMode,this.logger,this.correlationId);return await jr(Rs,qe,this.logger,this.performanceClient,n)(e,l,i.verifier,qt,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}catch(e){throw t.popup?.close(),e instanceof d&&(e.setCorrelationId(this.correlationId),o.cacheFailedRequest(e)),e}}async executeEarFlow(e,t,r){const{correlationId:n,authority:o,azureCloudOptions:i,extraQueryParameters:s,account:a}=e,c=await jr(is,be,this.logger,this.performanceClient,n)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,o,i,s,a),l=await jr(rr,De,this.logger,this.performanceClient,n)(),h=r||await jr(Es,Ue,this.logger,this.performanceClient,n)(this.performanceClient,this.logger,n),d={...e,earJwk:l,codeChallenge:h.challenge},u=t.popup||this.openPopup("about:blank",t);(await As(u.document,this.config,c,d,this.logger,this.performanceClient)).submit();const g=await jr(gi,Pe,this.logger,this.performanceClient,n)(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,d),p=Br(us,Ne,this.logger,this.performanceClient,this.correlationId)(g,this.config.auth.OIDCOptions.responseMode,this.logger,this.correlationId);if(!p.ear_jwe&&p.code){const t=await jr(this.createAuthCodeClient.bind(this),Re,this.logger,this.performanceClient,n)({serverTelemetryManager:os(qt,this.config.auth.clientId,n,this.browserStorage,this.logger),requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account,authority:c});return jr(Rs,qe,this.logger,this.performanceClient,n)(d,p,h.verifier,qt,this.config,t,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}return jr(xs,Oe,this.logger,this.performanceClient,n)(d,p,qt,this.config,c,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async executeCodeFlowWithPost(e,t,r,n){const o=e.correlationId,i=await jr(is,be,this.logger,this.performanceClient,o)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger),s=t.popup||this.openPopup("about:blank",t);(await Ss(s.document,this.config,i,e,this.logger,this.performanceClient)).submit();const a=await jr(gi,Pe,this.logger,this.performanceClient,o)(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,e),c=Br(us,Ne,this.logger,this.performanceClient,this.correlationId)(a,this.config.auth.OIDCOptions.responseMode,this.logger,this.correlationId);return jr(Rs,qe,this.logger,this.performanceClient,o)(e,c,n,qt,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async logoutPopupAsync(e,t,r,n){this.logger.verbose("0b7yrk",this.correlationId),this.eventHandler.emitEvent(yo,Ut.Popup,e);const o=os(962,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{await ss(this.browserStorage,this.browserCrypto,this.logger,this.correlationId,e.account);const i=await jr(this.createAuthCodeClient.bind(this),Re,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:o,requestAuthority:r,account:e.account||void 0});try{i.authority.endSessionEndpoint}catch{if(e.account?.homeAccountId&&e.postLogoutRedirectUri&&i.authority.protocolMode===Or){if(this.eventHandler.emitEvent(wo,Ut.Popup,e),n){const e={apiId:962,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},t=Ar.getAbsoluteUrl(n,pi());await this.navigationClient.navigateInternal(t,e)}return void t.popup?.close()}}const s=i.getLogoutUri(e);this.eventHandler.emitEvent(wo,Ut.Popup,e);const a=this.openPopup(s,t);if(this.eventHandler.emitEvent(fo,Ut.Popup,{popupWindow:a},null),await gi(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,e).catch(()=>{}),n){const e={apiId:962,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},t=Ar.getAbsoluteUrl(n,pi());this.logger.verbose("0qcur2",this.correlationId),this.logger.verbosePii("0oj7lk",this.correlationId),await this.navigationClient.navigateInternal(t,e)}else this.logger.verbose("03zgcf",this.correlationId)}catch(e){throw t.popup?.close(),e instanceof d&&(e.setCorrelationId(this.correlationId),o.cacheFailedRequest(e)),this.eventHandler.emitEvent(vo,Ut.Popup,null,e),this.eventHandler.emitEvent(Co,Ut.Popup),e}this.eventHandler.emitEvent(Co,Ut.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii("1kcr9k",this.correlationId),this.openPopup(e,t);throw this.logger.error("1l7hyp",this.correlationId),We(Qe)}openPopup(e,t){try{let r;if(t.popup?(r=t.popup,this.logger.verbosePii("0cgeo7",this.correlationId),r.location.assign(e)):void 0===t.popup&&(this.logger.verbosePii("0c2awd",this.correlationId),r=this.openSizedPopup(e,t)),!r)throw We("empty_window_error");return r.focus&&r.focus(),this.currentWindow=r,r}catch(e){throw this.logger.error("0dxfb9",this.correlationId),We("popup_window_error")}}openSizedPopup(e,{popupName:t,popupWindowAttributes:r,popupWindowParent:n}){const o=n.screenLeft?n.screenLeft:n.screenX,i=n.screenTop?n.screenTop:n.screenY,s=n.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=n.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let c=r.popupSize?.width,l=r.popupSize?.height,h=r.popupPosition?.top,d=r.popupPosition?.left;return(!c||c<0||c>s)&&(this.logger.verbose("08vfmo",this.correlationId),c=483),(!l||l<0||l>a)&&(this.logger.verbose("09cxa0",this.correlationId),l=600),(!h||h<0||h>a)&&(this.logger.verbose("1qh4wo",this.correlationId),h=Math.max(0,a/2-300+i)),(!d||d<0||d>s)&&(this.logger.verbose("1sz3en",this.correlationId),d=Math.max(0,s/2-241.5+o)),n.open(e,t,`width=${c}, height=${l}, top=${h}, left=${d}, scrollbars=yes`)}generatePopupName(e,t){return`${pt}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){const t=e.account&&e.account.homeAccountId;return`${pt}.${this.config.auth.clientId}.${t}.${this.correlationId}`}}var Vs=r(64583).Promise;class Gs extends hs{constructor(e,t,r,n,o,i,s,a,c,l){super(e,t,r,n,o,i,s,c,l),this.nativeStorage=a}async acquireToken(e){const t=await jr(ds,Ee,this.logger,this.performanceClient,this.correlationId)(e,Ut.Redirect,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId);t.platformBroker=$s(this.config,this.logger,this.correlationId,this.platformAuthProvider,e.authenticationScheme);const r=e=>{e.persisted&&(this.logger.verbose("0udvtt",this.correlationId),this.browserStorage.resetRequestCache(this.correlationId),this.eventHandler.emitEvent("msal:restoreFromBFCache",Ut.Redirect))},n=this.getRedirectStartPage(e.redirectStartPage);this.logger.verbosePii("0zao0a",this.correlationId),this.browserStorage.setTemporaryCache(At,n,!0),window.addEventListener("pageshow",r);try{this.config.system.protocolMode===Mr?await this.executeEarFlow(t):await this.executeCodeFlow(t)}catch(e){throw e instanceof d&&e.setCorrelationId(this.correlationId),window.removeEventListener("pageshow",r),e}}async executeCodeFlow(e){const t=e.correlationId,r=os(Mt,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),n=await jr(Es,Ue,this.logger,this.performanceClient,t)(this.performanceClient,this.logger,t),o={...e,codeChallenge:n.challenge};this.browserStorage.cacheAuthorizeRequest(o,this.correlationId,n.verifier);try{if(o.httpMethod===B)return await this.executeCodeFlowWithPost(o);{const t=await jr(this.createAuthCodeClient.bind(this),Re,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:o.authority,requestAzureCloudOptions:o.azureCloudOptions,requestExtraQueryParameters:o.extraQueryParameters,account:o.account}),n=await jr(Ts,Ur,this.logger,this.performanceClient,e.correlationId)(this.config,t.authority,o,this.logger,this.performanceClient);return await this.initiateAuthRequest(n)}}catch(e){throw e instanceof d&&(e.setCorrelationId(this.correlationId),r.cacheFailedRequest(e)),e}}async executeEarFlow(e){const{correlationId:t,authority:r,azureCloudOptions:n,extraQueryParameters:o,account:i}=e,s=await jr(is,be,this.logger,this.performanceClient,t)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,r,n,o,i),a=await jr(rr,De,this.logger,this.performanceClient,t)(),c=await jr(Es,Ue,this.logger,this.performanceClient,t)(this.performanceClient,this.logger,t),l={...e,earJwk:a,codeChallenge:c.challenge};return this.browserStorage.cacheAuthorizeRequest(l,this.correlationId,c.verifier),(await As(document,this.config,s,l,this.logger,this.performanceClient)).submit(),new Vs((e,t)=>{setTimeout(()=>{t(We(ht,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})}async executeCodeFlowWithPost(e){const t=e.correlationId,r=await jr(is,be,this.logger,this.performanceClient,t)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger);return this.browserStorage.cacheAuthorizeRequest(e,this.correlationId),(await Ss(document,this.config,r,e,this.logger,this.performanceClient)).submit(),new Vs((e,t)=>{setTimeout(()=>{t(We(ht,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})}async handleRedirectPromise(e,t,r,n){const o=os(865,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),i=n?.navigateToLoginRequestUrl??!0;try{const[s,a]=this.getRedirectResponse(n?.hash||"");if(!s)return this.logger.info("1qmv0q",this.correlationId),this.browserStorage.resetRequestCache(this.correlationId),"back_forward"!==function(){if("undefined"==typeof window||void 0===window.performance||"function"!=typeof window.performance.getEntriesByType)return;const e=window.performance.getEntriesByType("navigation"),t=e.length?e[0]:void 0;return t?.type}()?r.event.errorCode="no_server_response":this.logger.verbose("1eqegq",this.correlationId),null;const c=this.browserStorage.getTemporaryCache(At,this.correlationId,!0)||"";if(So(c)===So(window.location.href)&&i)return this.logger.verbose("11yred",this.correlationId),c.indexOf("#")>-1&&function(e){const t=e.split("#");t.shift(),window.location.hash=t.length>0?t.join("#"):""}(c),await this.handleResponse(s,e,t,o);if(!i)return this.logger.verbose("0v4sdv",this.correlationId),await this.handleResponse(s,e,t,o);if(!di()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(St,a,!0);const r={apiId:865,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let n=!0;if(c&&"null"!==c)this.logger.verbose("08jpy1",this.correlationId),n=await this.navigationClient.navigateInternal(c,r);else{const e=function(){const e=new Ar(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}();this.browserStorage.setTemporaryCache(At,e,!0),this.logger.warning("1dutq1",this.correlationId),n=await this.navigationClient.navigateInternal(e,r)}if(!n)return await this.handleResponse(s,e,t,o)}return null}catch(e){throw e instanceof d&&(e.setCorrelationId(this.correlationId),o.cacheFailedRequest(e)),e}}getRedirectResponse(e){this.logger.verbose("1c5i8m",this.correlationId);let t=e;t||(t=this.config.auth.OIDCOptions.responseMode===se?window.location.search:window.location.hash);let r=To(t);if(r){try{!function(e,t,r){if(!e.state)throw We(Xe);const n=function(e,t){if(!t)return null;try{return Io(e.base64Decode,t).libraryState.meta}catch(e){throw p(w)}}(t,e.state);if(!n)throw We(Ye);if(n.interactionType!==r)throw We("state_interaction_type_mismatch")}(r,this.browserCrypto,Ut.Redirect)}catch(e){return e instanceof d&&this.logger.error("0bkq6p",this.correlationId),[null,""]}return hi(window),this.logger.verbose("00uvho",this.correlationId),[r,t]}const n=this.browserStorage.getTemporaryCache(St,this.correlationId,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(St)),n&&(r=To(n),r)?(this.logger.verbose("001671",this.correlationId),[r,n]):[null,""]}async handleResponse(e,t,r,n){if(!e.state)throw We(Xe);const{authority:o,azureCloudOptions:i,extraQueryParameters:s,account:a}=t;if(e.ear_jwe){const r=await jr(is,be,this.logger,this.performanceClient,t.correlationId)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,o,i,s,a);return jr(xs,Oe,this.logger,this.performanceClient,t.correlationId)(t,e,Mt,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}const c=await jr(this.createAuthCodeClient.bind(this),Re,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:n,requestAuthority:t.authority});return jr(Rs,qe,this.logger,this.performanceClient,t.correlationId)(t,e,r,Mt,this.config,c,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async initiateAuthRequest(e){if(this.logger.verbose("0yaw2e",this.correlationId),e){this.logger.infoPii("1luf83",this.correlationId);const t={apiId:Mt,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},r=this.config.auth.onRedirectNavigate;return"function"==typeof r?(this.logger.verbose("1nehvl",this.correlationId),!1!==r(e)?(this.logger.verbose("1a0jxh",this.correlationId),void await this.navigationClient.navigateExternal(e,t)):void this.logger.verbose("09k5h5",this.correlationId)):(this.logger.verbose("0klwf7",this.correlationId),void await this.navigationClient.navigateExternal(e,t))}throw this.logger.info("0rlh4e",this.correlationId),We(Qe)}async logout(e){this.logger.verbose("1rkurh",this.correlationId);const t=this.initializeLogoutRequest(e),r=os(961,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{this.eventHandler.emitEvent(yo,Ut.Redirect,e),await ss(this.browserStorage,this.browserCrypto,this.logger,this.correlationId,t.account);const n={apiId:961,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},o=await jr(this.createAuthCodeClient.bind(this),Re,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:e&&e.authority,requestExtraQueryParameters:e?.extraQueryParameters,account:e&&e.account||void 0});if(o.authority.protocolMode===Or)try{o.authority.endSessionEndpoint}catch{if(t.account?.homeAccountId)return void this.eventHandler.emitEvent(wo,Ut.Redirect,t)}const i=o.getLogoutUri(t);t.account?.homeAccountId&&this.eventHandler.emitEvent(wo,Ut.Redirect,t);const s=this.config.auth.onRedirectNavigate;if("function"!=typeof s)return this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,Tt),void await this.navigationClient.navigateExternal(i,n);if(!1!==s(i))return this.logger.verbose("06v57e",this.correlationId),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,Tt),void await this.navigationClient.navigateExternal(i,n);this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("0xqes1",this.correlationId)}catch(e){throw e instanceof d&&(e.setCorrelationId(this.correlationId),r.cacheFailedRequest(e)),this.eventHandler.emitEvent(vo,Ut.Redirect,null,e),this.eventHandler.emitEvent(Co,Ut.Redirect),e}this.eventHandler.emitEvent(Co,Ut.Redirect)}getRedirectStartPage(e){const t=e||window.location.href;return Ar.getAbsoluteUrl(t,pi())}}async function Qs(e,t,r,n){if(!e)throw r.info("1l7hyp",n),We(Qe);return Br(Zs,"silentHandlerLoadFrameSync",r,t,n)(e)}async function Xs(e,t,r,n,o){const i=ea();if(!i.contentDocument)throw"No document associated with iframe!";return(await Ss(i.contentDocument,e,t,r,n,o)).submit(),i}async function Ys(e,t,r,n,o){const i=ea();if(!i.contentDocument)throw"No document associated with iframe!";return(await As(i.contentDocument,e,t,r,n,o)).submit(),i}function Zs(e){const t=ea();return t.src=e,t}function ea(){const e=document.createElement("iframe");return e.className="msalSilentIframe",e.style.visibility="hidden",e.style.position="absolute",e.style.width=e.style.height="0",e.style.border="0",e.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),e.setAttribute("allow","local-network-access *"),document.body.appendChild(e),e}var ta=r(64583).Promise;class ra extends hs{constructor(e,t,r,n,o,i,s,a,c,l,h){super(e,t,r,n,o,i,a,l,h),this.apiId=s,this.nativeStorage=c}async acquireToken(e){e.loginHint||e.sid||e.account&&e.account.username||this.logger.warning("1kl318",this.correlationId);const t={...e};t.prompt?t.prompt!==oe&&"no_session"!==t.prompt&&(this.logger.warning("0bmctg",this.correlationId),t.prompt=oe):t.prompt=oe;const r=await jr(ds,Ee,this.logger,this.performanceClient,this.correlationId)(t,Ut.Silent,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId);return r.platformBroker=$s(this.config,this.logger,this.correlationId,this.platformAuthProvider,r.authenticationScheme),vi(r.authority),this.config.system.protocolMode===Mr?this.executeEarFlow(r):this.executeCodeFlow(r)}async executeCodeFlow(e){let t;const r=os(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{return t=await jr(this.createAuthCodeClient.bind(this),Re,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),await jr(this.silentTokenHelper.bind(this),Se,this.logger,this.performanceClient,e.correlationId)(t,e)}catch(n){if(n instanceof d&&(n.setCorrelationId(this.correlationId),r.cacheFailedRequest(n)),!(t&&n instanceof d&&n.errorCode===gt))throw n;return this.performanceClient.addFields({retryError:n.errorCode},this.correlationId),await jr(this.silentTokenHelper.bind(this),Se,this.logger,this.performanceClient,this.correlationId)(t,e)}}async executeEarFlow(e){const{correlationId:t,authority:r,azureCloudOptions:n,extraQueryParameters:o,account:i}=e,s=await jr(is,be,this.logger,this.performanceClient,t)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,r,n,o,i),a=await jr(rr,De,this.logger,this.performanceClient,t)(),c=await jr(Es,Ue,this.logger,this.performanceClient,t)(this.performanceClient,this.logger,t),l={...e,earJwk:a,codeChallenge:c.challenge};await jr(Ys,_e,this.logger,this.performanceClient,t)(this.config,s,l,this.logger,this.performanceClient);const h=this.config.auth.OIDCOptions.responseMode,d=await jr(gi,Pe,this.logger,this.performanceClient,t)(this.config.system.iframeBridgeTimeout,this.logger,this.browserCrypto,e),u=Br(us,Ne,this.logger,this.performanceClient,t)(d,h,this.logger,this.correlationId);if(!u.ear_jwe&&u.code){const r=await jr(this.createAuthCodeClient.bind(this),Re,this.logger,this.performanceClient,t)({serverTelemetryManager:os(this.apiId,this.config.auth.clientId,t,this.browserStorage,this.logger),requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account,authority:s});return jr(Rs,qe,this.logger,this.performanceClient,t)(l,u,c.verifier,this.apiId,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}return jr(xs,Oe,this.logger,this.performanceClient,t)(l,u,this.apiId,this.config,s,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}logout(){return ta.reject(We(et))}async silentTokenHelper(e,t){const r=t.correlationId,n=await jr(Es,Ue,this.logger,this.performanceClient,r)(this.performanceClient,this.logger,r),o={...t,codeChallenge:n.challenge};if(t.httpMethod===B)await jr(Xs,_e,this.logger,this.performanceClient,r)(this.config,e.authority,o,this.logger,this.performanceClient);else{const t=await jr(Ts,Ur,this.logger,this.performanceClient,r)(this.config,e.authority,o,this.logger,this.performanceClient);await jr(Qs,_e,this.logger,this.performanceClient,r)(t,this.performanceClient,this.logger,r)}const i=this.config.auth.OIDCOptions.responseMode,s=await jr(gi,Pe,this.logger,this.performanceClient,r)(this.config.system.iframeBridgeTimeout,this.logger,this.browserCrypto,t),a=Br(us,Ne,this.logger,this.performanceClient,r)(s,i,this.logger,this.correlationId);return jr(Rs,qe,this.logger,this.performanceClient,r)(t,a,n.verifier,this.apiId,this.config,e,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}class na{constructor(e,t){this.config=Hi(e),this.logger=new _i(this.config.loggerOptions,En,On),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}async acquireToken(e,t){const r=Vr(),n=await jr(this.executeTokenRequest.bind(this),"refreshTokenClientExecuteTokenRequest",this.logger,this.performanceClient,e.correlationId)(e,this.authority),o=n.headers?.[V],i=new Bi(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.performanceClient,this.config.serializableCache,this.config.persistencePlugin);return i.validateTokenResponse(n.body,e.correlationId),jr(i.handleServerTokenResponse.bind(i),Dr,this.logger,this.performanceClient,e.correlationId)(n.body,this.authority,r,e,t,void 0,void 0,!0,e.forceCache,o)}async acquireTokenByRefreshToken(e,t){if(!e)throw wr("token_request_empty");if(!e.account)throw p(b);if(this.cacheManager.isAppMetadataFOCI(e.account.environment,e.correlationId))try{return await jr(this.acquireTokenWithCachedRefreshToken.bind(this),Nr,this.logger,this.performanceClient,e.correlationId)(e,!0,t)}catch(r){const n=r instanceof yn&&r.errorCode===dn,o=r instanceof Di&&"invalid_grant"===r.errorCode&&"client_mismatch"===r.subError;if(n||o)return jr(this.acquireTokenWithCachedRefreshToken.bind(this),Nr,this.logger,this.performanceClient,e.correlationId)(e,!1,t);throw r}return jr(this.acquireTokenWithCachedRefreshToken.bind(this),Nr,this.logger,this.performanceClient,e.correlationId)(e,!1,t)}async acquireTokenWithCachedRefreshToken(e,t,r){const n=Br(this.cacheManager.getRefreshToken.bind(this.cacheManager),"cacheManagerGetRefreshToken",this.logger,this.performanceClient,e.correlationId)(e.account,t,e.correlationId,void 0);if(!n)throw vn(dn);if(n.expiresOn){const t=e.refreshTokenExpirationOffsetSeconds||300;if(this.performanceClient?.addFields({cacheRtExpiresOnSeconds:Number(n.expiresOn),rtOffsetSeconds:t},e.correlationId),Xr(n.expiresOn,t))throw vn(un)}const o={...e,refreshToken:n.secret,authenticationScheme:e.authenticationScheme||ve.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:Ki}};try{return await jr(this.acquireToken.bind(this),"refreshTokenClientAcquireToken",this.logger,this.performanceClient,e.correlationId)(o,r)}catch(t){if(t instanceof yn&&t.subError===pn){this.logger.verbose("1pg3ap",e.correlationId);const t=this.cacheManager.generateCredentialKey(n);this.cacheManager.removeRefreshToken(t,e.correlationId)}throw t}}async executeTokenRequest(e,t){const r=Xi(e,this.config.authOptions.clientId,this.config.authOptions.redirectUri,this.performanceClient),n=Ar.appendQueryString(t.tokenEndpoint,r),o=await jr(this.createTokenRequestBody.bind(this),"refreshTokenClientCreateTokenRequestBody",this.logger,this.performanceClient,e.correlationId)(e),i=Qi(this.logger,this.config.systemOptions.preventCorsPreflight,e.ccsCredential),s=Pn(this.config.authOptions.clientId,e);return jr(Yi,"refreshTokenClientExecutePostToTokenEndpoint",this.logger,this.performanceClient,e.correlationId)(n,o,i,s,e.correlationId,this.cacheManager,this.networkClient,this.logger,this.performanceClient,this.serverTelemetryManager)}async createTokenRequestBody(e){const t=new Map;if(Do(t,e.embeddedClientId||e.extraParameters?.[_o]||this.config.authOptions.clientId),e.redirectUri&&zo(t,e.redirectUri),Lo(t,e.scopes,!0,this.config.authOptions.authority.options.OIDCOptions?.defaultScopes),ei(t,"refresh_token"),ti(t),Jo(t,this.config.libraryInfo),Vo(t,this.config.telemetry.application),ai(t),this.serverTelemetryManager&&!Li(this.config)&&si(t,this.serverTelemetryManager),function(e,t){e.set("refresh_token",t)}(t,e.refreshToken),this.config.clientCredentials.clientSecret&&Xo(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const r=this.config.clientCredentials.clientAssertion;Yo(t,await Wi(r.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),Zo(t,r.assertionType)}if(e.authenticationScheme===ve.POP){const r=new zi(this.cryptoUtils,this.performanceClient);let n;n=e.popKid?this.cryptoUtils.encodeKid(e.popKid):(await jr(r.generateCnf.bind(r),Lr,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,oi(t,n)}else if(e.authenticationScheme===ve.SSH){if(!e.sshJwk)throw wr(Tr);ii(t,e.sshJwk)}if((!vr.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&$o(t,e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case Ki:try{jo(t,In(e.ccsCredential.credential))}catch(t){this.logger.verbose("1qhtee",e.correlationId)}break;case $i:Bo(t,e.ccsCredential.credential)}return e.embeddedClientId&&ci(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.extraParameters&&ni(t,{...e.extraParameters}),Uo(t,e.correlationId,this.performanceClient),Ao(t)}}var oa=r(64583).Promise;class ia extends hs{async acquireToken(e){const t=await jr(as,Ae,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger,this.correlationId),r={...e,...t};e.redirectUri&&(r.redirectUri=ns(e.redirectUri,this.config.auth.redirectUri,this.logger,this.correlationId));const n=os(61,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),o=await this.createRefreshTokenClient({serverTelemetryManager:n,authorityUrl:r.authority,azureCloudOptions:r.azureCloudOptions,account:r.account});return jr(o.acquireTokenByRefreshToken.bind(o),"refreshTokenClientAcquireTokenByRefreshToken",this.logger,this.performanceClient,e.correlationId)(r,61).catch(e=>{throw e.setCorrelationId(this.correlationId),n.cacheFailedRequest(e),e})}logout(){return oa.reject(We(et))}async createRefreshTokenClient(e){const t=await jr(this.getClientConfiguration.bind(this),xe,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new na(t,this.performanceClient)}}class sa extends es{constructor(e,t){super(e,t),this.includeRedirectUri=!1}}var aa=r(64583).Promise;class ca extends hs{constructor(e,t,r,n,o,i,s,a,c,l){super(e,t,r,n,o,i,a,c,l),this.apiId=s}async acquireToken(e){if(!e.code)throw We("auth_code_required");const t=await jr(ds,Ee,this.logger,this.performanceClient,this.correlationId)(e,Ut.Silent,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId),r=os(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{const n={...t,code:e.code},o=await jr(this.getClientConfiguration.bind(this),xe,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),i=new sa(o,this.performanceClient);this.logger.verbose("1uic5e",this.correlationId);const s=new ms(i,this.browserStorage,n,this.logger,this.performanceClient);return await jr(s.handleCodeResponseFromServer.bind(s),Hr,this.logger,this.performanceClient,this.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,this.apiId,!1)}catch(e){throw e instanceof d&&(e.setCorrelationId(this.correlationId),r.cacheFailedRequest(e)),e}}logout(){return aa.reject(We(et))}}var la=r(64583).Promise;function ha(e,t,r){try{yi(e)}catch(e){throw t.end({success:!1},e,r),e}}class da{constructor(e){var t,r,n,o;this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new pr(this.logger,this.performanceClient):fr,this.eventHandler=new Pi(this.logger),this.browserStorage=this.isBrowserEnvironment?new ki(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,function(e){const t=e.cloudDiscoveryMetadata;let r;if(t)try{r=JSON.parse(t)}catch(e){throw wr(kr)}return{canonicalAuthority:e.authority?hn(e.authority):void 0,knownAuthorities:e.knownAuthorities,cloudDiscoveryMetadata:r}}(this.config.auth)):(t=this.config.auth.clientId,r=this.logger,n=this.performanceClient,o=this.eventHandler,new ki(t,{cacheLocation:bt,cacheRetentionDays:5},fr,r,n,o));const i={cacheLocation:bt,cacheRetentionDays:5};this.nativeInternalStorage=new ki(this.config.auth.clientId,i,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static async createController(e,t){const r=new da(e);return await r.initialize(t),r}trackPageVisibility(e){e&&(this.logger.info("16v6hv",e),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}async initialize(e){const t=this.getRequestCorrelationId(e);if(this.logger.trace("1f7joy",t),this.initialized)return void this.logger.info("061m5x",t);if(!this.isBrowserEnvironment)return this.logger.info("19fvpi",t),this.initialized=!0,void this.eventHandler.emitEvent(co);const r=e?.correlationId||this.getRequestCorrelationId(),n=this.config.system.allowPlatformBroker,o=this.performanceClient.startMeasurement("initializeClientApplication",r);if(this.eventHandler.emitEvent("msal:initializeStart"),this.logMultipleInstances(o,r),await jr(this.browserStorage.initialize.bind(this.browserStorage),"initializeCache",this.logger,this.performanceClient,r)(r),n)try{this.platformAuthProvider=await async function(e,t,r,n){e.trace("134j0v",r);const o=function(){let e;try{return e=window[It],"true"===e?.getItem(Bn)}catch(e){return!1}}();let i;e.trace("04c81g",r);try{o&&(i=await Ks.createProvider(e,t,r)),i||(e.trace("0l3na8",r),i=await js.createProvider(e,n||2e3,t,r))}catch(t){e.trace("0icbd7",t)}return i}(this.logger,this.performanceClient,r,this.config.system.nativeBrokerHandshakeTimeout)}catch(e){this.logger.verbose(e,r)}this.config.cache.cacheLocation===Ct&&this.eventHandler.subscribeCrossTab(),!this.config.system.navigatePopups&&await this.preGeneratePkceCodes(r),this.initialized=!0,this.eventHandler.emitEvent(co),o.end({allowPlatformBroker:n,success:!0})}async handleRedirectPromise(e){if(this.logger.verbose("02l8bm",""),fi(this.initialized),this.isBrowserEnvironment){const t=e?.hash||"";let r=this.redirectResponse.get(t);return void 0===r?(r=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,r),this.logger.verbose("1wn9kp","")):this.logger.verbose("0w0gm3",""),r}return this.logger.verbose("12xi63",""),null}async handleRedirectPromiseInternal(e){if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("0le6uv",""),null;const t=this.browserStorage.getInteractionInProgress()?.type;if(t===Tt)return this.logger.verbose("1ywcv2",""),this.browserStorage.setInteractionInProgress(!1),la.resolve(null);const r=this.getAllAccounts(),n=this.browserStorage.getCachedNativeRequest(),o=n&&this.platformAuthProvider&&!e?.hash;let i,s;this.eventHandler.emitEvent("msal:handleRedirectStart",Ut.Redirect);try{if(o&&this.platformAuthProvider){const e=n?.correlationId||"";i=this.performanceClient.startMeasurement(Rn,e),this.logger.trace("12v7is",e);const t=new bs(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,865,this.performanceClient,this.platformAuthProvider,n.accountId,this.nativeInternalStorage,n.correlationId);s=jr(t.handleRedirectPromise.bind(t),"handleNativeRedirectPromise",this.logger,this.performanceClient,i.event.correlationId)(this.performanceClient,i.event.correlationId)}else{const[t,r]=this.browserStorage.getCachedRequest(""),n=t.correlationId;i=this.performanceClient.startMeasurement(Rn,n),this.logger.trace("0znzs5",n);const o=this.createRedirectClient(n);s=jr(o.handleRedirectPromise.bind(o),"handleRedirectPromise",this.logger,this.performanceClient,i.event.correlationId)(t,r,i,e)}}catch(e){throw this.browserStorage.resetRequestCache(""),e}return s.then(e=>(e?(this.browserStorage.resetRequestCache(e.correlationId),this.eventHandler.emitEvent(go,Ut.Redirect,e),this.logger.verbose("0ui8f5",e.correlationId),r.length<this.getAllAccounts().length&&(this.eventHandler.emitEvent(ho,Ut.Redirect,e.account),this.logger.verbose("16im3l",e.correlationId)),i.end({success:!0},void 0,e.account)):i.event.errorCode?i.end({success:!1},void 0):i.discard(),this.eventHandler.emitEvent(mo,Ut.Redirect),e)).catch(e=>{this.browserStorage.resetRequestCache(i.event.correlationId);const t=e;throw this.eventHandler.emitEvent(po,Ut.Redirect,null,t),this.eventHandler.emitEvent(mo,Ut.Redirect),i.end({success:!1},t),e})}async acquireTokenRedirect(e){const t=this.getRequestCorrelationId(e);this.logger.verbose("0os66p",t);const r=this.performanceClient.startMeasurement("acquireTokenPreRedirect",t);r.add({scenarioId:e.scenarioId});const n=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=t=>{const o="function"==typeof n?n(t):void 0;return r.add({navigateCallbackResult:!1!==o}),r.event=r.end({success:!0},void 0,e.account)||r.event,o};try{let n;return wi(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,kt),this.eventHandler.emitEvent(uo,Ut.Redirect,e),n=this.platformAuthProvider&&this.canUsePlatformBroker(e)?new bs(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,Mt,this.performanceClient,this.platformAuthProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e,r).catch(r=>{if(r instanceof fs&&ys(r))return this.platformAuthProvider=void 0,this.createRedirectClient(t).acquireToken(e);if(r instanceof yn)return this.logger.verbose("1ipyz4",t),this.createRedirectClient(t).acquireToken(e);throw r}):this.createRedirectClient(t).acquireToken(e),await n}catch(n){throw this.browserStorage.resetRequestCache(t),2===r.event.status?this.performanceClient.startMeasurement(Rn,t).end({success:!1},n,e.account):r.end({success:!1},n,e.account),this.eventHandler.emitEvent(po,Ut.Redirect,null,n),n}}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement("acquireTokenPopup",t);r.add({scenarioId:e.scenarioId});try{this.logger.verbose("0ch87b",t),ha(this.initialized,r,e.account),this.browserStorage.setInteractionInProgress(!0,kt,e.overrideInteractionInProgress,t)}catch(e){return la.reject(e)}const n=this.getAllAccounts();let o;this.eventHandler.emitEvent(uo,Ut.Popup,e);const i=this.getPreGeneratedPkceCodes(t);return o=this.canUsePlatformBroker(e)?this.acquireTokenNative({...e,correlationId:t},qt).then(e=>(r.end({success:!0,isNativeBroker:!0},void 0,e.account),e)).catch(r=>{if(r instanceof fs&&ys(r))return this.platformAuthProvider=void 0,this.createPopupClient(t).acquireToken(e,i);if(r instanceof yn)return this.logger.verbose("0yy5fw",t),this.createPopupClient(t).acquireToken(e,i);throw r}):this.createPopupClient(t).acquireToken(e,i),o.then(e=>{const t=n.length<this.getAllAccounts().length;return this.eventHandler.emitEvent(go,Ut.Popup,e),t&&this.eventHandler.emitEvent(ho,Ut.Popup,e.account),r.end({success:!0,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length},void 0,e.account),e}).catch(t=>(this.eventHandler.emitEvent(po,Ut.Popup,null,t),r.end({success:!1},t,e.account),la.reject(t))).finally(async()=>{this.browserStorage.setInteractionInProgress(!1),this.config.system.navigatePopups||await this.preGeneratePkceCodes(t)})}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&e.increment({visibilityChangeCount:1})}async ssoSilent(e){const t=this.getRequestCorrelationId(e),r={...e,prompt:e.prompt,correlationId:t};this.ssoSilentMeasurement=this.performanceClient.startMeasurement("ssoSilent",t),this.ssoSilentMeasurement?.add({scenarioId:e.scenarioId}),ha(this.initialized,this.ssoSilentMeasurement,e.account),this.ssoSilentMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement);const n=this.getAllAccounts();let o;return this.logger.verbose("0w1b45",t),this.eventHandler.emitEvent(uo,Ut.Silent,r),o=this.canUsePlatformBroker(r)?this.acquireTokenNative(r,863).catch(e=>{if(e instanceof fs&&ys(e))return this.platformAuthProvider=void 0,this.createSilentIframeClient(r.correlationId).acquireToken(r);throw e}):this.createSilentIframeClient(r.correlationId).acquireToken(r),o.then(e=>{const t=n.length<this.getAllAccounts().length;return this.eventHandler.emitEvent(go,Ut.Silent,e),t&&this.eventHandler.emitEvent(ho,Ut.Silent,e.account),this.ssoSilentMeasurement?.end({success:!0,isNativeBroker:e.fromPlatformBroker,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length},void 0,e.account),e}).catch(t=>{throw this.eventHandler.emitEvent(po,Ut.Silent,null,t),this.ssoSilentMeasurement?.end({success:!1},t,e.account),t}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenByCode(e){const t=this.getRequestCorrelationId(e);this.logger.trace("0ch6ga",t);const r=this.performanceClient.startMeasurement("acquireTokenByCode",t);ha(this.initialized,r),this.eventHandler.emitEvent(uo,Ut.Silent,e),r.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw We("spa_code_and_nativeAccountId_present");if(e.code){const n=e.code;let o=this.hybridAuthCodeResponses.get(n);return o?(this.logger.verbose("0qgp28",t),r.discard()):(this.logger.verbose("06eh73",t),o=this.acquireTokenByCodeAsync({...e,correlationId:t}).then(e=>(this.eventHandler.emitEvent(go,Ut.Silent,e),this.hybridAuthCodeResponses.delete(n),r.end({success:!0,isNativeBroker:e.fromPlatformBroker,accessTokenSize:e.accessToken.length,idTokenSize:e.idToken.length},void 0,e.account),e)).catch(e=>{throw this.hybridAuthCodeResponses.delete(n),this.eventHandler.emitEvent(po,Ut.Silent,null,e),r.end({success:!1},e),e}),this.hybridAuthCodeResponses.set(n,o)),await o}if(e.nativeAccountId){if(this.canUsePlatformBroker(e,e.nativeAccountId)){const n=await this.acquireTokenNative({...e,correlationId:t},866,e.nativeAccountId).catch(e=>{throw e instanceof fs&&ys(e)&&(this.platformAuthProvider=void 0),e});return r.end({success:!0},void 0,n.account),n}throw We("unable_to_acquire_token_from_native_platform")}throw We("auth_code_or_nativeAccountId_required")}catch(e){throw this.eventHandler.emitEvent(po,Ut.Silent,null,e),r.end({success:!1},e),e}}async acquireTokenByCodeAsync(e){const t=this.getRequestCorrelationId(e);this.logger.trace("10d9hy",t),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement("acquireTokenByCodeAsync",t),this.acquireTokenByCodeAsyncMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement);const r=this.createSilentAuthCodeClient(t);return await r.acquireToken(e).then(e=>(this.acquireTokenByCodeAsyncMeasurement?.end({success:!0,fromCache:e.fromCache,isNativeBroker:e.fromPlatformBroker}),e)).catch(e=>{throw this.acquireTokenByCodeAsyncMeasurement?.end({success:!1},e),e}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenFromCache(e,t){switch(t){case 0:case 1:case 2:const t=this.createSilentCacheClient(e.correlationId);return jr(t.acquireToken.bind(t),"silentCacheClientAcquireToken",this.logger,this.performanceClient,e.correlationId)(e);default:throw p(S)}}async acquireTokenByRefreshToken(e,t){switch(t){case 0:case 2:case 3:case 4:const t=this.createSilentRefreshClient(e.correlationId);return jr(t.acquireToken.bind(t),"silentRefreshClientAcquireToken",this.logger,this.performanceClient,e.correlationId)(e);default:throw p(S)}}async acquireTokenBySilentIframe(e){const t=this.createSilentIframeClient(e.correlationId);return jr(t.acquireToken.bind(t),"silentIframeClientAcquireToken",this.logger,this.performanceClient,e.correlationId)(e)}async logoutRedirect(e){const t=this.getRequestCorrelationId(e);return wi(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,Tt),this.createRedirectClient(t).logout(e)}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);return yi(this.initialized),this.browserStorage.setInteractionInProgress(!0,Tt),this.createPopupClient(t).logout(e).finally(()=>{this.browserStorage.setInteractionInProgress(!1)})}catch(e){return la.reject(e)}}async clearCache(e){if(!this.isBrowserEnvironment)return;const t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){return function(e,t,r,n,o){return e.verbose("1yd030",n),r?t.getAllAccounts(o,n):[]}(this.logger,this.browserStorage,this.isBrowserEnvironment,this.getRequestCorrelationId(),e)}getAccount(e){return function(e,t,r,n){if(t.trace("0u7b90",n),0===Object.keys(e).length)return t.warning("1kz0cu",n),null;const o=r.getAccountInfoFilteredBy(e,n);return o?(t.verbose("0btgll",n),o):(t.verbose("0ltaj5",n),null)}(e,this.logger,this.browserStorage,this.getRequestCorrelationId())}setActiveAccount(e){!function(e,t,r){t.setActiveAccount(e,r)}(e,this.browserStorage,this.getRequestCorrelationId())}getActiveAccount(){return e=this.browserStorage,t=this.getRequestCorrelationId(),e.getActiveAccount(t);var e,t}async hydrateCache(e,t){this.logger.verbose("16jycr",e.correlationId);const r=function(e,t,r){const n=Array.from(e.tenantProfiles?.values()||[]);return 0===n.length&&e.tenantId&&e.localAccountId&&n.push(kn(e.homeAccountId,e.localAccountId,e.tenantId,e.idTokenClaims)),{authorityType:e.authorityType||ae,homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,nativeAccountId:e.nativeAccountId,realm:e.tenantId,environment:e.environment,username:e.username,loginHint:e.loginHint,name:e.name,cloudGraphHostName:t,msGraphHost:r,tenantProfiles:n,dataBoundary:e.dataBoundary}}(e.account,e.cloudGraphHostName,e.msGraphHost);return await this.browserStorage.setAccount(r,e.correlationId,Wr(e.idTokenClaims),963),e.fromPlatformBroker?(this.logger.verbose("1fxyu8",e.correlationId),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}async acquireTokenNative(e,t,r,n){const o=this.getRequestCorrelationId(e);if(this.logger.trace("0b9y3p",o),!this.platformAuthProvider)throw We(at);return new bs(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.platformAuthProvider,r||this.getNativeAccountId(e),this.nativeInternalStorage,o).acquireToken(e,n)}canUsePlatformBroker(e,t){const r=this.getRequestCorrelationId(e);if(this.logger.trace("1n9lbl",r),!this.platformAuthProvider)return this.logger.trace("0vnu11",r),!1;if(!$s(this.config,this.logger,r,this.platformAuthProvider,e.authenticationScheme))return this.logger.trace("1m4bzf",r),!1;if(e.prompt)switch(e.prompt){case oe:case ne:case re:this.logger.trace("0vdv8e",r);break;default:return this.logger.trace("0pdzw6",r),!1}return!(!t&&!this.getNativeAccountId(e)&&(this.logger.trace("16lbtk",r),1))}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new Js(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,e,this.platformAuthProvider)}createRedirectClient(e){return new Gs(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,e,this.platformAuthProvider)}createSilentIframeClient(e){return new ra(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,863,this.performanceClient,this.nativeInternalStorage,e,this.platformAuthProvider)}createSilentCacheClient(e){return new Cs(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,e,this.platformAuthProvider)}createSilentRefreshClient(e){return new ia(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,e,this.platformAuthProvider)}createSilentAuthCodeClient(e){return new ca(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,866,this.performanceClient,e,this.platformAuthProvider)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return mi(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e?.correlationId?e.correlationId:this.isBrowserEnvironment?er():""}async loginRedirect(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("0lz9hf",t),this.acquireTokenRedirect({correlationId:t,...e||Ht})}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("0qw7v5",t),this.acquireTokenPopup({correlationId:t,...e||Ht})}async acquireTokenSilent(e){const t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement("acquireTokenSilent",t);r.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),ha(this.initialized,r,e.account),this.logger.verbose("0x1c4s",t);const n=e.account||this.getActiveAccount();if(!n)throw We("no_account_error");return this.acquireTokenSilentDeduped(e,n,t).then(n=>(r.end({success:!0,fromCache:n.fromCache,isNativeBroker:n.fromPlatformBroker,accessTokenSize:n.accessToken.length,idTokenSize:n.idToken.length},void 0,n.account),{...n,state:e.state,correlationId:t})).catch(e=>{throw e instanceof d&&e.setCorrelationId(t),r.end({success:!1},e,n),e})}async acquireTokenSilentDeduped(e,t,r){const n=Pn(this.config.auth.clientId,{...e,authority:e.authority||this.config.auth.authority,correlationId:r},t.homeAccountId),o=JSON.stringify(n),i=this.activeSilentTokenRequests.get(o);if(void 0===i){this.logger.verbose("0fcjbk",r),this.performanceClient.addFields({deduped:!1},r);const n=jr(this.acquireTokenSilentAsync.bind(this),"acquireTokenSilentAsync",this.logger,this.performanceClient,r)({...e,correlationId:r},t);return this.activeSilentTokenRequests.set(o,n),n.finally(()=>{this.activeSilentTokenRequests.delete(o)})}return this.logger.verbose("1yq7nb",r),this.performanceClient.addFields({deduped:!0},r),i}async acquireTokenSilentAsync(e,t){const r=()=>this.trackPageVisibility(e.correlationId);this.eventHandler.emitEvent(uo,Ut.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",r);const n=await jr(cs,"initializeSilentRequest",this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),o=e.cacheLookupPolicy||0;return this.acquireTokenSilentNoIframe(n,o).catch(async e=>{const t=function(e,t){const r=!(e instanceof yn&&e.subError!==pn),n=e.errorCode===gt||e.errorCode===S,o=r&&n||e.errorCode===dn||e.errorCode===un,i=zt.includes(t);return o&&i}(e,o);if(t){if(this.activeIframeRequest){if(5!==o){const[t,r]=this.activeIframeRequest;this.logger.verbose("1w8fso",n.correlationId);const i=this.performanceClient.startMeasurement("awaitConcurrentIframe",n.correlationId);i.add({awaitIframeCorrelationId:r});const s=await t;if(i.end({success:s}),s)return this.logger.verbose("0ywzzi",n.correlationId),this.acquireTokenSilentNoIframe(n,o);throw this.logger.info("17y14q",n.correlationId),e}return this.logger.warning("1bd4p8",n.correlationId),jr(this.acquireTokenBySilentIframe.bind(this),Te,this.logger,this.performanceClient,n.correlationId)(n)}{let e;return this.activeIframeRequest=[new la(t=>{e=t}),n.correlationId],this.logger.verbose("0rh08z",n.correlationId),jr(this.acquireTokenBySilentIframe.bind(this),Te,this.logger,this.performanceClient,n.correlationId)(n).then(t=>(e(!0),t)).catch(t=>{throw e(!1),t}).finally(()=>{this.activeIframeRequest=void 0})}}throw e}).then(t=>(this.eventHandler.emitEvent(go,Ut.Silent,t),e.correlationId&&this.performanceClient.addFields({fromCache:t.fromCache,isNativeBroker:t.fromPlatformBroker},e.correlationId),t)).catch(e=>{throw this.eventHandler.emitEvent(po,Ut.Silent,null,e),e}).finally(()=>{document.removeEventListener("visibilitychange",r)})}async acquireTokenSilentNoIframe(e,t){return $s(this.config,this.logger,e.correlationId,this.platformAuthProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("0sczo4",e.correlationId),this.acquireTokenNative(e,61,e.account.nativeAccountId,t).catch(async t=>{if(t instanceof fs&&ys(t))throw this.logger.verbose("07rkmb",e.correlationId),this.platformAuthProvider=void 0,p(S);throw t})):(this.logger.verbose("0ox81t",e.correlationId),1===t&&this.logger.verbose("0fvwxe",e.correlationId),jr(this.acquireTokenFromCache.bind(this),"acquireTokenFromCache",this.logger,this.performanceClient,e.correlationId)(e,t).catch(r=>{if(1===t)throw r;return this.eventHandler.emitEvent("msal:acquireTokenFromNetworkStart",Ut.Silent,e),jr(this.acquireTokenByRefreshToken.bind(this),"acquireTokenByRefreshToken",this.logger,this.performanceClient,e.correlationId)(e,t)}))}async preGeneratePkceCodes(e){return this.logger.verbose("1x6uj6",e),this.pkceCode=await jr(Es,Ue,this.logger,this.performanceClient,e)(this.performanceClient,this.logger,e),la.resolve()}getPreGeneratedPkceCodes(e){const t=this.pkceCode?{...this.pkceCode}:void 0;return this.pkceCode=void 0,t?this.logger.verbose("12js1o",e):this.logger.verbose("1oe9ci",e),this.performanceClient.addFields({usePreGeneratedPkce:!!t},e),t}logMultipleInstances(e,t){const r=this.config.auth.clientId;window&&(window.msal=window.msal||{},window.msal.clientIds=window.msal.clientIds||[],window.msal.clientIds.length>0&&this.logger.verbose("1qtz3l",t),window.msal.clientIds.push(r),function(e,t,r,n){const o=window.msal?.clientIds||[],i=o.length,s=o.filter(t=>t===e).length;s>1&&r.warning("1e88vg",n),t.add({msalInstanceCount:i,sameClientIdInstanceCount:s})}(r,e,this.logger,t))}}class ua{static loggerCallback(e,t){switch(e){case Ai.Error:return void console.error(t);case Ai.Info:return void console.info(t);case Ai.Verbose:return void console.debug(t);case Ai.Warning:return void console.warn(t);default:return void console.log(t)}}constructor(e){let t;this.browserEnvironment="undefined"!=typeof window,this.config=function({auth:e,cache:t,system:r,telemetry:n},o){const i={clientId:"",authority:`${E}`,knownAuthorities:[],cloudDiscoveryMetadata:"",authorityMetadata:"",redirectUri:"undefined"!=typeof window&&window.location?window.location.href.split("?")[0].split("#")[0]:"",postLogoutRedirectUri:"",clientCapabilities:[],OIDCOptions:{responseMode:"fragment",defaultScopes:[N,U,H]},azureCloudOptions:{azureCloudInstance:qr,tenant:""},instanceAware:!1},s={cacheLocation:It,cacheRetentionDays:5},a={loggerCallback:()=>{},logLevel:Ai.Info,piiLoggingEnabled:!1},c={...{...xi,loggerOptions:a,networkClient:o?new Ls:Ns,navigationClient:new Hs,popupBridgeTimeout:r?.popupBridgeTimeout||6e4,iframeBridgeTimeout:r?.iframeBridgeTimeout||1e4,redirectNavigationTimeout:3e4,allowRedirectInIframe:!1,navigatePopups:!0,allowPlatformBroker:!1,nativeBrokerHandshakeTimeout:r?.nativeBrokerHandshakeTimeout||2e3,protocolMode:"AAD"},...r,loggerOptions:r?.loggerOptions||a},l={application:{appName:"",appVersion:""},client:new Ri};if(r?.protocolMode!==Or&&e?.OIDCOptions&&new _i(c.loggerOptions).warning(JSON.stringify(wr("cannot_set_OIDCOptions")),""),r?.protocolMode&&r.protocolMode===Or&&c?.allowPlatformBroker)throw wr("cannot_allow_platform_broker");return{auth:{...i,...e,OIDCOptions:{...i.OIDCOptions,...e?.OIDCOptions}},cache:{...s,...t},system:c,telemetry:{...l,...n}}}(e,this.browserEnvironment);try{t=window[It]}catch(e){}const r=t?.getItem(zn),n=t?.getItem(Fn)?.toLowerCase(),o="true"===n||"false"!==n&&void 0,i={...this.config.system.loggerOptions},s=r&&Object.keys(Ai).includes(r)?Ai[r]:void 0;s&&(i.loggerCallback=ua.loggerCallback,i.logLevel=s),void 0!==o&&(i.piiLoggingEnabled=o),this.logger=new _i(i,"@azure/msal-browser",Ii),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}class ga extends ua{getModuleName(){return ga.MODULE_NAME}getId(){return ga.ID}async initialize(e){return this.available="undefined"!=typeof window,this.available}}ga.MODULE_NAME="",ga.ID="StandardOperatingContext";var pa=r(64583).Promise,ma=function(e,t,r,n){return new(r||(r=pa))(function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}c((n=n.apply(e,t||[])).next())})},fa=function(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},ya="".concat(window.location.origin,"/dialog.html?mode=graph"),wa=["openid","profile","offline_access","User.Read","Mail.ReadWrite","MailboxSettings.ReadWrite"],va=new class{constructor(e,t){this.controller=t||new da(new ga(e))}async initialize(e){return this.controller.initialize(e)}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}getAccount(e){return this.controller.getAccount(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}({auth:{clientId:"82c4dffb-91eb-49d4-a723-bae6232465f5",authority:"https://login.microsoftonline.com/".concat("f73679c2-a878-4ab2-a898-1d9405ccb695"),redirectUri:ya},cache:{cacheLocation:"sessionStorage"}}),Ca=null;function Ia(){if(!Ca){var e=va.initialize;Ca="function"==typeof e?e.call(va):pa.resolve()}return Ca}var ba=(0,i.n)({page:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:"18px",background:"rgb(242, 238, 231)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif'},card:{width:"100%",maxWidth:"520px",borderRadius:"14px",border:"1px solid rgba(0,0,0,0.08)",background:"rgba(255,255,255,0.92)",boxShadow:"0 12px 30px rgba(0,0,0,0.06)",padding:"18px",boxSizing:"border-box"},title:{margin:0,fontSize:"14px",fontWeight:700,color:"rgba(17,24,39,0.92)"},hint:{margin:"8px 0 0 0",fontSize:"12px",color:"rgba(17,24,39,0.58)",lineHeight:1.35},error:{marginTop:"10px",borderRadius:"10px",padding:"10px 12px",border:"1px solid rgba(220, 38, 38, 0.22)",background:"rgba(220, 38, 38, 0.08)",color:"rgba(153, 27, 27, 0.95)",fontSize:"12px",lineHeight:1.35,wordBreak:"break-word"},actions:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"14px"},btn:{height:"36px",borderRadius:"10px",border:"1px solid rgba(0,0,0,0.12)",background:"rgba(255,255,255,0.75)",padding:"0 12px",cursor:"pointer",fontWeight:600,fontSize:"12px",color:"rgba(17,24,39,0.86)"},primary:{border:"none",background:"#00204A",color:"white",WebkitTextFillColor:"white"}});function ka(e){var t,r,n,o=JSON.stringify(e);try{null===(n=null===(r=null===(t=null===Office||void 0===Office?void 0:Office.context)||void 0===t?void 0:t.ui)||void 0===r?void 0:r.messageParent)||void 0===n||n.call(r,o)}catch(e){}}function Ta(){var e=this,t=ba(),r=n.useState(null),o=r[0],i=r[1],s=n.useState(!1),a=s[0],c=s[1];return n.useEffect(function(){if(function(){try{var e=new URL(window.location.href);return"graph"===String(e.searchParams.get("mode")||"").toLowerCase()||!!String(window.location.hash||"").toLowerCase().includes("graph")}catch(e){return!1}}()){var t=!1;return ma(e,void 0,void 0,function(){var e,r,n,o;return fa(this,function(s){switch(s.label){case 0:return s.trys.push([0,6,7,8]),c(!0),i(null),[4,Ia()];case 1:return s.sent(),t?[2]:[4,va.handleRedirectPromise()];case 2:return e=s.sent(),t?[2]:(r=(null==e?void 0:e.account)||va.getAllAccounts()[0]||null)?[3,4]:[4,va.loginRedirect({scopes:wa})];case 3:return s.sent(),[2];case 4:return[4,va.acquireTokenSilent({account:r,scopes:wa})];case 5:return n=s.sent(),t?[2]:(ka({type:"graph_auth_complete",accessToken:n.accessToken,account:{username:r.username,homeAccountId:r.homeAccountId}}),[3,8]);case 6:return o=s.sent(),t?[2]:(i(o instanceof Error?o.message:String(o)),[3,8]);case 7:return t||c(!1),[7];case 8:return[2]}})}),function(){t=!0}}},[]),n.createElement("div",{className:t.page},n.createElement("div",{className:t.card},n.createElement("p",{className:t.title},"Microsoft login"),n.createElement("p",{className:t.hint},"This is used only to count unfiled emails in Inbox and Sent via Microsoft Graph."),o?n.createElement("div",{className:t.error},o):null,n.createElement("div",{className:t.actions},n.createElement("button",{type:"button",className:t.btn,onClick:function(){return ka({type:"graph_auth_cancel"})},disabled:a},"Cancel"),n.createElement("button",{type:"button",className:"".concat(t.btn," ").concat(t.primary),onClick:function(){return ma(e,void 0,void 0,function(){var e;return fa(this,function(t){switch(t.label){case 0:i(null),c(!0),t.label=1;case 1:return t.trys.push([1,4,,5]),[4,Ia()];case 2:return t.sent(),[4,va.loginRedirect({scopes:wa})];case 3:return t.sent(),[3,5];case 4:return e=t.sent(),i(e instanceof Error?e.message:String(e)),c(!1),[3,5];case 5:return[2]}})})},disabled:a},a?"Working":"Continue"))))}var Aa=document.getElementById("root");if(!Aa)throw new Error("Missing root element");var Sa=(0,o.H)(Aa);function _a(){return function(){try{var e=new URL(window.location.href);return"graph"===String(e.searchParams.get("mode")||"").toLowerCase()||String(window.location.hash||"").toLowerCase().includes("graph")}catch(e){return!1}}()?n.createElement(Ta,null):n.createElement(l,null)}function Pa(){Sa.render(n.createElement(_a,null))}try{"undefined"!=typeof Office&&"function"==typeof Office.onReady?Office.onReady(function(){return Pa()}):Pa()}catch(e){Pa()}},35137:function(e,t,r){function n(e){for(var t,r=0,n=0,o=e.length;o>=4;++n,o-=4)t=1540483477*(65535&(t=255&e.charCodeAt(n)|(255&e.charCodeAt(++n))<<8|(255&e.charCodeAt(++n))<<16|(255&e.charCodeAt(++n))<<24))+(59797*(t>>>16)<<16),r=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&r)+(59797*(r>>>16)<<16);switch(o){case 3:r^=(255&e.charCodeAt(n+2))<<16;case 2:r^=(255&e.charCodeAt(n+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.charCodeAt(n)))+(59797*(r>>>16)<<16)}return(((r=1540483477*(65535&(r^=r>>>13))+(59797*(r>>>16)<<16))^r>>>15)>>>0).toString(36)}r.d(t,{A:function(){return n}})},44541:function(e,t,r){r.d(t,{n:function(){return lt}});var n=r(53864),o=r(35137);function i(e){return e.reduce(function(e,t){var r=t[0],n=t[1];return e[r]=n,e[n]=r,e},{})}function s(e){return"number"==typeof e}function a(e,t){return-1!==e.indexOf(t)}function c(e,t,r,n){return t+(o=r,0===parseFloat(o)?o:"-"===o[0]?o.slice(1):"-"+o)+n;var o}function l(e){return e.replace(/ +/g," ").split(" ").map(function(e){return e.trim()}).filter(Boolean).reduce(function(e,t){var r=e.list,n=e.state,o=(t.match(/\(/g)||[]).length,i=(t.match(/\)/g)||[]).length;return n.parensDepth>0?r[r.length-1]=r[r.length-1]+" "+t:r.push(t),n.parensDepth+=o-i,{list:r,state:n}},{list:[],state:{parensDepth:0}}).list}function h(e){var t=l(e);if(t.length<=3||t.length>4)return e;var r=t[0],n=t[1],o=t[2];return[r,t[3],o,n].join(" ")}var d={padding:function(e){var t=e.value;return s(t)?t:h(t)},textShadow:function(e){return function(e){for(var t=[],r=0,n=0,o=!1;n<e.length;)o||","!==e[n]?"("===e[n]?(o=!0,n++):")"===e[n]?(o=!1,n++):n++:(t.push(e.substring(r,n).trim()),r=++n);return r!=n&&t.push(e.substring(r,n+1)),t}(e.value).map(function(e){return e.replace(/(^|\s)(-*)([.|\d]+)/,function(e,t,r,n){return"0"===n?e:t+(""===r?"-":"")+n})}).join(",")},borderColor:function(e){return h(e.value)},borderRadius:function(e){var t=e.value;if(s(t))return t;if(a(t,"/")){var r=t.split("/"),n=r[0],o=r[1];return d.borderRadius({value:n.trim()})+" / "+d.borderRadius({value:o.trim()})}var i=l(t);switch(i.length){case 2:return i.reverse().join(" ");case 4:var c=i[0],h=i[1],u=i[2];return[h,c,i[3],u].join(" ");default:return t}},background:function(e){var t=e.value,r=e.valuesToConvert,n=e.isRtl,o=e.bgImgDirectionRegex,i=e.bgPosDirectionRegex;if(s(t))return t;var a=t.replace(/(url\(.*?\))|(rgba?\(.*?\))|(hsl\(.*?\))|(#[a-fA-F0-9]+)|((^| )(\D)+( |$))/g,"").trim();return t=t.replace(a,d.backgroundPosition({value:a,valuesToConvert:r,isRtl:n,bgPosDirectionRegex:i})),d.backgroundImage({value:t,valuesToConvert:r,bgImgDirectionRegex:o})},backgroundImage:function(e){var t=e.value,r=e.valuesToConvert,n=e.bgImgDirectionRegex;return a(t,"url(")||a(t,"linear-gradient(")?t.replace(n,function(e,t,n){return e.replace(n,r[n])}):t},backgroundPosition:function(e){var t=e.value,r=e.valuesToConvert,n=e.isRtl,o=e.bgPosDirectionRegex;return t.replace(n?/^((-|\d|\.)+%)/:null,function(e,t){return function(e){var t=e.indexOf(".");if(-1===t)e=100-parseFloat(e)+"%";else{var r=e.length-t-2;e=(e=100-parseFloat(e)).toFixed(r)+"%"}return e}(t)}).replace(o,function(e){return r[e]})},backgroundPositionX:function(e){var t=e.value,r=e.valuesToConvert,n=e.isRtl,o=e.bgPosDirectionRegex;return s(t)?t:d.backgroundPosition({value:t,valuesToConvert:r,isRtl:n,bgPosDirectionRegex:o})},transition:function(e){var t=e.value,r=e.propertiesToConvert;return t.split(/,\s*/g).map(function(e){var t=e.split(" ");return t[0]=r[t[0]]||t[0],t.join(" ")}).join(", ")},transitionProperty:function(e){var t=e.value,r=e.propertiesToConvert;return t.split(/,\s*/g).map(function(e){return r[e]||e}).join(", ")},transform:function(e){var t=e.value,r="[^\\u0020-\\u007e]",n="(?:(?:(?:\\[0-9a-f]{1,6})(?:\\r\\n|\\s)?)|\\\\[^\\r\\n\\f0-9a-f])",o="((?:-?(?:[0-9]*\\.[0-9]+|[0-9]+)(?:\\s*(?:em|ex|px|cm|mm|in|pt|pc|deg|rad|grad|ms|s|hz|khz|%)|-?(?:[_a-z]|"+r+"|"+n+")(?:[_a-z0-9-]|"+r+"|"+n+")*)?)|(?:inherit|auto))",i=new RegExp("(translateX\\s*\\(\\s*)"+o+"(\\s*\\))","gi"),s=new RegExp("(translate\\s*\\(\\s*)"+o+"((?:\\s*,\\s*"+o+"){0,1}\\s*\\))","gi"),a=new RegExp("(translate3d\\s*\\(\\s*)"+o+"((?:\\s*,\\s*"+o+"){0,2}\\s*\\))","gi"),l=new RegExp("(rotate[ZY]?\\s*\\(\\s*)"+o+"(\\s*\\))","gi");return t.replace(i,c).replace(s,c).replace(a,c).replace(l,c)}};d.objectPosition=d.backgroundPosition,d.margin=d.padding,d.borderWidth=d.padding,d.boxShadow=d.textShadow,d.webkitBoxShadow=d.boxShadow,d.mozBoxShadow=d.boxShadow,d.WebkitBoxShadow=d.boxShadow,d.MozBoxShadow=d.boxShadow,d.borderStyle=d.borderColor,d.webkitTransform=d.transform,d.mozTransform=d.transform,d.WebkitTransform=d.transform,d.MozTransform=d.transform,d.transformOrigin=d.backgroundPosition,d.webkitTransformOrigin=d.transformOrigin,d.mozTransformOrigin=d.transformOrigin,d.WebkitTransformOrigin=d.transformOrigin,d.MozTransformOrigin=d.transformOrigin,d.webkitTransition=d.transition,d.mozTransition=d.transition,d.WebkitTransition=d.transition,d.MozTransition=d.transition,d.webkitTransitionProperty=d.transitionProperty,d.mozTransitionProperty=d.transitionProperty,d.WebkitTransitionProperty=d.transitionProperty,d.MozTransitionProperty=d.transitionProperty,d["text-shadow"]=d.textShadow,d["border-color"]=d.borderColor,d["border-radius"]=d.borderRadius,d["background-image"]=d.backgroundImage,d["background-position"]=d.backgroundPosition,d["background-position-x"]=d.backgroundPositionX,d["object-position"]=d.objectPosition,d["border-width"]=d.padding,d["box-shadow"]=d.textShadow,d["-webkit-box-shadow"]=d.textShadow,d["-moz-box-shadow"]=d.textShadow,d["border-style"]=d.borderColor,d["-webkit-transform"]=d.transform,d["-moz-transform"]=d.transform,d["transform-origin"]=d.transformOrigin,d["-webkit-transform-origin"]=d.transformOrigin,d["-moz-transform-origin"]=d.transformOrigin,d["-webkit-transition"]=d.transition,d["-moz-transition"]=d.transition,d["transition-property"]=d.transitionProperty,d["-webkit-transition-property"]=d.transitionProperty,d["-moz-transition-property"]=d.transitionProperty;var u=i([["paddingLeft","paddingRight"],["marginLeft","marginRight"],["left","right"],["borderLeft","borderRight"],["borderLeftColor","borderRightColor"],["borderLeftStyle","borderRightStyle"],["borderLeftWidth","borderRightWidth"],["borderTopLeftRadius","borderTopRightRadius"],["borderBottomLeftRadius","borderBottomRightRadius"],["padding-left","padding-right"],["margin-left","margin-right"],["border-left","border-right"],["border-left-color","border-right-color"],["border-left-style","border-right-style"],["border-left-width","border-right-width"],["border-top-left-radius","border-top-right-radius"],["border-bottom-left-radius","border-bottom-right-radius"]]),g=["content"],p=i([["ltr","rtl"],["left","right"],["w-resize","e-resize"],["sw-resize","se-resize"],["nw-resize","ne-resize"]]),m=new RegExp("(^|\\W|_)((ltr)|(rtl)|(left)|(right))(\\W|_|$)","g"),f=new RegExp("(left)|(right)");function y(e){return Object.keys(e).reduce(function(t,r){var n=e[r];if("string"==typeof n&&(n=n.trim()),a(g,r))return t[r]=n,t;var o=w(r,n),i=o.key,s=o.value;return t[i]=s,t},Array.isArray(e)?[]:{})}function w(e,t){var r,n=/\/\*\s?@noflip\s?\*\//.test(t),o=n?e:u[r=e]||r,i=n?t:function(e,t){if(!function(e){return!("boolean"==typeof e||function(e){return null==e}(e))}(t))return t;if((r=t)&&"object"==typeof r)return y(t);var r,n,o=s(t),i=function(e){return"function"==typeof e}(t),a=o||i?t:t.replace(/ !important.*?$/,""),c=!o&&a.length!==t.length,l=d[e];return n=l?l({value:a,valuesToConvert:p,propertiesToConvert:u,isRtl:!0,bgImgDirectionRegex:m,bgPosDirectionRegex:f}):p[a]||a,c?n+" !important":n}(o,t);return{key:o,value:i}}var v=r(45614);const C=/[A-Z]/g,I=/^ms-/,b={};function k(e){return"-"+e.toLowerCase()}function T(e){if(Object.prototype.hasOwnProperty.call(b,e))return b[e];if("--"===e.substr(0,2))return e;const t=e.replace(C,k);return b[e]=I.test(t)?"-"+t:t}function A(e){return"&"===e.charAt(0)?e.slice(1):e}var S="-moz-",_="-webkit-",P="comm",R="rule",x="decl",E="@import",O="@namespace",M="@keyframes",q="@layer",N=Math.abs,U=String.fromCharCode,H=Object.assign;function L(e){return e.trim()}function D(e,t){return(e=t.exec(e))?e[0]:e}function z(e,t,r){return e.replace(t,r)}function F(e,t,r){return e.indexOf(t,r)}function B(e,t){return 0|e.charCodeAt(t)}function j(e,t,r){return e.slice(t,r)}function K(e){return e.length}function $(e){return e.length}function W(e,t){return t.push(e),e}function J(e,t){for(var r="",n=0;n<e.length;n++)r+=t(e[n],n,e,t)||"";return r}function V(e,t,r,n){switch(e.type){case q:if(e.children.length)break;case E:case O:case x:return e.return=e.return||e.value;case P:return"";case M:return e.return=e.value+"{"+J(e.children,n)+"}";case R:if(!K(e.value=e.props.join(",")))return""}return K(r=J(e.children,n))?e.return=e.value+"{"+r+"}":""}var G=1,Q=1,X=0,Y=0,Z=0,ee="";function te(e,t,r,n,o,i,s,a){return{value:e,root:t,parent:r,type:n,props:o,children:i,line:G,column:Q,length:s,return:"",siblings:a}}function re(e,t){return H(te("",null,null,"",null,null,0,e.siblings),e,{length:-e.length},t)}function ne(){return Z=Y>0?B(ee,--Y):0,Q--,10===Z&&(Q=1,G--),Z}function oe(){return Z=Y<X?B(ee,Y++):0,Q++,10===Z&&(Q=1,G++),Z}function ie(){return B(ee,Y)}function se(){return Y}function ae(e,t){return j(ee,e,t)}function ce(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function le(e){return G=Q=1,X=K(ee=e),Y=0,[]}function he(e){return ee="",e}function de(e){return L(ae(Y-1,pe(91===e?e+2:40===e?e+1:e)))}function ue(e){for(;(Z=ie())&&Z<33;)oe();return ce(e)>2||ce(Z)>3?"":" "}function ge(e,t){for(;--t&&oe()&&!(Z<48||Z>102||Z>57&&Z<65||Z>70&&Z<97););return ae(e,se()+(t<6&&32==ie()&&32==oe()))}function pe(e){for(;oe();)switch(Z){case e:return Y;case 34:case 39:34!==e&&39!==e&&pe(Z);break;case 40:41===e&&pe(e);break;case 92:oe()}return Y}function me(e,t){for(;oe()&&e+Z!==57&&(e+Z!==84||47!==ie()););return"/*"+ae(t,Y-1)+"*"+U(47===e?e:oe())}function fe(e){for(;!ce(ie());)oe();return ae(e,Y)}function ye(e){return he(we("",null,null,null,[""],e=le(e),0,[0],e))}function we(e,t,r,n,o,i,s,a,c){for(var l=0,h=0,d=s,u=0,g=0,p=0,m=1,f=1,y=1,w=0,v="",C=o,I=i,b=n,k=v;f;)switch(p=w,w=oe()){case 40:if(108!=p&&58==B(k,d-1)){-1!=F(k+=z(de(w),"&","&\f"),"&\f",N(l?a[l-1]:0))&&(y=-1);break}case 34:case 39:case 91:k+=de(w);break;case 9:case 10:case 13:case 32:k+=ue(p);break;case 92:k+=ge(se()-1,7);continue;case 47:switch(ie()){case 42:case 47:W(Ce(me(oe(),se()),t,r,c),c),5!=ce(p||1)&&5!=ce(ie()||1)||!K(k)||" "===j(k,-1,void 0)||(k+=" ");break;default:k+="/"}break;case 123*m:a[l++]=K(k)*y;case 125*m:case 59:case 0:switch(w){case 0:case 125:f=0;case 59+h:-1==y&&(k=z(k,/\f/g,"")),g>0&&(K(k)-d||0===m&&47===p)&&W(g>32?Ie(k+";",n,r,d-1,c):Ie(z(k," ","")+";",n,r,d-2,c),c);break;case 59:k+=";";default:if(W(b=ve(k,t,r,l,h,o,a,v,C=[],I=[],d,i),i),123===w)if(0===h)we(k,t,b,b,C,i,d,a,I);else{switch(u){case 99:if(110===B(k,3))break;case 108:if(97===B(k,2))break;default:h=0;case 100:case 109:case 115:}h?we(e,b,b,n&&W(ve(e,b,b,0,0,o,a,v,o,C=[],d,I),I),o,I,d,a,n?C:I):we(k,b,b,b,[""],I,0,a,I)}}l=h=g=0,m=y=1,v=k="",d=s;break;case 58:d=1+K(k),g=p;default:if(m<1)if(123==w)--m;else if(125==w&&0==m++&&125==ne())continue;switch(k+=U(w),w*m){case 38:y=h>0?1:(k+="\f",-1);break;case 44:a[l++]=(K(k)-1)*y,y=1;break;case 64:45===ie()&&(k+=de(oe())),u=ie(),h=d=K(v=k+=fe(se())),w++;break;case 45:45===p&&2==K(k)&&(m=0)}}return i}function ve(e,t,r,n,o,i,s,a,c,l,h,d){for(var u=o-1,g=0===o?i:[""],p=$(g),m=0,f=0,y=0;m<n;++m)for(var w=0,v=j(e,u+1,u=N(f=s[m])),C=e;w<p;++w)(C=L(f>0?g[w]+" "+v:z(v,/&\f/g,g[w])))&&(c[y++]=C);return te(e,t,r,0===o?R:a,c,l,h,d)}function Ce(e,t,r,n){return te(e,t,r,P,U(Z),j(e,2,-2),0,n)}function Ie(e,t,r,n,o){return te(e,t,r,x,j(e,0,n),j(e,n+1,-1),n,o)}function be(e){var t=$(e);return function(r,n,o,i){for(var s="",a=0;a<t;a++)s+=e[a](r,n,o,i)||"";return s}}function ke(e){return function(t){t.root||(t=t.return)&&e(t)}}const Te=e=>{if(e.type===R){if("string"==typeof e.props)return;e.props=e.props.map(e=>-1===e.indexOf(":global(")?e:function(e){return he(function(e){for(;oe();)switch(ce(Z)){case 0:W(fe(Y-1),e);break;case 2:W(de(Z),e);break;default:W(U(Z),e)}return e}(le(e)))}(e).reduce((e,t,r,n)=>{if(""===t)return e;if(":"===t&&"global"===n[r+1]){const t=n[r+2].slice(1,-1)+" ";return e.unshift(t),n[r+1]="",n[r+2]="",e}return e.push(t),e},[]).join(""))}};function Ae(e,t,r){switch(function(e,t){return 45^B(e,0)?(((t<<2^B(e,0))<<2^B(e,1))<<2^B(e,2))<<2^B(e,3):0}(e,t)){case 5103:return _+"print-"+e+e;case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:return _+e+e;case 4215:if(102===B(e,9))return _+e+e;if(116===B(e,t+1))return _+e+e;break;case 4789:return S+e+e;case 5349:case 4246:case 6968:return _+e+S+e+e;case 6187:if(!D(e,/grab/))return z(z(z(e,/(zoom-|grab)/,_+"$1"),/(image-set)/,_+"$1"),e,"")+e;case 5495:case 3959:return z(e,/(image-set\([^]*)/,_+"$1$`$1");case 4095:case 3583:case 4068:case 2532:return z(e,/(.+)-inline(.+)/,_+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(K(e)-1-t>6)switch(B(e,t+1)){case 102:if(108===B(e,t+3))return z(e,/(.+:)(.+)-([^]+)/,"$1"+_+"$2-$3$1"+S+(108==B(e,t+3)?"$3":"$2-$3"))+e;case 115:return~F(e,"stretch")?Ae(z(e,"stretch","fill-available"),t)+e:e}}return e}function Se(e,t,r,n){if(e.length>-1&&!e.return)switch(e.type){case x:return void(e.return=Ae(e.value,e.length));case R:if(e.length)return function(e,t){return e.map(t).join("")}(e.props,function(t){switch(D(t,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return J([re(e,{props:[z(t,/:(read-\w+)/,":"+S+"$1")]})],n);case"::placeholder":return J([re(e,{props:[z(t,/:(plac\w+)/,":"+_+"input-$1")]}),re(e,{props:[z(t,/:(plac\w+)/,":"+S+"$1")]})],n)}return""})}}const _e=e=>{(function(e){switch(e.type){case"@container":case"@media":case"@supports":case q:return!0}return!1})(e)&&Array.isArray(e.children)&&e.children.sort((e,t)=>e.props[0]>t.props[0]?1:-1)};const Pe=/,( *[^ &])/g;function Re(e,t,r){let n=t;return r.length>0&&(n=r.reduceRight((e,t)=>{return`${r=t,"&"+A(r.replace(Pe,",&$1"))} { ${e} }`;var r},t)),`${e}{${n}}`}function xe(e,t){const{className:r,selectors:n,property:o,rtlClassName:i,rtlProperty:s,rtlValue:a,value:c}=e,{container:l,layer:h,media:d,supports:u}=t;let g=Re(`.${r}`,Array.isArray(c)?`${c.map(e=>`${T(o)}: ${e}`).join(";")};`:`${T(o)}: ${c};`,n);return s&&i&&(g+=Re(`.${i}`,Array.isArray(a)?`${a.map(e=>`${T(s)}: ${e}`).join(";")};`:`${T(s)}: ${a};`,n)),d&&(g=`@media ${d} { ${g} }`),h&&(g=`@layer ${h} { ${g} }`),u&&(g=`@supports ${u} { ${g} }`),l&&(g=`@container ${l} { ${g} }`),function(e){const t=[];return J(ye(e),be([Te,_e,Se,V,ke(e=>t.push(e))])),t}(g)}function Ee(e){let t="";for(const r in e){const n=e[r];if("string"!=typeof n&&"number"!=typeof n){if(Array.isArray(n))for(const e of n)t+=T(r)+":"+e+";"}else t+=T(r)+":"+n+";"}return t}function Oe(e){let t="";for(const r in e)t+=`${r}{${Ee(e[r])}}`;return t}function Me(e,t){const r=[];return J(ye(`@keyframes ${e} {${t}}`),be([V,Se,ke(e=>r.push(e))])),r}const qe={animation:[-1,["animationDelay","animationDirection","animationDuration","animationFillMode","animationIterationCount","animationName","animationPlayState","animationTimeline","animationTimingFunction"]],animationRange:[-1,["animationRangeEnd","animationRangeStart"]],background:[-2,["backgroundAttachment","backgroundClip","backgroundColor","backgroundImage","backgroundOrigin","backgroundPosition","backgroundPositionX","backgroundPositionY","backgroundRepeat","backgroundSize"]],backgroundPosition:[-1,["backgroundPositionX","backgroundPositionY"]],border:[-2,["borderBottom","borderBottomColor","borderBottomStyle","borderBottomWidth","borderLeft","borderLeftColor","borderLeftStyle","borderLeftWidth","borderRight","borderRightColor","borderRightStyle","borderRightWidth","borderTop","borderTopColor","borderTopStyle","borderTopWidth"]],borderBottom:[-1,["borderBottomColor","borderBottomStyle","borderBottomWidth"]],borderImage:[-1,["borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth"]],borderLeft:[-1,["borderLeftColor","borderLeftStyle","borderLeftWidth"]],borderRadius:[-1,["borderBottomLeftRadius","borderBottomRightRadius","borderTopLeftRadius","borderTopRightRadius"]],borderRight:[-1,["borderRightColor","borderRightStyle","borderRightWidth"]],borderTop:[-1,["borderTopColor","borderTopStyle","borderTopWidth"]],caret:[-1,["caretColor","caretShape"]],columnRule:[-1,["columnRuleColor","columnRuleStyle","columnRuleWidth"]],columns:[-1,["columnCount","columnWidth"]],containIntrinsicSize:[-1,["containIntrinsicHeight","containIntrinsicWidth"]],container:[-1,["containerName","containerType"]],flex:[-1,["flexBasis","flexGrow","flexShrink"]],flexFlow:[-1,["flexDirection","flexWrap"]],font:[-1,["fontFamily","fontSize","fontStretch","fontStyle","fontVariant","fontWeight","lineHeight"]],gap:[-1,["columnGap","rowGap"]],grid:[-1,["columnGap","gridAutoColumns","gridAutoFlow","gridAutoRows","gridColumnGap","gridRowGap","gridTemplateAreas","gridTemplateColumns","gridTemplateRows","rowGap"]],gridArea:[-1,["gridColumnEnd","gridColumnStart","gridRowEnd","gridRowStart"]],gridColumn:[-1,["gridColumnEnd","gridColumnStart"]],gridRow:[-1,["gridRowEnd","gridRowStart"]],gridTemplate:[-1,["gridTemplateAreas","gridTemplateColumns","gridTemplateRows"]],inset:[-1,["bottom","left","right","top"]],insetBlock:[-1,["insetBlockEnd","insetBlockStart"]],insetInline:[-1,["insetInlineEnd","insetInlineStart"]],listStyle:[-1,["listStyleImage","listStylePosition","listStyleType"]],margin:[-1,["marginBottom","marginLeft","marginRight","marginTop"]],marginBlock:[-1,["marginBlockEnd","marginBlockStart"]],marginInline:[-1,["marginInlineEnd","marginInlineStart"]],mask:[-1,["maskClip","maskComposite","maskImage","maskMode","maskOrigin","maskPosition","maskRepeat","maskSize"]],maskBorder:[-1,["maskBorderMode","maskBorderOutset","maskBorderRepeat","maskBorderSlice","maskBorderSource","maskBorderWidth"]],offset:[-1,["offsetAnchor","offsetDistance","offsetPath","offsetPosition","offsetRotate"]],outline:[-1,["outlineColor","outlineStyle","outlineWidth"]],overflow:[-1,["overflowX","overflowY"]],overscrollBehavior:[-1,["overscrollBehaviorX","overscrollBehaviorY"]],padding:[-1,["paddingBottom","paddingLeft","paddingRight","paddingTop"]],paddingBlock:[-1,["paddingBlockEnd","paddingBlockStart"]],paddingInline:[-1,["paddingInlineEnd","paddingInlineStart"]],placeContent:[-1,["alignContent","justifyContent"]],placeItems:[-1,["alignItems","justifyItems"]],placeSelf:[-1,["alignSelf","justifySelf"]],scrollMargin:[-1,["scrollMarginBottom","scrollMarginLeft","scrollMarginRight","scrollMarginTop"]],scrollMarginBlock:[-1,["scrollMarginBlockEnd","scrollMarginBlockStart"]],scrollMarginInline:[-1,["scrollMarginInlineEnd","scrollMarginInlineStart"]],scrollPadding:[-1,["scrollPaddingBottom","scrollPaddingLeft","scrollPaddingRight","scrollPaddingTop"]],scrollPaddingBlock:[-1,["scrollPaddingBlockEnd","scrollPaddingBlockStart"]],scrollPaddingInline:[-1,["scrollPaddingInlineEnd","scrollPaddingInlineStart"]],scrollTimeline:[-1,["scrollTimelineAxis","scrollTimelineName"]],textDecoration:[-1,["textDecorationColor","textDecorationLine","textDecorationStyle","textDecorationThickness"]],textEmphasis:[-1,["textEmphasisColor","textEmphasisStyle"]],transition:[-1,["transitionBehavior","transitionDelay","transitionDuration","transitionProperty","transitionTimingFunction"]],viewTimeline:[-1,["viewTimelineAxis","viewTimelineName"]]};function Ne(e,t){return 0===e.length?t:`${e} and ${t}`}function Ue(e){return"@media"===e.substr(0,6)}function He(e){return"@layer"===e.substr(0,6)}const Le=/^(:|\[|>|&)/;function De(e){return Le.test(e)}function ze(e){return"@supports"===e.substr(0,9)}function Fe(e){return"@container"===e.substring(0,10)}function Be(e){return null!=e&&"object"==typeof e&&!1===Array.isArray(e)}const je={"us-w":"w","us-v":"i",nk:"l",si:"v",cu:"f",ve:"h",ti:"a"};function Ke(e,t){if(t.media)return"m";if(t.layer||t.supports)return"t";if(t.container)return"c";if(e.length>0){const t=e[0].trim();if(58===t.charCodeAt(0))return je[t.slice(4,8)]||je[t.slice(3,5)]||"d"}return"d"}function $e(e,t){return e?t+e:e}function We(e){return $e(e.container,"c")+$e(e.media,"m")+$e(e.layer,"l")+$e(e.supports,"s")}function Je(e,t,r){const n=e+We(r)+t,i=(0,o.A)(n),s=i.charCodeAt(0);return s>=48&&s<=57?String.fromCharCode(s+17)+i.slice(1):i}function Ve({property:e,selector:t,salt:r,value:n},i){return v.aN+(0,o.A)(r+t+We(i)+e+n.trim())}function Ge(e){return e===v.Ut}function Qe(e){return e.replace(/>\s+/g,">")}function Xe(e,t){}function Ye(e,t){}function Ze(e){return qe[e]}function et(e){var t;return null!==(t=null==e?void 0:e[0])&&void 0!==t?t:0}function tt(e,t,r,n){e[t]=n?[r,n]:r}function rt(e,t){return t.length>0?[e,Object.fromEntries(t)]:e}function nt(e,t,r,n,o,i){var s;const a=[];0!==i&&a.push(["p",i]),"m"===t&&o&&a.push(["m",o]),null!==(s=e[t])&&void 0!==s||(e[t]=[]),r&&e[t].push(rt(r,a)),n&&e[t].push(rt(n,a))}function ot(e,t="",r=[],n={container:"",layer:"",media:"",supports:""},i={},s={},a){for(const c in e){if(v.qw.hasOwnProperty(c)){Ye(0,e[c]);continue}const l=e[c];if(null!=l){if(Ge(l)){tt(i,Je(Qe(r.join("")),c,n),0,void 0);continue}if("string"==typeof l||"number"==typeof l){const e=Qe(r.join("")),o=Ze(c);if(o){const e=o[1],a=Object.fromEntries(e.map(e=>[e,v.Ut]));ot(a,t,r,n,i,s)}const h=Je(e,c,n),d=Ve({value:l.toString(),salt:t,selector:e,property:c},n),u=a&&{key:c,value:a}||w(c,l),g=u.key!==c||u.value!==l,p=g?Ve({value:u.value.toString(),property:u.key,salt:t,selector:e},n):void 0,m=g?{rtlClassName:p,rtlProperty:u.key,rtlValue:u.value}:void 0,f=Ke(r,n),[y,C]=xe(Object.assign({className:d,selectors:r,property:c,value:l},m),n);tt(i,h,d,p),nt(s,f,y,C,n.media,et(o))}else if("animationName"===c){const e=Array.isArray(l)?l:[l],a=[],c=[];for(const t of e){const e=Oe(t),r=Oe(y(t)),i=v.aN+(0,o.A)(e);let l;const h=Me(i,e);let d=[];e===r?l=i:(l=v.aN+(0,o.A)(r),d=Me(l,r));for(let e=0;e<h.length;e++)nt(s,"k",h[e],d[e],n.media,0);a.push(i),c.push(l)}ot({animationName:a.join(", ")},t,r,n,i,s,c.join(", "))}else if(Array.isArray(l)){if(0===l.length)continue;const e=Qe(r.join("")),o=Ze(c);if(o){const e=o[1],a=Object.fromEntries(e.map(e=>[e,v.Ut]));ot(a,t,r,n,i,s)}const a=Je(e,c,n),h=Ve({value:l.map(e=>(null!=e?e:"").toString()).join(";"),salt:t,selector:e,property:c},n),d=l.map(e=>w(c,e));if(d.some(e=>e.key!==d[0].key))continue;const u=d[0].key!==c||d.some((e,t)=>e.value!==l[t]),g=u?Ve({value:d.map(e=>{var t;return(null!==(t=null==e?void 0:e.value)&&void 0!==t?t:"").toString()}).join(";"),salt:t,property:d[0].key,selector:e},n):void 0,p=u?{rtlClassName:g,rtlProperty:d[0].key,rtlValue:d.map(e=>e.value)}:void 0,m=Ke(r,n),[f,y]=xe(Object.assign({className:h,selectors:r,property:c,value:l},p),n);tt(i,a,h,g),nt(s,m,f,y,n.media,et(o))}else if(Be(l))if(De(c))ot(l,t,r.concat(A(c)),n,i,s);else if(Ue(c)){const e=Ne(n.media,c.slice(6).trim());ot(l,t,r,Object.assign({},n,{media:e}),i,s)}else if(He(c)){const e=(n.layer?`${n.layer}.`:"")+c.slice(6).trim();ot(l,t,r,Object.assign({},n,{layer:e}),i,s)}else if(ze(c)){const e=Ne(n.supports,c.slice(9).trim());ot(l,t,r,Object.assign({},n,{supports:e}),i,s)}else if(Fe(c)){const e=c.slice(10).trim();ot(l,t,r,Object.assign({},n,{container:e}),i,s)}else Xe()}}return[i,s]}var it=r(87294);var st=r(49264),at=r(26312),ct=r(56004);function lt(e){const t=function(e,t=n.A){const r=t();let o=null,i=null,s=null,a=null;return function(t){const{dir:n,renderer:c}=t;null===o&&([o,i]=function(e,t=""){const r={},n={};for(const o in e){const i=e[o],[s,a]=ot(i,t);r[o]=s,Object.keys(a).forEach(e=>{n[e]=(n[e]||[]).concat(a[e])})}return[r,n]}(e,c.classNameHashSalt));const l="ltr"===n;return l?null===s&&(s=(0,it.N)(o,n)):null===a&&(a=(0,it.N)(o,n)),r(c,i),l?s:a}}(e,st.A);return function(){const e=(0,ct.m)(),r=(0,at.J)();return t({dir:e,renderer:r})}}},45614:function(e,t,r){r.d(t,{AX:function(){return p},EJ:function(){return c},FS:function(){return g},Ut:function(){return f},aN:function(){return l},ed:function(){return a},ez:function(){return h},fj:function(){return d},k1:function(){return s},qw:function(){return m},wn:function(){return u}});const n="undefined"==typeof window?r.g:window,o="@griffel/";function i(e,t){return n[Symbol.for(o+e)]||(n[Symbol.for(o+e)]=t),n[Symbol.for(o+e)]}const s=i("DEFINITION_LOOKUP_TABLE",{}),a="data-make-styles-bucket",c="data-priority",l="f",h=7,d="___",u=d.length+h,g=0,p=1,m={all:1,borderColor:1,borderStyle:1,borderWidth:1,borderBlock:1,borderBlockEnd:1,borderBlockStart:1,borderInline:1,borderInlineEnd:1,borderInlineStart:1},f="DO_NOT_USE_DIRECTLY: @griffel/reset-value"},49264:function(e,t,r){r.d(t,{A:function(){return s}});var n=r(96540),o=r.t(n,2);const i=o.useInsertionEffect?o.useInsertionEffect:void 0,s=()=>{const e={};return function(t,r){i&&"undefined"!=typeof window&&window.document&&window.document.createElement?i(()=>{t.insertCSSRules(r)},[t,r]):void 0===e[t.id]&&(t.insertCSSRules(r),e[t.id]=!0)}}},53864:function(e,t,r){r.d(t,{A:function(){return n}});const n=()=>{const e={};return function(t,r){void 0===e[t.id]&&(t.insertCSSRules(r),e[t.id]=!0)}}},56004:function(e,t,r){r.d(t,{e:function(){return i},m:function(){return s}});var n=r(96540);const o=n.createContext("ltr"),i=({children:e,dir:t})=>n.createElement(o.Provider,{value:t},e);function s(){return n.useContext(o)}},68404:function(){},87294:function(e,t,r){r.d(t,{N:function(){return s},z:function(){return i}});var n=r(45614),o=r(29255);function i(e,t){let r="",n="";for(const o in e){const i=e[o];if(0===i){n+=o+" ";continue}const s=Array.isArray(i),a="rtl"===t?(s?i[1]:i)+" ":(s?i[0]:i)+" ";r+=a,n+=a}return[r.slice(0,-1),n.slice(0,-1)]}function s(e,t){const r={};for(const s in e){const[a,c]=i(e[s],t);if(""===c){r[s]="";continue}const l=(0,o.G)(c,t),h=l+(""===a?"":" "+a);n.k1[l]=[e[s],t],r[s]=h}return r}}},function(e){var t=function(t){return e(e.s=t)};t(31105),t(68404)}]);
//# sourceMappingURL=dialog.js.map